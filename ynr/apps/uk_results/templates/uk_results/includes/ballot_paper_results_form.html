<script type='text/javascript'>
  $(document).ready(function() {    
    $('#ballot_paper_results_form').on('change', function() {
      console.log("I'm working!")

      var inputs = document.querySelectorAll('*[id*=membership]')
      var list = Object.values(inputs)
      var inputArray = list.map(input => input.value)

      function NoneEmpty(inputArray) {
        for (var i = 0; i < inputArray.length; i++) {
        if(inputArray[i] === "") return false;
      }
        return true;
      }
      var noEmptyValues = NoneEmpty(inputArray)

      if (inputArray.length > 1 && noEmptyValues ) {
        for (var i = 0; i < inputArray.length; ++i) {
          // find and store the highest value and the index of that value  
          var max = 0;
          max = Math.max(...inputArray);
          var maxIndex = list.indexOf(max)
          // check for duplicate max values - a tie
          // BUT I don't want it to compare it against itself
          // so make sure the index of max isn't the same as the comparison index
          if (maxIndex != inputs[i] && max == inputs[i].value) { 
            if (inputs[i].value == max) {
              // this needs to be toggled to change with input changes
              inputs[i].nextElementSibling.style.display = "inline"
            } else {
              inputs[i].nextElementSibling.style.display = "none" 
            } 
          } else {
            return
          }
        }
      } 
    })
  }) 
</script>    

<form method=post id="ballot_paper_results_form" class="ballot_paper_results_form">
  {{ form.errors }}
  {% csrf_token %}
  <table>
    <tbody>
      {% for membership_field in form.membership_fields %}
      <tr>
        <td>{{ membership_field.label }}</td>
        <td>
          {{ membership_field.errors }}
          {{ membership_field }}
            <div id="coin-toss" style="display: none">
              {{ tied_vote_field.label_tag }}
            {{ tied_vote_field }}
             <h3 id="coin-emoji" style="-webkit-animation: anim 10s infinite linear;
             animation: anim 10s infinite linear;" class="flip">ðŸª™</h3>
            </div>
        </td>
      </tr>
      {% endfor %}
    </tbody>
    <tbody>
      <tr>
        <td>{{ results_form.num_spoilt_ballots.label }}</td>
        <td>{{ results_form.num_spoilt_ballots }}</td>
      </tr>
      <tr>
        <td>{{ results_form.num_turnout_reported.label }}</td>
        <td>{{ results_form.num_turnout_reported }}</td>
      </tr>
    </tbody>
    <tbody>
      <tr>
        <td>{{ results_form.source.label }}</td>
        <td>{{ results_form.source }}</td>
      </tr>
    </tbody>
  </table>
  <button type=submit>Save</button>
</form>
