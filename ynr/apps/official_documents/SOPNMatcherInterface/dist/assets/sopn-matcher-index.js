(function(){const C=document.createElement("link").relList;if(C&&C.supports&&C.supports("modulepreload"))return;for(const D of document.querySelectorAll('link[rel="modulepreload"]'))l(D);new MutationObserver(D=>{for(const y of D)if(y.type==="childList")for(const P of y.addedNodes)P.tagName==="LINK"&&P.rel==="modulepreload"&&l(P)}).observe(document,{childList:!0,subtree:!0});function x(D){const y={};return D.integrity&&(y.integrity=D.integrity),D.referrerPolicy&&(y.referrerPolicy=D.referrerPolicy),D.crossOrigin==="use-credentials"?y.credentials="include":D.crossOrigin==="anonymous"?y.credentials="omit":y.credentials="same-origin",y}function l(D){if(D.ep)return;D.ep=!0;const y=x(D);fetch(D.href,y)}})();function vt(){}function $e(L){return!!L&&(typeof L=="object"||typeof L=="function")&&typeof L.then=="function"}function De(L){return L()}function Se(){return Object.create(null)}function Bt(L){L.forEach(De)}function ee(L){return typeof L=="function"}function le(L,C){return L!=L?C==C:L!==C||L&&typeof L=="object"||typeof L=="function"}function Ve(L){return Object.keys(L).length===0}function me(L,...C){if(L==null){for(const l of C)l(void 0);return vt}const x=L.subscribe(...C);return x.unsubscribe?()=>x.unsubscribe():x}function _e(L,C,x){L.$$.on_destroy.push(me(C,x))}function Ge(L,C,x){return L.set(x),C}function Ue(L){return L&&ee(L.destroy)?L.destroy:vt}function bt(L,C){L.appendChild(C)}function kt(L,C,x){L.insertBefore(C,x||null)}function Et(L){L.parentNode&&L.parentNode.removeChild(L)}function Xe(L,C){for(let x=0;x<L.length;x+=1)L[x]&&L[x].d(C)}function wt(L){return document.createElement(L)}function Lt(L){return document.createTextNode(L)}function Nt(){return Lt(" ")}function xe(){return Lt("")}function de(L,C,x,l){return L.addEventListener(C,x,l),()=>L.removeEventListener(C,x,l)}function yt(L,C,x){x==null?L.removeAttribute(C):L.getAttribute(C)!==x&&L.setAttribute(C,x)}function je(L){return Array.from(L.childNodes)}function ae(L,C){C=""+C,L.data!==C&&(L.data=C)}let te;function Ht(L){te=L}function Ye(){if(!te)throw new Error("Function called outside component initialization");return te}const Jt=[],Ce=[];let Qt=[];const Ee=[],qe=Promise.resolve();let ue=!1;function We(){ue||(ue=!0,qe.then(be))}function fe(L){Qt.push(L)}const ce=new Set;let qt=0;function be(){if(qt!==0)return;const L=te;do{try{for(;qt<Jt.length;){const C=Jt[qt];qt++,Ht(C),Je(C.$$)}}catch(C){throw Jt.length=0,qt=0,C}for(Ht(null),Jt.length=0,qt=0;Ce.length;)Ce.pop()();for(let C=0;C<Qt.length;C+=1){const x=Qt[C];ce.has(x)||(ce.add(x),x())}Qt.length=0}while(Jt.length);for(;Ee.length;)Ee.pop()();ue=!1,ce.clear(),Ht(L)}function Je(L){if(L.fragment!==null){L.update(),Bt(L.before_update);const C=L.dirty;L.dirty=[-1],L.fragment&&L.fragment.p(L.ctx,C),L.after_update.forEach(fe)}}function Qe(L){const C=[],x=[];Qt.forEach(l=>L.indexOf(l)===-1?C.push(l):x.push(l)),x.forEach(l=>l()),Qt=C}const re=new Set;let Gt;function Ne(){Gt={r:0,c:[],p:Gt}}function Oe(){Gt.r||Bt(Gt.c),Gt=Gt.p}function Ot(L,C){L&&L.i&&(re.delete(L),L.i(C))}function Xt(L,C,x,l){if(L&&L.o){if(re.has(L))return;re.add(L),Gt.c.push(()=>{re.delete(L),l&&(x&&L.d(1),l())}),L.o(C)}else l&&l()}function pe(L,C){const x=C.token={};function l(D,y,P,E){if(C.token!==x)return;C.resolved=E;let T=C.ctx;P!==void 0&&(T=T.slice(),T[P]=E);const v=D&&(C.current=D)(T);let g=!1;C.block&&(C.blocks?C.blocks.forEach((o,c)=>{c!==y&&o&&(Ne(),Xt(o,1,1,()=>{C.blocks[c]===o&&(C.blocks[c]=null)}),Oe())}):C.block.d(1),v.c(),Ot(v,1),v.m(C.mount(),C.anchor),g=!0),C.block=v,C.blocks&&(C.blocks[y]=v),g&&be()}if($e(L)){const D=Ye();if(L.then(y=>{Ht(D),l(C.then,1,C.value,y),Ht(null)},y=>{if(Ht(D),l(C.catch,2,C.error,y),Ht(null),!C.hasCatch)throw y}),C.current!==C.pending)return l(C.pending,0),!0}else{if(C.current!==C.then)return l(C.then,1,C.value,L),!0;C.resolved=L}}function He(L,C,x){const l=C.slice(),{resolved:D}=L;L.current===L.then&&(l[L.value]=D),L.current===L.catch&&(l[L.error]=D),L.block.p(l,x)}function oe(L){return L?.length!==void 0?L:Array.from(L)}function Ke(L,C){L.d(1),C.delete(L.key)}function Ze(L,C,x,l,D,y,P,E,T,v,g,o){let c=L.length,p=y.length,n=c;const m={};for(;n--;)m[L[n].key]=n;const e=[],r=new Map,u=new Map,w=[];for(n=p;n--;){const M=o(D,y,n),z=x(M);let G=P.get(z);G?l&&w.push(()=>G.p(M,C)):(G=v(z,M),G.c()),r.set(z,e[n]=G),z in m&&u.set(z,Math.abs(n-m[z]))}const A=new Set,I=new Set;function k(M){Ot(M,1),M.m(E,g),P.set(M.key,M),g=M.first,p--}for(;c&&p;){const M=e[p-1],z=L[c-1],G=M.key,X=z.key;M===z?(g=M.first,c--,p--):r.has(X)?!P.has(G)||A.has(G)?k(M):I.has(X)?c--:u.get(G)>u.get(X)?(I.add(G),k(M)):(A.add(X),c--):(T(z,P),c--)}for(;c--;){const M=L[c];r.has(M.key)||T(M,P)}for(;p;)k(e[p-1]);return Bt(w),e}function Be(L){L&&L.c()}function Ae(L,C,x){const{fragment:l,after_update:D}=L.$$;l&&l.m(C,x),fe(()=>{const y=L.$$.on_mount.map(De).filter(ee);L.$$.on_destroy?L.$$.on_destroy.push(...y):Bt(y),L.$$.on_mount=[]}),D.forEach(fe)}function ve(L,C){const x=L.$$;x.fragment!==null&&(Qe(x.after_update),Bt(x.on_destroy),x.fragment&&x.fragment.d(C),x.on_destroy=x.fragment=null,x.ctx=[])}function ts(L,C){L.$$.dirty[0]===-1&&(Jt.push(L),We(),L.$$.dirty.fill(0)),L.$$.dirty[C/31|0]|=1<<C%31}function ye(L,C,x,l,D,y,P=null,E=[-1]){const T=te;Ht(L);const v=L.$$={fragment:null,ctx:[],props:y,update:vt,not_equal:D,bound:Se(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(C.context||(T?T.$$.context:[])),callbacks:Se(),dirty:E,skip_bound:!1,root:C.target||T.$$.root};P&&P(v.root);let g=!1;if(v.ctx=x?x(L,C.props||{},(o,c,...p)=>{const n=p.length?p[0]:c;return v.ctx&&D(v.ctx[o],v.ctx[o]=n)&&(!v.skip_bound&&v.bound[o]&&v.bound[o](n),g&&ts(L,o)),c}):[],v.update(),g=!0,Bt(v.before_update),v.fragment=l?l(v.ctx):!1,C.target){if(C.hydrate){const o=je(C.target);v.fragment&&v.fragment.l(o),o.forEach(Et)}else v.fragment&&v.fragment.c();C.intro&&Ot(L.$$.fragment),Ae(L,C.target,C.anchor),be()}Ht(T)}class we{$$=void 0;$$set=void 0;$destroy(){ve(this,1),this.$destroy=vt}$on(C,x){if(!ee(x))return vt;const l=this.$$.callbacks[C]||(this.$$.callbacks[C]=[]);return l.push(x),()=>{const D=l.indexOf(x);D!==-1&&l.splice(D,1)}}$set(C){this.$$set&&!Ve(C)&&(this.$$.skip_bound=!0,this.$$set(C),this.$$.skip_bound=!1)}}const es="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(es);const Wt=[];function ss(L,C){return{subscribe:ze(L,C).subscribe}}function ze(L,C=vt){let x;const l=new Set;function D(E){if(le(L,E)&&(L=E,x)){const T=!Wt.length;for(const v of l)v[1](),Wt.push(v,L);if(T){for(let v=0;v<Wt.length;v+=2)Wt[v][0](Wt[v+1]);Wt.length=0}}}function y(E){D(E(L))}function P(E,T=vt){const v=[E,T];return l.add(v),l.size===1&&(x=C(D,y)||vt),E(L),()=>{l.delete(v),l.size===0&&x&&(x(),x=null)}}return{set:D,update:y,subscribe:P}}function is(L,C,x){const l=!Array.isArray(L),D=l?[L]:L;if(!D.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const y=C.length<2;return ss(x,(P,E)=>{let T=!1;const v=[];let g=0,o=vt;const c=()=>{if(g)return;o();const n=C(l?v[0]:v,P,E);y?P(n):o=ee(n)?n:vt},p=D.map((n,m)=>me(n,e=>{v[m]=e,g&=~(1<<m),T&&c()},()=>{g|=1<<m}));return T=!0,c(),function(){Bt(p),o(),T=!1}})}const Kt=ze();function Te(L,C,x){const l=L.slice();return l[4]=C[x].ballot_paper_id,l[5]=C[x].label,l[6]=C[x].matched_page,l[7]=C[x].matched,l[8]=C,l[9]=x,l}function ke(L){let C,x,l,D,y,P,E=L[5]+"",T,v,g,o;function c(){L[3].call(x,L[8],L[9])}return{c(){C=wt("label"),x=wt("input"),y=Nt(),P=wt("span"),T=Lt(E),v=Nt(),yt(x,"type","checkbox"),yt(x,"data-ballot",l=L[4]),yt(x,"data-page_number",L[0]),yt(x,"name",D="ballot_for_page_"+L[0]),yt(P,"class","svelte-r8qh5v"),yt(C,"class","ds-field-checkbox svelte-r8qh5v")},m(p,n){kt(p,C,n),bt(C,x),x.checked=L[7],bt(C,y),bt(C,P),bt(P,T),bt(C,v),g||(o=[de(x,"change",L[2]),de(x,"change",c)],g=!0)},p(p,n){L=p,n&2&&l!==(l=L[4])&&yt(x,"data-ballot",l),n&1&&yt(x,"data-page_number",L[0]),n&1&&D!==(D="ballot_for_page_"+L[0])&&yt(x,"name",D),n&2&&(x.checked=L[7]),n&2&&E!==(E=L[5]+"")&&ae(T,E)},d(p){p&&Et(C),g=!1,Bt(o)}}}function Fe(L,C){let x,l,D=(!C[6]||C[6]&&C[6]==C[0])&&ke(C);return{key:L,first:null,c(){x=xe(),D&&D.c(),l=xe(),this.first=x},m(y,P){kt(y,x,P),D&&D.m(y,P),kt(y,l,P)},p(y,P){C=y,!C[6]||C[6]&&C[6]==C[0]?D?D.p(C,P):(D=ke(C),D.c(),D.m(l.parentNode,l)):D&&(D.d(1),D=null)},d(y){y&&(Et(x),Et(l)),D&&D.d(y)}}}function ns(L){let C,x,l,D,y,P=[],E=new Map,T=oe(L[1]);const v=g=>g[4];for(let g=0;g<T.length;g+=1){let o=Te(L,T,g),c=v(o);E.set(c,P[g]=Fe(c,o))}return{c(){C=wt("div"),x=wt("fieldset"),l=wt("legend"),l.textContent="Related ballot",D=Nt(),y=wt("div");for(let g=0;g<P.length;g+=1)P[g].c();yt(y,"class","ds-stack-smallest"),yt(C,"class","ballot-picker")},m(g,o){kt(g,C,o),bt(C,x),bt(x,l),bt(x,D),bt(x,y);for(let c=0;c<P.length;c+=1)P[c]&&P[c].m(y,null)},p(g,[o]){o&7&&(T=oe(g[1]),P=Ze(P,o,v,1,g,T,E,y,Ke,Fe,null,Te))},i:vt,o:vt,d(g){g&&Et(C);for(let o=0;o<P.length;o+=1)P[o].d()}}}function rs(L,C,x){let l;_e(L,Kt,E=>x(1,l=E));let{page_number:D}=C;function y(E){let T=E.target.dataset.ballot,v=E.target.dataset.page_number;Kt.update(g=>{const o=g.findIndex(p=>p.ballot_paper_id===T);if(o!==-1){let p=E.target.checked;g[o].matched=p;var c=E.target.parentElement.parentElement.querySelectorAll("input");p?(g[o].matched_page=v,c.forEach(n=>{n.checked||(n.disabled=!0)})):(g[o].matched_page=void 0,c.forEach(n=>{n.disabled=!1}))}return g})}function P(E,T){E[T].matched=this.checked,Kt.set(l)}return L.$$set=E=>{"page_number"in E&&x(0,D=E.page_number)},[D,l,y,P]}class as extends we{constructor(C){super(),ye(this,C,rs,ns,le,{page_number:0})}}function os(L){return{c:vt,m:vt,p:vt,i:vt,o:vt,d:vt}}function ls(L){let C,x,l,D=L[0]+1+"",y,P,E,T,v,g,o,c,p,n,m,e,r,u,w,A,I,k;function M(X,q){return X[3]?cs:hs}let z=M(L),G=z(L);return w=new as({props:{page_number:L[0]}}),{c(){C=wt("div"),x=wt("div"),l=wt("h2"),y=Lt(D),P=Lt("."),E=Nt(),T=wt("small"),v=Lt("of "),g=Lt(L[1]),o=Nt(),c=wt("button"),G.c(),p=Nt(),n=wt("div"),m=wt("div"),e=wt("canvas"),u=Nt(),Be(w.$$.fragment),yt(l,"class","svelte-7ys38b"),yt(T,"class","svelte-7ys38b"),yt(c,"class","expand_button ds-button-blue svelte-7ys38b"),yt(x,"class","page_header svelte-7ys38b"),yt(m,"data-expanded",L[3]),yt(m,"class","svelte-7ys38b"),yt(n,"class","pdf_wrapper svelte-7ys38b"),yt(C,"class","page_wrapper svelte-7ys38b")},m(X,q){kt(X,C,q),bt(C,x),bt(x,l),bt(l,y),bt(l,P),bt(x,E),bt(x,T),bt(T,v),bt(T,g),bt(x,o),bt(x,c),G.m(c,null),bt(C,p),bt(C,n),bt(n,m),bt(m,e),bt(C,u),Ae(w,C,null),A=!0,I||(k=[de(c,"click",L[4]),Ue(r=fs.call(null,e,{loaded_page:L[5]}))],I=!0)},p(X,q){L=X,(!A||q&1)&&D!==(D=L[0]+1+"")&&ae(y,D),(!A||q&2)&&ae(g,L[1]),z!==(z=M(L))&&(G.d(1),G=z(L),G&&(G.c(),G.m(c,null))),r&&ee(r.update)&&q&4&&r.update.call(null,{loaded_page:L[5]}),(!A||q&8)&&yt(m,"data-expanded",L[3]);const et={};q&1&&(et.page_number=L[0]),w.$set(et)},i(X){A||(Ot(w.$$.fragment,X),A=!0)},o(X){Xt(w.$$.fragment,X),A=!1},d(X){X&&Et(C),G.d(),ve(w),I=!1,Bt(k)}}}function hs(L){let C;return{c(){C=Lt("Expand")},m(x,l){kt(x,C,l)},d(x){x&&Et(C)}}}function cs(L){let C;return{c(){C=Lt("Collapse")},m(x,l){kt(x,C,l)},d(x){x&&Et(C)}}}function ds(L){let C;return{c(){C=Lt("Loading page....pdf_wrapper")},m(x,l){kt(x,C,l)},p:vt,i:vt,o:vt,d(x){x&&Et(C)}}}function us(L){let C,x,l,D,y,P={ctx:L,current:null,token:null,hasCatch:!1,pending:ds,then:ls,catch:os,value:5,blocks:[,,,]};return pe(x=L[2],P),{c(){C=wt("section"),P.block.c(),l=Nt(),D=wt("hr")},m(E,T){kt(E,C,T),P.block.m(C,P.anchor=null),P.mount=()=>C,P.anchor=null,kt(E,l,T),kt(E,D,T),y=!0},p(E,[T]){L=E,P.ctx=L,T&4&&x!==(x=L[2])&&pe(x,P)||He(P,L,T)},i(E){y||(Ot(P.block),y=!0)},o(E){for(let T=0;T<3;T+=1){const v=P.blocks[T];Xt(v)}y=!1},d(E){E&&(Et(C),Et(l),Et(D)),P.block.d(),P.token=null,P=null}}}function fs(L,{loaded_page:C}){var x=1.5,l=C.getViewport({scale:x}),D=window.devicePixelRatio||1,y=L,P=y.getContext("2d");y.width=Math.floor(l.width*D),y.height=Math.floor(l.height*D),y.style.width="100%";var E=D!==1?[D,0,0,D,0,0]:null,T={canvasContext:P,transform:E,viewport:l};C.render(T)}function ps(L,C,x){let{page_number:l}=C,{total_pages:D}=C,{page:y}=C,P=!1;const E=()=>x(3,P=!P);return L.$$set=T=>{"page_number"in T&&x(0,l=T.page_number),"total_pages"in T&&x(1,D=T.total_pages),"page"in T&&x(2,y=T.page)},[l,D,y,P,E]}class gs extends we{constructor(C){super(),ye(this,C,ps,us,le,{page_number:0,total_pages:1,page:2})}}const ms="modulepreload",bs=function(L){return"/"+L},Re={},$t=function(C,x,l){if(!x||x.length===0)return C();const D=document.getElementsByTagName("link");return Promise.all(x.map(y=>{if(y=bs(y),y in Re)return;Re[y]=!0;const P=y.endsWith(".css"),E=P?'[rel="stylesheet"]':"";if(!!l)for(let g=D.length-1;g>=0;g--){const o=D[g];if(o.href===y&&(!P||o.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${y}"]${E}`))return;const v=document.createElement("link");if(v.rel=P?"stylesheet":ms,P||(v.as="script",v.crossOrigin=""),v.href=y,document.head.appendChild(v),P)return new Promise((g,o)=>{v.addEventListener("load",g),v.addEventListener("error",()=>o(new Error(`Unable to preload CSS for ${y}`)))})})).then(()=>C()).catch(y=>{const P=new Event("vite:preloadError",{cancelable:!0});if(P.payload=y,window.dispatchEvent(P),!P.defaultPrevented)throw y})};var As={640:(L,C,x)=>{x.d(C,{AnnotationLayer:()=>ct,FreeTextAnnotationElement:()=>q,InkAnnotationElement:()=>Z,StampAnnotationElement:()=>gt});var l=x(266),D=x(473),y=x(780);function P(K){return Math.floor(Math.max(0,Math.min(1,K))*255).toString(16).padStart(2,"0")}function E(K){return Math.max(0,Math.min(255,255*K))}class T{static CMYK_G([f,h,s,t]){return["G",1-Math.min(1,.3*f+.59*s+.11*h+t)]}static G_CMYK([f]){return["CMYK",0,0,0,1-f]}static G_RGB([f]){return["RGB",f,f,f]}static G_rgb([f]){return f=E(f),[f,f,f]}static G_HTML([f]){const h=P(f);return`#${h}${h}${h}`}static RGB_G([f,h,s]){return["G",.3*f+.59*h+.11*s]}static RGB_rgb(f){return f.map(E)}static RGB_HTML(f){return`#${f.map(P).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([f,h,s,t]){return["RGB",1-Math.min(1,f+t),1-Math.min(1,s+t),1-Math.min(1,h+t)]}static CMYK_rgb([f,h,s,t]){return[E(1-Math.min(1,f+t)),E(1-Math.min(1,s+t)),E(1-Math.min(1,h+t))]}static CMYK_HTML(f){const h=this.CMYK_RGB(f).slice(1);return this.RGB_HTML(h)}static RGB_CMYK([f,h,s]){const t=1-f,i=1-h,a=1-s,d=Math.min(t,i,a);return["CMYK",t,i,a,d]}}var v=x(160);const g=1e3,o=9,c=new WeakSet;function p(K){return{width:K[2]-K[0],height:K[3]-K[1]}}class n{static create(f){switch(f.data.annotationType){case l.AnnotationType.LINK:return new e(f);case l.AnnotationType.TEXT:return new r(f);case l.AnnotationType.WIDGET:switch(f.data.fieldType){case"Tx":return new w(f);case"Btn":return f.data.radioButton?new k(f):f.data.checkBox?new I(f):new M(f);case"Ch":return new z(f);case"Sig":return new A(f)}return new u(f);case l.AnnotationType.POPUP:return new G(f);case l.AnnotationType.FREETEXT:return new q(f);case l.AnnotationType.LINE:return new et(f);case l.AnnotationType.SQUARE:return new at(f);case l.AnnotationType.CIRCLE:return new W(f);case l.AnnotationType.POLYLINE:return new $(f);case l.AnnotationType.CARET:return new J(f);case l.AnnotationType.INK:return new Z(f);case l.AnnotationType.POLYGON:return new U(f);case l.AnnotationType.HIGHLIGHT:return new tt(f);case l.AnnotationType.UNDERLINE:return new ft(f);case l.AnnotationType.SQUIGGLY:return new lt(f);case l.AnnotationType.STRIKEOUT:return new ot(f);case l.AnnotationType.STAMP:return new gt(f);case l.AnnotationType.FILEATTACHMENT:return new dt(f);default:return new m(f)}}}class m{#t=!1;constructor(f,{isRenderable:h=!1,ignoreBorder:s=!1,createQuadrilaterals:t=!1}={}){this.isRenderable=h,this.data=f.data,this.layer=f.layer,this.linkService=f.linkService,this.downloadManager=f.downloadManager,this.imageResourcesPath=f.imageResourcesPath,this.renderForms=f.renderForms,this.svgFactory=f.svgFactory,this.annotationStorage=f.annotationStorage,this.enableScripting=f.enableScripting,this.hasJSActions=f.hasJSActions,this._fieldObjects=f.fieldObjects,this.parent=f.parent,h&&(this.container=this._createContainer(s)),t&&this._createQuadrilaterals()}static _hasPopupData({titleObj:f,contentsObj:h,richText:s}){return!!(f?.str||h?.str||s?.str)}get hasPopupData(){return m._hasPopupData(this.data)}_createContainer(f){const{data:h,parent:{page:s,viewport:t}}=this,i=document.createElement("section");i.setAttribute("data-annotation-id",h.id),this instanceof u||(i.tabIndex=g),i.style.zIndex=this.parent.zIndex++,this.data.popupRef&&i.setAttribute("aria-haspopup","dialog"),h.noRotate&&i.classList.add("norotate");const{pageWidth:a,pageHeight:d,pageX:b,pageY:S}=t.rawDims;if(!h.rect||this instanceof G){const{rotation:V}=h;return!h.hasOwnCanvas&&V!==0&&this.setRotation(V,i),i}const{width:R,height:_}=p(h.rect),N=l.Util.normalizeRect([h.rect[0],s.view[3]-h.rect[1]+s.view[1],h.rect[2],s.view[3]-h.rect[3]+s.view[1]]);if(!f&&h.borderStyle.width>0){i.style.borderWidth=`${h.borderStyle.width}px`;const V=h.borderStyle.horizontalCornerRadius,B=h.borderStyle.verticalCornerRadius;if(V>0||B>0){const O=`calc(${V}px * var(--scale-factor)) / calc(${B}px * var(--scale-factor))`;i.style.borderRadius=O}else if(this instanceof k){const O=`calc(${R}px * var(--scale-factor)) / calc(${_}px * var(--scale-factor))`;i.style.borderRadius=O}switch(h.borderStyle.style){case l.AnnotationBorderStyleType.SOLID:i.style.borderStyle="solid";break;case l.AnnotationBorderStyleType.DASHED:i.style.borderStyle="dashed";break;case l.AnnotationBorderStyleType.BEVELED:(0,l.warn)("Unimplemented border style: beveled");break;case l.AnnotationBorderStyleType.INSET:(0,l.warn)("Unimplemented border style: inset");break;case l.AnnotationBorderStyleType.UNDERLINE:i.style.borderBottomStyle="solid";break}const F=h.borderColor||null;F?(this.#t=!0,i.style.borderColor=l.Util.makeHexColor(F[0]|0,F[1]|0,F[2]|0)):i.style.borderWidth=0}i.style.left=`${100*(N[0]-b)/a}%`,i.style.top=`${100*(N[1]-S)/d}%`;const{rotation:H}=h;return h.hasOwnCanvas||H===0?(i.style.width=`${100*R/a}%`,i.style.height=`${100*_/d}%`):this.setRotation(H,i),i}setRotation(f,h=this.container){if(!this.data.rect)return;const{pageWidth:s,pageHeight:t}=this.parent.viewport.rawDims,{width:i,height:a}=p(this.data.rect);let d,b;f%180===0?(d=100*i/s,b=100*a/t):(d=100*a/s,b=100*i/t),h.style.width=`${d}%`,h.style.height=`${b}%`,h.setAttribute("data-main-rotation",(360-f)%360)}get _commonActions(){const f=(h,s,t)=>{const i=t.detail[h],a=i[0],d=i.slice(1);t.target.style[s]=T[`${a}_HTML`](d),this.annotationStorage.setValue(this.data.id,{[s]:T[`${a}_rgb`](d)})};return(0,l.shadow)(this,"_commonActions",{display:h=>{const{display:s}=h.detail,t=s%2===1;this.container.style.visibility=t?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:t,noPrint:s===1||s===2})},print:h=>{this.annotationStorage.setValue(this.data.id,{noPrint:!h.detail.print})},hidden:h=>{const{hidden:s}=h.detail;this.container.style.visibility=s?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:s,noView:s})},focus:h=>{setTimeout(()=>h.target.focus({preventScroll:!1}),0)},userName:h=>{h.target.title=h.detail.userName},readonly:h=>{h.target.disabled=h.detail.readonly},required:h=>{this._setRequired(h.target,h.detail.required)},bgColor:h=>{f("bgColor","backgroundColor",h)},fillColor:h=>{f("fillColor","backgroundColor",h)},fgColor:h=>{f("fgColor","color",h)},textColor:h=>{f("textColor","color",h)},borderColor:h=>{f("borderColor","borderColor",h)},strokeColor:h=>{f("strokeColor","borderColor",h)},rotation:h=>{const s=h.detail.rotation;this.setRotation(s),this.annotationStorage.setValue(this.data.id,{rotation:s})}})}_dispatchEventFromSandbox(f,h){const s=this._commonActions;for(const t of Object.keys(h.detail))(f[t]||s[t])?.(h)}_setDefaultPropertiesFromJS(f){if(!this.enableScripting)return;const h=this.annotationStorage.getRawValue(this.data.id);if(!h)return;const s=this._commonActions;for(const[t,i]of Object.entries(h)){const a=s[t];if(a){const d={detail:{[t]:i},target:f};a(d),delete h[t]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:f}=this.data;if(!f)return;const[h,s,t,i]=this.data.rect;if(f.length===1){const[,{x:B,y:F},{x:O,y:Y}]=f[0];if(t===B&&i===F&&h===O&&s===Y)return}const{style:a}=this.container;let d;if(this.#t){const{borderColor:B,borderWidth:F}=a;a.borderWidth=0,d=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${B}" stroke-width="${F}">`],this.container.classList.add("hasBorder")}const b=t-h,S=i-s,{svgFactory:R}=this,_=R.createElement("svg");_.classList.add("quadrilateralsContainer"),_.setAttribute("width",0),_.setAttribute("height",0);const N=R.createElement("defs");_.append(N);const H=R.createElement("clipPath"),V=`clippath_${this.data.id}`;H.setAttribute("id",V),H.setAttribute("clipPathUnits","objectBoundingBox"),N.append(H);for(const[,{x:B,y:F},{x:O,y:Y}]of f){const j=R.createElement("rect"),Q=(O-h)/b,st=(i-F)/S,it=(B-O)/b,rt=(F-Y)/S;j.setAttribute("x",Q),j.setAttribute("y",st),j.setAttribute("width",it),j.setAttribute("height",rt),H.append(j),d?.push(`<rect vector-effect="non-scaling-stroke" x="${Q}" y="${st}" width="${it}" height="${rt}"/>`)}this.#t&&(d.push("</g></svg>')"),a.backgroundImage=d.join("")),this.container.append(_),this.container.style.clipPath=`url(#${V})`}_createPopup(){const{container:f,data:h}=this;f.setAttribute("aria-haspopup","dialog");const s=new G({data:{color:h.color,titleObj:h.titleObj,modificationDate:h.modificationDate,contentsObj:h.contentsObj,richText:h.richText,parentRect:h.rect,borderStyle:0,id:`popup_${h.id}`,rotation:h.rotation},parent:this.parent,elements:[this]});this.parent.div.append(s.render())}render(){(0,l.unreachable)("Abstract method `AnnotationElement.render` called")}_getElementsByName(f,h=null){const s=[];if(this._fieldObjects){const t=this._fieldObjects[f];if(t)for(const{page:i,id:a,exportValues:d}of t){if(i===-1||a===h)continue;const b=typeof d=="string"?d:null,S=document.querySelector(`[data-element-id="${a}"]`);if(S&&!c.has(S)){(0,l.warn)(`_getElementsByName - element not allowed: ${a}`);continue}s.push({id:a,exportValue:b,domElement:S})}return s}for(const t of document.getElementsByName(f)){const{exportValue:i}=t,a=t.getAttribute("data-element-id");a!==h&&c.has(t)&&s.push({id:a,exportValue:i,domElement:t})}return s}show(){this.container&&(this.container.hidden=!1),this.popup?.maybeShow()}hide(){this.container&&(this.container.hidden=!0),this.popup?.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const f=this.getElementsToTriggerPopup();if(Array.isArray(f))for(const h of f)h.classList.add("highlightArea");else f.classList.add("highlightArea")}get _isEditable(){return!1}_editOnDoubleClick(){if(!this._isEditable)return;const{annotationEditorType:f,data:{id:h}}=this;this.container.addEventListener("dblclick",()=>{this.linkService.eventBus?.dispatch("switchannotationeditormode",{source:this,mode:f,editId:h})})}}class e extends m{constructor(f,h=null){super(f,{isRenderable:!0,ignoreBorder:!!h?.ignoreBorder,createQuadrilaterals:!0}),this.isTooltipOnly=f.data.isTooltipOnly}render(){const{data:f,linkService:h}=this,s=document.createElement("a");s.setAttribute("data-element-id",f.id);let t=!1;return f.url?(h.addLinkAttributes(s,f.url,f.newWindow),t=!0):f.action?(this._bindNamedAction(s,f.action),t=!0):f.attachment?(this.#e(s,f.attachment,f.attachmentDest),t=!0):f.setOCGState?(this.#s(s,f.setOCGState),t=!0):f.dest?(this._bindLink(s,f.dest),t=!0):(f.actions&&(f.actions.Action||f.actions["Mouse Up"]||f.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(s,f),t=!0),f.resetForm?(this._bindResetFormAction(s,f.resetForm),t=!0):this.isTooltipOnly&&!t&&(this._bindLink(s,""),t=!0)),this.container.classList.add("linkAnnotation"),t&&this.container.append(s),this.container}#t(){this.container.setAttribute("data-internal-link","")}_bindLink(f,h){f.href=this.linkService.getDestinationHash(h),f.onclick=()=>(h&&this.linkService.goToDestination(h),!1),(h||h==="")&&this.#t()}_bindNamedAction(f,h){f.href=this.linkService.getAnchorUrl(""),f.onclick=()=>(this.linkService.executeNamedAction(h),!1),this.#t()}#e(f,h,s=null){f.href=this.linkService.getAnchorUrl(""),f.onclick=()=>(this.downloadManager?.openOrDownloadData(h.content,h.filename,s),!1),this.#t()}#s(f,h){f.href=this.linkService.getAnchorUrl(""),f.onclick=()=>(this.linkService.executeSetOCGState(h),!1),this.#t()}_bindJSAction(f,h){f.href=this.linkService.getAnchorUrl("");const s=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const t of Object.keys(h.actions)){const i=s.get(t);i&&(f[i]=()=>(this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:h.id,name:t}}),!1))}f.onclick||(f.onclick=()=>!1),this.#t()}_bindResetFormAction(f,h){const s=f.onclick;if(s||(f.href=this.linkService.getAnchorUrl("")),this.#t(),!this._fieldObjects){(0,l.warn)('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),s||(f.onclick=()=>!1);return}f.onclick=()=>{s?.();const{fields:t,refs:i,include:a}=h,d=[];if(t.length!==0||i.length!==0){const R=new Set(i);for(const _ of t){const N=this._fieldObjects[_]||[];for(const{id:H}of N)R.add(H)}for(const _ of Object.values(this._fieldObjects))for(const N of _)R.has(N.id)===a&&d.push(N)}else for(const R of Object.values(this._fieldObjects))d.push(...R);const b=this.annotationStorage,S=[];for(const R of d){const{id:_}=R;switch(S.push(_),R.type){case"text":{const H=R.defaultValue||"";b.setValue(_,{value:H});break}case"checkbox":case"radiobutton":{const H=R.defaultValue===R.exportValues;b.setValue(_,{value:H});break}case"combobox":case"listbox":{const H=R.defaultValue||"";b.setValue(_,{value:H});break}default:continue}const N=document.querySelector(`[data-element-id="${_}"]`);if(N){if(!c.has(N)){(0,l.warn)(`_bindResetFormAction - element not allowed: ${_}`);continue}}else continue;N.dispatchEvent(new Event("resetform"))}return this.enableScripting&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:S,name:"ResetForm"}}),!1}}}class r extends m{constructor(f){super(f,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const f=document.createElement("img");return f.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",f.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),f.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(f),this.container}}class u extends m{render(){return this.data.alternativeText&&(this.container.title=this.data.alternativeText),this.container}showElementAndHideCanvas(f){this.data.hasOwnCanvas&&(f.previousSibling?.nodeName==="CANVAS"&&(f.previousSibling.hidden=!0),f.hidden=!1)}_getKeyModifier(f){return l.FeatureTest.platform.isMac?f.metaKey:f.ctrlKey}_setEventListener(f,h,s,t,i){s.includes("mouse")?f.addEventListener(s,a=>{this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:t,value:i(a),shift:a.shiftKey,modifier:this._getKeyModifier(a)}})}):f.addEventListener(s,a=>{if(s==="blur"){if(!h.focused||!a.relatedTarget)return;h.focused=!1}else if(s==="focus"){if(h.focused)return;h.focused=!0}i&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:t,value:i(a)}})})}_setEventListeners(f,h,s,t){for(const[i,a]of s)(a==="Action"||this.data.actions?.[a])&&((a==="Focus"||a==="Blur")&&(h||={focused:!1}),this._setEventListener(f,h,i,a,t),a==="Focus"&&!this.data.actions?.Blur?this._setEventListener(f,h,"blur","Blur",null):a==="Blur"&&!this.data.actions?.Focus&&this._setEventListener(f,h,"focus","Focus",null))}_setBackgroundColor(f){const h=this.data.backgroundColor||null;f.style.backgroundColor=h===null?"transparent":l.Util.makeHexColor(h[0],h[1],h[2])}_setTextStyle(f){const h=["left","center","right"],{fontColor:s}=this.data.defaultAppearanceData,t=this.data.defaultAppearanceData.fontSize||o,i=f.style;let a;const d=2,b=S=>Math.round(10*S)/10;if(this.data.multiLine){const S=Math.abs(this.data.rect[3]-this.data.rect[1]-d),R=Math.round(S/(l.LINE_FACTOR*t))||1,_=S/R;a=Math.min(t,b(_/l.LINE_FACTOR))}else{const S=Math.abs(this.data.rect[3]-this.data.rect[1]-d);a=Math.min(t,b(S/l.LINE_FACTOR))}i.fontSize=`calc(${a}px * var(--scale-factor))`,i.color=l.Util.makeHexColor(s[0],s[1],s[2]),this.data.textAlignment!==null&&(i.textAlign=h[this.data.textAlignment])}_setRequired(f,h){h?f.setAttribute("required",!0):f.removeAttribute("required"),f.setAttribute("aria-required",h)}}class w extends u{constructor(f){const h=f.renderForms||f.data.hasOwnCanvas||!f.data.hasAppearance&&!!f.data.fieldValue;super(f,{isRenderable:h})}setPropertyOnSiblings(f,h,s,t){const i=this.annotationStorage;for(const a of this._getElementsByName(f.name,f.id))a.domElement&&(a.domElement[h]=s),i.setValue(a.id,{[t]:s})}render(){const f=this.annotationStorage,h=this.data.id;this.container.classList.add("textWidgetAnnotation");let s=null;if(this.renderForms){const t=f.getValue(h,{value:this.data.fieldValue});let i=t.value||"";const a=f.getValue(h,{charLimit:this.data.maxLen}).charLimit;a&&i.length>a&&(i=i.slice(0,a));let d=t.formattedValue||this.data.textContent?.join(`
`)||null;d&&this.data.comb&&(d=d.replaceAll(/\s+/g,""));const b={userValue:i,formattedValue:d,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(s=document.createElement("textarea"),s.textContent=d??i,this.data.doNotScroll&&(s.style.overflowY="hidden")):(s=document.createElement("input"),s.type="text",s.setAttribute("value",d??i),this.data.doNotScroll&&(s.style.overflowX="hidden")),this.data.hasOwnCanvas&&(s.hidden=!0),c.add(s),s.setAttribute("data-element-id",h),s.disabled=this.data.readOnly,s.name=this.data.fieldName,s.tabIndex=g,this._setRequired(s,this.data.required),a&&(s.maxLength=a),s.addEventListener("input",R=>{f.setValue(h,{value:R.target.value}),this.setPropertyOnSiblings(s,"value",R.target.value,"value"),b.formattedValue=null}),s.addEventListener("resetform",R=>{const _=this.data.defaultFieldValue??"";s.value=b.userValue=_,b.formattedValue=null});let S=R=>{const{formattedValue:_}=b;_!=null&&(R.target.value=_),R.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){s.addEventListener("focus",_=>{if(b.focused)return;const{target:N}=_;b.userValue&&(N.value=b.userValue),b.lastCommittedValue=N.value,b.commitKey=1,this.data.actions?.Focus||(b.focused=!0)}),s.addEventListener("updatefromsandbox",_=>{this.showElementAndHideCanvas(_.target);const N={value(H){b.userValue=H.detail.value??"",f.setValue(h,{value:b.userValue.toString()}),H.target.value=b.userValue},formattedValue(H){const{formattedValue:V}=H.detail;b.formattedValue=V,V!=null&&H.target!==document.activeElement&&(H.target.value=V),f.setValue(h,{formattedValue:V})},selRange(H){H.target.setSelectionRange(...H.detail.selRange)},charLimit:H=>{const{charLimit:V}=H.detail,{target:B}=H;if(V===0){B.removeAttribute("maxLength");return}B.setAttribute("maxLength",V);let F=b.userValue;!F||F.length<=V||(F=F.slice(0,V),B.value=b.userValue=F,f.setValue(h,{value:F}),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:h,name:"Keystroke",value:F,willCommit:!0,commitKey:1,selStart:B.selectionStart,selEnd:B.selectionEnd}}))}};this._dispatchEventFromSandbox(N,_)}),s.addEventListener("keydown",_=>{b.commitKey=1;let N=-1;if(_.key==="Escape"?N=0:_.key==="Enter"&&!this.data.multiLine?N=2:_.key==="Tab"&&(b.commitKey=3),N===-1)return;const{value:H}=_.target;b.lastCommittedValue!==H&&(b.lastCommittedValue=H,b.userValue=H,this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:h,name:"Keystroke",value:H,willCommit:!0,commitKey:N,selStart:_.target.selectionStart,selEnd:_.target.selectionEnd}}))});const R=S;S=null,s.addEventListener("blur",_=>{if(!b.focused||!_.relatedTarget)return;this.data.actions?.Blur||(b.focused=!1);const{value:N}=_.target;b.userValue=N,b.lastCommittedValue!==N&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:h,name:"Keystroke",value:N,willCommit:!0,commitKey:b.commitKey,selStart:_.target.selectionStart,selEnd:_.target.selectionEnd}}),R(_)}),this.data.actions?.Keystroke&&s.addEventListener("beforeinput",_=>{b.lastCommittedValue=null;const{data:N,target:H}=_,{value:V,selectionStart:B,selectionEnd:F}=H;let O=B,Y=F;switch(_.inputType){case"deleteWordBackward":{const j=V.substring(0,B).match(/\w*[^\w]*$/);j&&(O-=j[0].length);break}case"deleteWordForward":{const j=V.substring(B).match(/^[^\w]*\w*/);j&&(Y+=j[0].length);break}case"deleteContentBackward":B===F&&(O-=1);break;case"deleteContentForward":B===F&&(Y+=1);break}_.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:h,name:"Keystroke",value:V,change:N||"",willCommit:!1,selStart:O,selEnd:Y}})}),this._setEventListeners(s,b,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],_=>_.target.value)}if(S&&s.addEventListener("blur",S),this.data.comb){const _=(this.data.rect[2]-this.data.rect[0])/a;s.classList.add("comb"),s.style.letterSpacing=`calc(${_}px * var(--scale-factor) - 1ch)`}}else s=document.createElement("div"),s.textContent=this.data.fieldValue,s.style.verticalAlign="middle",s.style.display="table-cell",this.data.hasOwnCanvas&&(s.hidden=!0);return this._setTextStyle(s),this._setBackgroundColor(s),this._setDefaultPropertiesFromJS(s),this.container.append(s),this.container}}class A extends u{constructor(f){super(f,{isRenderable:!!f.data.hasOwnCanvas})}}class I extends u{constructor(f){super(f,{isRenderable:f.renderForms})}render(){const f=this.annotationStorage,h=this.data,s=h.id;let t=f.getValue(s,{value:h.exportValue===h.fieldValue}).value;typeof t=="string"&&(t=t!=="Off",f.setValue(s,{value:t})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const i=document.createElement("input");return c.add(i),i.setAttribute("data-element-id",s),i.disabled=h.readOnly,this._setRequired(i,this.data.required),i.type="checkbox",i.name=h.fieldName,t&&i.setAttribute("checked",!0),i.setAttribute("exportValue",h.exportValue),i.tabIndex=g,i.addEventListener("change",a=>{const{name:d,checked:b}=a.target;for(const S of this._getElementsByName(d,s)){const R=b&&S.exportValue===h.exportValue;S.domElement&&(S.domElement.checked=R),f.setValue(S.id,{value:R})}f.setValue(s,{value:b})}),i.addEventListener("resetform",a=>{const d=h.defaultFieldValue||"Off";a.target.checked=d===h.exportValue}),this.enableScripting&&this.hasJSActions&&(i.addEventListener("updatefromsandbox",a=>{const d={value(b){b.target.checked=b.detail.value!=="Off",f.setValue(s,{value:b.target.checked})}};this._dispatchEventFromSandbox(d,a)}),this._setEventListeners(i,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],a=>a.target.checked)),this._setBackgroundColor(i),this._setDefaultPropertiesFromJS(i),this.container.append(i),this.container}}class k extends u{constructor(f){super(f,{isRenderable:f.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const f=this.annotationStorage,h=this.data,s=h.id;let t=f.getValue(s,{value:h.fieldValue===h.buttonValue}).value;if(typeof t=="string"&&(t=t!==h.buttonValue,f.setValue(s,{value:t})),t)for(const a of this._getElementsByName(h.fieldName,s))f.setValue(a.id,{value:!1});const i=document.createElement("input");if(c.add(i),i.setAttribute("data-element-id",s),i.disabled=h.readOnly,this._setRequired(i,this.data.required),i.type="radio",i.name=h.fieldName,t&&i.setAttribute("checked",!0),i.tabIndex=g,i.addEventListener("change",a=>{const{name:d,checked:b}=a.target;for(const S of this._getElementsByName(d,s))f.setValue(S.id,{value:!1});f.setValue(s,{value:b})}),i.addEventListener("resetform",a=>{const d=h.defaultFieldValue;a.target.checked=d!=null&&d===h.buttonValue}),this.enableScripting&&this.hasJSActions){const a=h.buttonValue;i.addEventListener("updatefromsandbox",d=>{const b={value:S=>{const R=a===S.detail.value;for(const _ of this._getElementsByName(S.target.name)){const N=R&&_.id===s;_.domElement&&(_.domElement.checked=N),f.setValue(_.id,{value:N})}}};this._dispatchEventFromSandbox(b,d)}),this._setEventListeners(i,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],d=>d.target.checked)}return this._setBackgroundColor(i),this._setDefaultPropertiesFromJS(i),this.container.append(i),this.container}}class M extends e{constructor(f){super(f,{ignoreBorder:f.data.hasAppearance})}render(){const f=super.render();f.classList.add("buttonWidgetAnnotation","pushButton"),this.data.alternativeText&&(f.title=this.data.alternativeText);const h=f.lastChild;return this.enableScripting&&this.hasJSActions&&h&&(this._setDefaultPropertiesFromJS(h),h.addEventListener("updatefromsandbox",s=>{this._dispatchEventFromSandbox({},s)})),f}}class z extends u{constructor(f){super(f,{isRenderable:f.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const f=this.annotationStorage,h=this.data.id,s=f.getValue(h,{value:this.data.fieldValue}),t=document.createElement("select");c.add(t),t.setAttribute("data-element-id",h),t.disabled=this.data.readOnly,this._setRequired(t,this.data.required),t.name=this.data.fieldName,t.tabIndex=g;let i=this.data.combo&&this.data.options.length>0;this.data.combo||(t.size=this.data.options.length,this.data.multiSelect&&(t.multiple=!0)),t.addEventListener("resetform",R=>{const _=this.data.defaultFieldValue;for(const N of t.options)N.selected=N.value===_});for(const R of this.data.options){const _=document.createElement("option");_.textContent=R.displayValue,_.value=R.exportValue,s.value.includes(R.exportValue)&&(_.setAttribute("selected",!0),i=!1),t.append(_)}let a=null;if(i){const R=document.createElement("option");R.value=" ",R.setAttribute("hidden",!0),R.setAttribute("selected",!0),t.prepend(R),a=()=>{R.remove(),t.removeEventListener("input",a),a=null},t.addEventListener("input",a)}const d=R=>{const _=R?"value":"textContent",{options:N,multiple:H}=t;return H?Array.prototype.filter.call(N,V=>V.selected).map(V=>V[_]):N.selectedIndex===-1?null:N[N.selectedIndex][_]};let b=d(!1);const S=R=>{const _=R.target.options;return Array.prototype.map.call(_,N=>({displayValue:N.textContent,exportValue:N.value}))};return this.enableScripting&&this.hasJSActions?(t.addEventListener("updatefromsandbox",R=>{const _={value(N){a?.();const H=N.detail.value,V=new Set(Array.isArray(H)?H:[H]);for(const B of t.options)B.selected=V.has(B.value);f.setValue(h,{value:d(!0)}),b=d(!1)},multipleSelection(N){t.multiple=!0},remove(N){const H=t.options,V=N.detail.remove;H[V].selected=!1,t.remove(V),H.length>0&&Array.prototype.findIndex.call(H,F=>F.selected)===-1&&(H[0].selected=!0),f.setValue(h,{value:d(!0),items:S(N)}),b=d(!1)},clear(N){for(;t.length!==0;)t.remove(0);f.setValue(h,{value:null,items:[]}),b=d(!1)},insert(N){const{index:H,displayValue:V,exportValue:B}=N.detail.insert,F=t.children[H],O=document.createElement("option");O.textContent=V,O.value=B,F?F.before(O):t.append(O),f.setValue(h,{value:d(!0),items:S(N)}),b=d(!1)},items(N){const{items:H}=N.detail;for(;t.length!==0;)t.remove(0);for(const V of H){const{displayValue:B,exportValue:F}=V,O=document.createElement("option");O.textContent=B,O.value=F,t.append(O)}t.options.length>0&&(t.options[0].selected=!0),f.setValue(h,{value:d(!0),items:S(N)}),b=d(!1)},indices(N){const H=new Set(N.detail.indices);for(const V of N.target.options)V.selected=H.has(V.index);f.setValue(h,{value:d(!0)}),b=d(!1)},editable(N){N.target.disabled=!N.detail.editable}};this._dispatchEventFromSandbox(_,R)}),t.addEventListener("input",R=>{const _=d(!0);f.setValue(h,{value:_}),R.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:h,name:"Keystroke",value:b,changeEx:_,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(t,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],R=>R.target.value)):t.addEventListener("input",function(R){f.setValue(h,{value:d(!0)})}),this.data.combo&&this._setTextStyle(t),this._setBackgroundColor(t),this._setDefaultPropertiesFromJS(t),this.container.append(t),this.container}}class G extends m{constructor(f){const{data:h,elements:s}=f;super(f,{isRenderable:m._hasPopupData(h)}),this.elements=s}render(){this.container.classList.add("popupAnnotation");const f=new X({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),h=[];for(const s of this.elements)s.popup=f,h.push(s.data.id),s.addHighlightArea();return this.container.setAttribute("aria-controls",h.map(s=>`${l.AnnotationPrefix}${s}`).join(",")),this.container}}class X{#t=this.#A.bind(this);#e=this.#g.bind(this);#s=this.#v.bind(this);#i=this.#y.bind(this);#n=null;#r=null;#o=null;#l=null;#h=null;#c=null;#f=null;#u=!1;#d=null;#a=null;#p=null;#m=null;#b=!1;constructor({container:f,color:h,elements:s,titleObj:t,modificationDate:i,contentsObj:a,richText:d,parent:b,rect:S,parentRect:R,open:_}){this.#r=f,this.#m=t,this.#o=a,this.#p=d,this.#c=b,this.#n=h,this.#a=S,this.#f=R,this.#h=s,this.#l=D.PDFDateString.toDateObject(i),this.trigger=s.flatMap(N=>N.getElementsToTriggerPopup());for(const N of this.trigger)N.addEventListener("click",this.#i),N.addEventListener("mouseenter",this.#s),N.addEventListener("mouseleave",this.#e),N.classList.add("popupTriggerArea");for(const N of s)N.container?.addEventListener("keydown",this.#t);this.#r.hidden=!0,_&&this.#y()}render(){if(this.#d)return;const{page:{view:f},viewport:{rawDims:{pageWidth:h,pageHeight:s,pageX:t,pageY:i}}}=this.#c,a=this.#d=document.createElement("div");if(a.className="popup",this.#n){const j=a.style.outlineColor=l.Util.makeHexColor(...this.#n);CSS.supports("background-color","color-mix(in srgb, red 30%, white)")?a.style.backgroundColor=`color-mix(in srgb, ${j} 30%, white)`:a.style.backgroundColor=l.Util.makeHexColor(...this.#n.map(st=>Math.floor(.7*(255-st)+st)))}const d=document.createElement("span");d.className="header";const b=document.createElement("h1");if(d.append(b),{dir:b.dir,str:b.textContent}=this.#m,a.append(d),this.#l){const j=document.createElement("span");j.classList.add("popupDate"),j.setAttribute("data-l10n-id","pdfjs-annotation-date-string"),j.setAttribute("data-l10n-args",JSON.stringify({date:this.#l.toLocaleDateString(),time:this.#l.toLocaleTimeString()})),d.append(j)}const S=this.#o,R=this.#p;if(R?.str&&(!S?.str||S.str===R.str))v.XfaLayer.render({xfaHtml:R.html,intent:"richText",div:a}),a.lastChild.classList.add("richText","popupContent");else{const j=this._formatContents(S);a.append(j)}let _=!!this.#f,N=_?this.#f:this.#a;for(const j of this.#h)if(!N||l.Util.intersect(j.data.rect,N)!==null){N=j.data.rect,_=!0;break}const H=l.Util.normalizeRect([N[0],f[3]-N[1]+f[1],N[2],f[3]-N[3]+f[1]]),V=5,B=_?N[2]-N[0]+V:0,F=H[0]+B,O=H[1],{style:Y}=this.#r;Y.left=`${100*(F-t)/h}%`,Y.top=`${100*(O-i)/s}%`,this.#r.append(a)}_formatContents({str:f,dir:h}){const s=document.createElement("p");s.classList.add("popupContent"),s.dir=h;const t=f.split(/(?:\r\n?|\n)/);for(let i=0,a=t.length;i<a;++i){const d=t[i];s.append(document.createTextNode(d)),i<a-1&&s.append(document.createElement("br"))}return s}#A(f){f.altKey||f.shiftKey||f.ctrlKey||f.metaKey||(f.key==="Enter"||f.key==="Escape"&&this.#u)&&this.#y()}#y(){this.#u=!this.#u,this.#u?(this.#v(),this.#r.addEventListener("click",this.#i),this.#r.addEventListener("keydown",this.#t)):(this.#g(),this.#r.removeEventListener("click",this.#i),this.#r.removeEventListener("keydown",this.#t))}#v(){this.#d||this.render(),this.isVisible?this.#u&&this.#r.classList.add("focused"):(this.#r.hidden=!1,this.#r.style.zIndex=parseInt(this.#r.style.zIndex)+1e3)}#g(){this.#r.classList.remove("focused"),!(this.#u||!this.isVisible)&&(this.#r.hidden=!0,this.#r.style.zIndex=parseInt(this.#r.style.zIndex)-1e3)}forceHide(){this.#b=this.isVisible,this.#b&&(this.#r.hidden=!0)}maybeShow(){this.#b&&(this.#b=!1,this.#r.hidden=!1)}get isVisible(){return this.#r.hidden===!1}}class q extends m{constructor(f){super(f,{isRenderable:!0,ignoreBorder:!0}),this.textContent=f.data.textContent,this.textPosition=f.data.textPosition,this.annotationEditorType=l.AnnotationEditorType.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const f=document.createElement("div");f.classList.add("annotationTextContent"),f.setAttribute("role","comment");for(const h of this.textContent){const s=document.createElement("span");s.textContent=h,f.append(s)}this.container.append(f)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}get _isEditable(){return this.data.hasOwnCanvas}}class et extends m{#t=null;constructor(f){super(f,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("lineAnnotation");const f=this.data,{width:h,height:s}=p(f.rect),t=this.svgFactory.create(h,s,!0),i=this.#t=this.svgFactory.createElement("svg:line");return i.setAttribute("x1",f.rect[2]-f.lineCoordinates[0]),i.setAttribute("y1",f.rect[3]-f.lineCoordinates[1]),i.setAttribute("x2",f.rect[2]-f.lineCoordinates[2]),i.setAttribute("y2",f.rect[3]-f.lineCoordinates[3]),i.setAttribute("stroke-width",f.borderStyle.width||1),i.setAttribute("stroke","transparent"),i.setAttribute("fill","transparent"),t.append(i),this.container.append(t),!f.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class at extends m{#t=null;constructor(f){super(f,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("squareAnnotation");const f=this.data,{width:h,height:s}=p(f.rect),t=this.svgFactory.create(h,s,!0),i=f.borderStyle.width,a=this.#t=this.svgFactory.createElement("svg:rect");return a.setAttribute("x",i/2),a.setAttribute("y",i/2),a.setAttribute("width",h-i),a.setAttribute("height",s-i),a.setAttribute("stroke-width",i||1),a.setAttribute("stroke","transparent"),a.setAttribute("fill","transparent"),t.append(a),this.container.append(t),!f.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class W extends m{#t=null;constructor(f){super(f,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("circleAnnotation");const f=this.data,{width:h,height:s}=p(f.rect),t=this.svgFactory.create(h,s,!0),i=f.borderStyle.width,a=this.#t=this.svgFactory.createElement("svg:ellipse");return a.setAttribute("cx",h/2),a.setAttribute("cy",s/2),a.setAttribute("rx",h/2-i/2),a.setAttribute("ry",s/2-i/2),a.setAttribute("stroke-width",i||1),a.setAttribute("stroke","transparent"),a.setAttribute("fill","transparent"),t.append(a),this.container.append(t),!f.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class $ extends m{#t=null;constructor(f){super(f,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const f=this.data,{width:h,height:s}=p(f.rect),t=this.svgFactory.create(h,s,!0);let i=[];for(const d of f.vertices){const b=d.x-f.rect[0],S=f.rect[3]-d.y;i.push(b+","+S)}i=i.join(" ");const a=this.#t=this.svgFactory.createElement(this.svgElementName);return a.setAttribute("points",i),a.setAttribute("stroke-width",f.borderStyle.width||1),a.setAttribute("stroke","transparent"),a.setAttribute("fill","transparent"),t.append(a),this.container.append(t),!f.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class U extends ${constructor(f){super(f),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class J extends m{constructor(f){super(f,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}class Z extends m{#t=[];constructor(f){super(f,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=l.AnnotationEditorType.INK}render(){this.container.classList.add(this.containerClassName);const f=this.data,{width:h,height:s}=p(f.rect),t=this.svgFactory.create(h,s,!0);for(const i of f.inkLists){let a=[];for(const b of i){const S=b.x-f.rect[0],R=f.rect[3]-b.y;a.push(`${S},${R}`)}a=a.join(" ");const d=this.svgFactory.createElement(this.svgElementName);this.#t.push(d),d.setAttribute("points",a),d.setAttribute("stroke-width",f.borderStyle.width||1),d.setAttribute("stroke","transparent"),d.setAttribute("fill","transparent"),!f.popupRef&&this.hasPopupData&&this._createPopup(),t.append(d)}return this.container.append(t),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class tt extends m{constructor(f){super(f,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this.container}}class ft extends m{constructor(f){super(f,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),this.container}}class lt extends m{constructor(f){super(f,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),this.container}}class ot extends m{constructor(f){super(f,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),this.container}}class gt extends m{constructor(f){super(f,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("stampAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}class dt extends m{#t=null;constructor(f){super(f,{isRenderable:!0});const{filename:h,content:s}=this.data.file;this.filename=(0,D.getFilenameFromUrl)(h,!0),this.content=s,this.linkService.eventBus?.dispatch("fileattachmentannotation",{source:this,filename:h,content:s})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:f,data:h}=this;let s;h.hasAppearance||h.fillAlpha===0?s=document.createElement("div"):(s=document.createElement("img"),s.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(h.name)?"paperclip":"pushpin"}.svg`,h.fillAlpha&&h.fillAlpha<1&&(s.style=`filter: opacity(${Math.round(h.fillAlpha*100)}%);`)),s.addEventListener("dblclick",this.#e.bind(this)),this.#t=s;const{isMac:t}=l.FeatureTest.platform;return f.addEventListener("keydown",i=>{i.key==="Enter"&&(t?i.metaKey:i.ctrlKey)&&this.#e()}),!h.popupRef&&this.hasPopupData?this._createPopup():s.classList.add("popupTriggerArea"),f.append(s),f}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}#e(){this.downloadManager?.openOrDownloadData(this.content,this.filename)}}class ct{#t=null;#e=null;#s=new Map;constructor({div:f,accessibilityManager:h,annotationCanvasMap:s,page:t,viewport:i}){this.div=f,this.#t=h,this.#e=s,this.page=t,this.viewport=i,this.zIndex=0}#i(f,h){const s=f.firstChild||f;s.id=`${l.AnnotationPrefix}${h}`,this.div.append(f),this.#t?.moveElementInDOM(this.div,f,s,!1)}async render(f){const{annotations:h}=f,s=this.div;(0,D.setLayerDimensions)(s,this.viewport);const t=new Map,i={data:null,layer:s,linkService:f.linkService,downloadManager:f.downloadManager,imageResourcesPath:f.imageResourcesPath||"",renderForms:f.renderForms!==!1,svgFactory:new D.DOMSVGFactory,annotationStorage:f.annotationStorage||new y.AnnotationStorage,enableScripting:f.enableScripting===!0,hasJSActions:f.hasJSActions,fieldObjects:f.fieldObjects,parent:this,elements:null};for(const a of h){if(a.noHTML)continue;const d=a.annotationType===l.AnnotationType.POPUP;if(d){const R=t.get(a.id);if(!R)continue;i.elements=R}else{const{width:R,height:_}=p(a.rect);if(R<=0||_<=0)continue}i.data=a;const b=n.create(i);if(!b.isRenderable)continue;if(!d&&a.popupRef){const R=t.get(a.popupRef);R?R.push(b):t.set(a.popupRef,[b])}b.annotationEditorType>0&&this.#s.set(b.data.id,b);const S=b.render();a.hidden&&(S.style.visibility="hidden"),this.#i(S,a.id)}this.#n()}update({viewport:f}){const h=this.div;this.viewport=f,(0,D.setLayerDimensions)(h,{rotation:f.rotation}),this.#n(),h.hidden=!1}#n(){if(!this.#e)return;const f=this.div;for(const[h,s]of this.#e){const t=f.querySelector(`[data-annotation-id="${h}"]`);if(!t)continue;const{firstChild:i}=t;i?i.nodeName==="CANVAS"?i.replaceWith(s):i.before(s):t.append(s)}this.#e.clear()}getEditableAnnotations(){return Array.from(this.#s.values())}getEditableAnnotation(f){return this.#s.get(f)}}},780:(L,C,x)=>{x.d(C,{AnnotationStorage:()=>E,PrintAnnotationStorage:()=>T,SerializableEmpty:()=>P});var l=x(266),D=x(115),y=x(825);const P=Object.freeze({map:null,hash:"",transfer:void 0});class E{#t=!1;#e=new Map;constructor(){this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(g,o){const c=this.#e.get(g);return c===void 0?o:Object.assign(o,c)}getRawValue(g){return this.#e.get(g)}remove(g){if(this.#e.delete(g),this.#e.size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function"){for(const o of this.#e.values())if(o instanceof D.AnnotationEditor)return;this.onAnnotationEditor(null)}}setValue(g,o){const c=this.#e.get(g);let p=!1;if(c!==void 0)for(const[n,m]of Object.entries(o))c[n]!==m&&(p=!0,c[n]=m);else p=!0,this.#e.set(g,o);p&&this.#s(),o instanceof D.AnnotationEditor&&typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(o.constructor._type)}has(g){return this.#e.has(g)}getAll(){return this.#e.size>0?(0,l.objectFromMap)(this.#e):null}setAll(g){for(const[o,c]of Object.entries(g))this.setValue(o,c)}get size(){return this.#e.size}#s(){this.#t||(this.#t=!0,typeof this.onSetModified=="function"&&this.onSetModified())}resetModified(){this.#t&&(this.#t=!1,typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new T(this)}get serializable(){if(this.#e.size===0)return P;const g=new Map,o=new y.MurmurHash3_64,c=[],p=Object.create(null);let n=!1;for(const[m,e]of this.#e){const r=e instanceof D.AnnotationEditor?e.serialize(!1,p):e;r&&(g.set(m,r),o.update(`${m}:${JSON.stringify(r)}`),n||=!!r.bitmap)}if(n)for(const m of g.values())m.bitmap&&c.push(m.bitmap);return g.size>0?{map:g,hash:o.hexdigest(),transfer:c}:P}}class T extends E{#t;constructor(g){super();const{map:o,hash:c,transfer:p}=g.serializable,n=structuredClone(o,p?{transfer:p}:null);this.#t={map:n,hash:c,transfer:p}}get print(){(0,l.unreachable)("Should not call PrintAnnotationStorage.print")}get serializable(){return this.#t}}},406:(L,C,x)=>{x.a(L,async(l,D)=>{try{let et=function(s){if(typeof s=="string"||s instanceof URL?s={url:s}:(0,y.isArrayBuffer)(s)&&(s={data:s}),typeof s!="object")throw new Error("Invalid parameter in getDocument, need parameter object.");if(!s.url&&!s.data&&!s.range)throw new Error("Invalid parameter object: need either .data, .range or .url");const t=new U,{docId:i}=t,a=s.url?W(s.url):null,d=s.data?$(s.data):null,b=s.httpHeaders||null,S=s.withCredentials===!0,R=s.password??null,_=s.range instanceof J?s.range:null,N=Number.isInteger(s.rangeChunkSize)&&s.rangeChunkSize>0?s.rangeChunkSize:I;let H=s.worker instanceof ot?s.worker:null;const V=s.verbosity,B=typeof s.docBaseUrl=="string"&&!(0,E.isDataScheme)(s.docBaseUrl)?s.docBaseUrl:null,F=typeof s.cMapUrl=="string"?s.cMapUrl:null,O=s.cMapPacked!==!1,Y=s.CMapReaderFactory||G,j=typeof s.standardFontDataUrl=="string"?s.standardFontDataUrl:null,Q=s.StandardFontDataFactory||q,st=s.stopAtErrors!==!0,it=Number.isInteger(s.maxImageSize)&&s.maxImageSize>-1?s.maxImageSize:-1,rt=s.isEvalSupported!==!1,nt=typeof s.isOffscreenCanvasSupported=="boolean"?s.isOffscreenCanvasSupported:!y.isNodeJS,ht=Number.isInteger(s.canvasMaxAreaInBytes)?s.canvasMaxAreaInBytes:-1,mt=typeof s.disableFontFace=="boolean"?s.disableFontFace:y.isNodeJS,At=s.fontExtraProperties===!0,St=s.enableXfa===!0,pt=s.ownerDocument||globalThis.document,Mt=s.disableRange===!0,Ft=s.disableStream===!0,It=s.disableAutoFetch===!0,xt=s.pdfBug===!0,Tt=_?_.length:s.length??NaN,Ct=typeof s.useSystemFonts=="boolean"?s.useSystemFonts:!y.isNodeJS&&!mt,_t=typeof s.useWorkerFetch=="boolean"?s.useWorkerFetch:Y===E.DOMCMapReaderFactory&&Q===E.DOMStandardFontDataFactory&&F&&j&&(0,E.isValidFetchUrl)(F,document.baseURI)&&(0,E.isValidFetchUrl)(j,document.baseURI),zt=s.canvasFactory||new z({ownerDocument:pt}),se=s.filterFactory||new X({docId:i,ownerDocument:pt}),ie=null;(0,y.setVerbosityLevel)(V);const Dt={canvasFactory:zt,filterFactory:se};if(_t||(Dt.cMapReaderFactory=new Y({baseUrl:F,isCompressed:O}),Dt.standardFontDataFactory=new Q({baseUrl:j})),!H){const Vt={verbosity:V,port:o.GlobalWorkerOptions.workerPort};H=Vt.port?ot.fromPort(Vt):new ot(Vt),t._worker=H}const Pt={docId:i,apiVersion:"4.0.379",data:d,password:R,disableAutoFetch:It,rangeChunkSize:N,length:Tt,docBaseUrl:B,enableXfa:St,evaluatorOptions:{maxImageSize:it,disableFontFace:mt,ignoreErrors:st,isEvalSupported:rt,isOffscreenCanvasSupported:nt,canvasMaxAreaInBytes:ht,fontExtraProperties:At,useSystemFonts:Ct,cMapUrl:_t?F:null,standardFontDataUrl:_t?j:null}},ne={ignoreErrors:st,isEvalSupported:rt,disableFontFace:mt,fontExtraProperties:At,enableXfa:St,ownerDocument:pt,disableAutoFetch:It,pdfBug:xt,styleElement:ie};return H.promise.then(function(){if(t.destroyed)throw new Error("Loading aborted");const Vt=at(H,Pt),jt=new Promise(function(Rt){let Zt;_?Zt=new m.PDFDataTransportStream({length:Tt,initialData:_.initialData,progressiveDone:_.progressiveDone,contentDispositionFilename:_.contentDispositionFilename,disableRange:Mt,disableStream:Ft},_):d||(Zt=(Yt=>y.isNodeJS?new u.PDFNodeStream(Yt):(0,E.isValidFetchUrl)(Yt.url)?new e.PDFFetchStream(Yt):new r.PDFNetworkStream(Yt))({url:a,length:Tt,httpHeaders:b,withCredentials:S,rangeChunkSize:N,disableRange:Mt,disableStream:Ft})),Rt(Zt)});return Promise.all([Vt,jt]).then(function([Rt,Zt]){if(t.destroyed)throw new Error("Loading aborted");const he=new c.MessageHandler(i,Rt,H.port),Yt=new gt(he,t,Zt,ne,Dt);t._transport=Yt,he.send("Ready",null)})}).catch(t._capability.reject),t},W=function(s){if(s instanceof URL)return s.href;try{return new URL(s,window.location).href}catch{if(y.isNodeJS&&typeof s=="string")return s}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")},$=function(s){if(y.isNodeJS&&typeof Buffer<"u"&&s instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(s instanceof Uint8Array&&s.byteLength===s.buffer.byteLength)return s;if(typeof s=="string")return(0,y.stringToBytes)(s);if(typeof s=="object"&&!isNaN(s?.length)||(0,y.isArrayBuffer)(s))return new Uint8Array(s);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")};x.d(C,{PDFDataRangeTransport:()=>J,PDFWorker:()=>ot,build:()=>h,getDocument:()=>et,version:()=>f});var y=x(266),P=x(780),E=x(473),T=x(742),v=x(738),g=x(250),o=x(368),c=x(694),p=x(472),n=x(890),m=x(92),e=x(171),r=x(474),u=x(498),w=x(521),A=l([v,u]);[v,u]=A.then?(await A)():A;const I=65536,k=100,M=5e3,z=y.isNodeJS?v.NodeCanvasFactory:E.DOMCanvasFactory,G=y.isNodeJS?v.NodeCMapReaderFactory:E.DOMCMapReaderFactory,X=y.isNodeJS?v.NodeFilterFactory:E.DOMFilterFactory,q=y.isNodeJS?v.NodeStandardFontDataFactory:E.DOMStandardFontDataFactory;async function at(s,t){if(s.destroyed)throw new Error("Worker was destroyed");const i=await s.messageHandler.sendWithPromise("GetDocRequest",t,t.data?[t.data.buffer]:null);if(s.destroyed)throw new Error("Worker was destroyed");return i}class U{static#t=0;constructor(){this._capability=new y.PromiseCapability,this._transport=null,this._worker=null,this.docId=`d${U.#t++}`,this.destroyed=!1,this.onPassword=null,this.onProgress=null}get promise(){return this._capability.promise}async destroy(){this.destroyed=!0;try{this._worker?.port&&(this._worker._pendingDestroy=!0),await this._transport?.destroy()}catch(t){throw this._worker?.port&&delete this._worker._pendingDestroy,t}this._transport=null,this._worker&&(this._worker.destroy(),this._worker=null)}}class J{constructor(t,i,a=!1,d=null){this.length=t,this.initialData=i,this.progressiveDone=a,this.contentDispositionFilename=d,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=new y.PromiseCapability}addRangeListener(t){this._rangeListeners.push(t)}addProgressListener(t){this._progressListeners.push(t)}addProgressiveReadListener(t){this._progressiveReadListeners.push(t)}addProgressiveDoneListener(t){this._progressiveDoneListeners.push(t)}onDataRange(t,i){for(const a of this._rangeListeners)a(t,i)}onDataProgress(t,i){this._readyCapability.promise.then(()=>{for(const a of this._progressListeners)a(t,i)})}onDataProgressiveRead(t){this._readyCapability.promise.then(()=>{for(const i of this._progressiveReadListeners)i(t)})}onDataProgressiveDone(){this._readyCapability.promise.then(()=>{for(const t of this._progressiveDoneListeners)t()})}transportReady(){this._readyCapability.resolve()}requestDataRange(t,i){(0,y.unreachable)("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}class Z{constructor(t,i){this._pdfInfo=t,this._transport=i}get annotationStorage(){return this._transport.annotationStorage}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return(0,y.shadow)(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(t){return this._transport.getPage(t)}getPageIndex(t){return this._transport.getPageIndex(t)}getDestinations(){return this._transport.getDestinations()}getDestination(t){return this._transport.getDestination(t)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig(){return this._transport.getOptionalContentConfig()}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(t=!1){return this._transport.startCleanup(t||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}class tt{#t=null;#e=!1;constructor(t,i,a,d=!1){this._pageIndex=t,this._pageInfo=i,this._transport=a,this._stats=d?new E.StatTimer:null,this._pdfBug=d,this.commonObjs=a.commonObjs,this.objs=new dt,this._maybeCleanupAfterRender=!1,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:t,rotation:i=this.rotate,offsetX:a=0,offsetY:d=0,dontFlip:b=!1}={}){return new E.PageViewport({viewBox:this.view,scale:t,rotation:i,offsetX:a,offsetY:d,dontFlip:b})}getAnnotations({intent:t="display"}={}){const i=this._transport.getRenderingIntent(t);return this._transport.getAnnotations(this._pageIndex,i.renderingIntent)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return(0,y.shadow)(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){return this._transport._htmlForXfa?.children[this._pageIndex]||null}render({canvasContext:t,viewport:i,intent:a="display",annotationMode:d=y.AnnotationMode.ENABLE,transform:b=null,background:S=null,optionalContentConfigPromise:R=null,annotationCanvasMap:_=null,pageColors:N=null,printAnnotationStorage:H=null}){this._stats?.time("Overall");const V=this._transport.getRenderingIntent(a,d,H);this.#e=!1,this.#i(),R||(R=this._transport.getOptionalContentConfig());let B=this._intentStates.get(V.cacheKey);B||(B=Object.create(null),this._intentStates.set(V.cacheKey,B)),B.streamReaderCancelTimeout&&(clearTimeout(B.streamReaderCancelTimeout),B.streamReaderCancelTimeout=null);const F=!!(V.renderingIntent&y.RenderingIntentFlag.PRINT);B.displayReadyCapability||(B.displayReadyCapability=new y.PromiseCapability,B.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(V));const O=Q=>{B.renderTasks.delete(Y),(this._maybeCleanupAfterRender||F)&&(this.#e=!0),this.#s(!F),Q?(Y.capability.reject(Q),this._abortOperatorList({intentState:B,reason:Q instanceof Error?Q:new Error(Q)})):Y.capability.resolve(),this._stats?.timeEnd("Rendering"),this._stats?.timeEnd("Overall")},Y=new K({callback:O,params:{canvasContext:t,viewport:i,transform:b,background:S},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:_,operatorList:B.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!F,pdfBug:this._pdfBug,pageColors:N});(B.renderTasks||=new Set).add(Y);const j=Y.task;return Promise.all([B.displayReadyCapability.promise,R]).then(([Q,st])=>{if(this.destroyed){O();return}this._stats?.time("Rendering"),Y.initializeGraphics({transparency:Q,optionalContentConfig:st}),Y.operatorListChanged()}).catch(O),j}getOperatorList({intent:t="display",annotationMode:i=y.AnnotationMode.ENABLE,printAnnotationStorage:a=null}={}){function d(){S.operatorList.lastChunk&&(S.opListReadCapability.resolve(S.operatorList),S.renderTasks.delete(R))}const b=this._transport.getRenderingIntent(t,i,a,!0);let S=this._intentStates.get(b.cacheKey);S||(S=Object.create(null),this._intentStates.set(b.cacheKey,S));let R;return S.opListReadCapability||(R=Object.create(null),R.operatorListChanged=d,S.opListReadCapability=new y.PromiseCapability,(S.renderTasks||=new Set).add(R),S.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(b)),S.opListReadCapability.promise}streamTextContent({includeMarkedContent:t=!1,disableNormalization:i=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:t===!0,disableNormalization:i===!0},{highWaterMark:100,size(d){return d.items.length}})}getTextContent(t={}){if(this._transport._htmlForXfa)return this.getXfa().then(a=>w.XfaText.textContent(a));const i=this.streamTextContent(t);return new Promise(function(a,d){function b(){S.read().then(function({value:_,done:N}){if(N){a(R);return}Object.assign(R.styles,_.styles),R.items.push(..._.items),b()},d)}const S=i.getReader(),R={items:[],styles:Object.create(null)};b()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const t=[];for(const i of this._intentStates.values())if(this._abortOperatorList({intentState:i,reason:new Error("Page was destroyed."),force:!0}),!i.opListReadCapability)for(const a of i.renderTasks)t.push(a.completed),a.cancel();return this.objs.clear(),this.#e=!1,this.#i(),Promise.all(t)}cleanup(t=!1){this.#e=!0;const i=this.#s(!1);return t&&i&&(this._stats&&=new E.StatTimer),i}#s(t=!1){if(this.#i(),!this.#e||this.destroyed)return!1;if(t)return this.#t=setTimeout(()=>{this.#t=null,this.#s(!1)},M),!1;for(const{renderTasks:i,operatorList:a}of this._intentStates.values())if(i.size>0||!a.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),this.#e=!1,!0}#i(){this.#t&&(clearTimeout(this.#t),this.#t=null)}_startRenderPage(t,i){const a=this._intentStates.get(i);a&&(this._stats?.timeEnd("Page Request"),a.displayReadyCapability?.resolve(t))}_renderPageChunk(t,i){for(let a=0,d=t.length;a<d;a++)i.operatorList.fnArray.push(t.fnArray[a]),i.operatorList.argsArray.push(t.argsArray[a]);i.operatorList.lastChunk=t.lastChunk,i.operatorList.separateAnnots=t.separateAnnots;for(const a of i.renderTasks)a.operatorListChanged();t.lastChunk&&this.#s(!0)}_pumpOperatorList({renderingIntent:t,cacheKey:i,annotationStorageSerializable:a}){const{map:d,transfer:b}=a,R=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:t,cacheKey:i,annotationStorage:d},b).getReader(),_=this._intentStates.get(i);_.streamReader=R;const N=()=>{R.read().then(({value:H,done:V})=>{if(V){_.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(H,_),N())},H=>{if(_.streamReader=null,!this._transport.destroyed){if(_.operatorList){_.operatorList.lastChunk=!0;for(const V of _.renderTasks)V.operatorListChanged();this.#s(!0)}if(_.displayReadyCapability)_.displayReadyCapability.reject(H);else if(_.opListReadCapability)_.opListReadCapability.reject(H);else throw H}})};N()}_abortOperatorList({intentState:t,reason:i,force:a=!1}){if(t.streamReader){if(t.streamReaderCancelTimeout&&(clearTimeout(t.streamReaderCancelTimeout),t.streamReaderCancelTimeout=null),!a){if(t.renderTasks.size>0)return;if(i instanceof E.RenderingCancelledException){let d=k;i.extraDelay>0&&i.extraDelay<1e3&&(d+=i.extraDelay),t.streamReaderCancelTimeout=setTimeout(()=>{t.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:t,reason:i,force:!0})},d);return}}if(t.streamReader.cancel(new y.AbortException(i.message)).catch(()=>{}),t.streamReader=null,!this._transport.destroyed){for(const[d,b]of this._intentStates)if(b===t){this._intentStates.delete(d);break}this.cleanup()}}}get stats(){return this._stats}}class ft{#t=new Set;#e=Promise.resolve();postMessage(t,i){const a={data:structuredClone(t,i?{transfer:i}:null)};this.#e.then(()=>{for(const d of this.#t)d.call(this,a)})}addEventListener(t,i){this.#t.add(i)}removeEventListener(t,i){this.#t.delete(i)}terminate(){this.#t.clear()}}const lt={isWorkerDisabled:!1,fakeWorkerId:0};y.isNodeJS&&(lt.isWorkerDisabled=!0,o.GlobalWorkerOptions.workerSrc||="./pdf.worker.mjs"),lt.isSameOrigin=function(s,t){let i;try{if(i=new URL(s),!i.origin||i.origin==="null")return!1}catch{return!1}const a=new URL(t,i);return i.origin===a.origin},lt.createCDNWrapper=function(s){const t=`await import("${s}");`;return URL.createObjectURL(new Blob([t],{type:"text/javascript"}))};class ot{static#t;constructor({name:t=null,port:i=null,verbosity:a=(0,y.getVerbosityLevel)()}={}){if(this.name=t,this.destroyed=!1,this.verbosity=a,this._readyCapability=new y.PromiseCapability,this._port=null,this._webWorker=null,this._messageHandler=null,i){if(ot.#t?.has(i))throw new Error("Cannot use more than one PDFWorker per port.");(ot.#t||=new WeakMap).set(i,this),this._initializeFromPort(i);return}this._initialize()}get promise(){return this._readyCapability.promise}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(t){this._port=t,this._messageHandler=new c.MessageHandler("main","worker",t),this._messageHandler.on("ready",function(){}),this._readyCapability.resolve(),this._messageHandler.send("configure",{verbosity:this.verbosity})}_initialize(){if(!lt.isWorkerDisabled&&!ot.#e){let{workerSrc:t}=ot;try{lt.isSameOrigin(window.location.href,t)||(t=lt.createCDNWrapper(new URL(t,window.location).href));const i=new Worker(t,{type:"module"}),a=new c.MessageHandler("main","worker",i),d=()=>{i.removeEventListener("error",b),a.destroy(),i.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},b=()=>{this._webWorker||d()};i.addEventListener("error",b),a.on("test",R=>{if(i.removeEventListener("error",b),this.destroyed){d();return}R?(this._messageHandler=a,this._port=i,this._webWorker=i,this._readyCapability.resolve(),a.send("configure",{verbosity:this.verbosity})):(this._setupFakeWorker(),a.destroy(),i.terminate())}),a.on("ready",R=>{if(i.removeEventListener("error",b),this.destroyed){d();return}try{S()}catch{this._setupFakeWorker()}});const S=()=>{const R=new Uint8Array;a.send("test",R,[R.buffer])};S();return}catch{(0,y.info)("The worker has been disabled.")}}this._setupFakeWorker()}_setupFakeWorker(){lt.isWorkerDisabled||((0,y.warn)("Setting up fake worker."),lt.isWorkerDisabled=!0),ot._setupFakeWorkerGlobal.then(t=>{if(this.destroyed){this._readyCapability.reject(new Error("Worker was destroyed"));return}const i=new ft;this._port=i;const a=`fake${lt.fakeWorkerId++}`,d=new c.MessageHandler(a+"_worker",a,i);t.setup(d,i);const b=new c.MessageHandler(a,a+"_worker",i);this._messageHandler=b,this._readyCapability.resolve(),b.send("configure",{verbosity:this.verbosity})}).catch(t=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${t.message}".`))})}destroy(){this.destroyed=!0,this._webWorker&&(this._webWorker.terminate(),this._webWorker=null),ot.#t?.delete(this._port),this._port=null,this._messageHandler&&(this._messageHandler.destroy(),this._messageHandler=null)}static fromPort(t){if(!t?.port)throw new Error("PDFWorker.fromPort - invalid method signature.");const i=this.#t?.get(t.port);if(i){if(i._pendingDestroy)throw new Error("PDFWorker.fromPort - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return i}return new ot(t)}static get workerSrc(){if(o.GlobalWorkerOptions.workerSrc)return o.GlobalWorkerOptions.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get#e(){try{return globalThis.pdfjsWorker?.WorkerMessageHandler||null}catch{return null}}static get _setupFakeWorkerGlobal(){const t=async()=>this.#e?this.#e:(await $t(()=>import(this.workerSrc),[])).WorkerMessageHandler;return(0,y.shadow)(this,"_setupFakeWorkerGlobal",t())}}class gt{#t=new Map;#e=new Map;#s=new Map;#i=null;constructor(t,i,a,d,b){this.messageHandler=t,this.loadingTask=i,this.commonObjs=new dt,this.fontLoader=new T.FontLoader({ownerDocument:d.ownerDocument,styleElement:d.styleElement}),this._params=d,this.canvasFactory=b.canvasFactory,this.filterFactory=b.filterFactory,this.cMapReaderFactory=b.cMapReaderFactory,this.standardFontDataFactory=b.standardFontDataFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=a,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=new y.PromiseCapability,this.setupMessageHandler()}#n(t,i=null){const a=this.#t.get(t);if(a)return a;const d=this.messageHandler.sendWithPromise(t,i);return this.#t.set(t,d),d}get annotationStorage(){return(0,y.shadow)(this,"annotationStorage",new P.AnnotationStorage)}getRenderingIntent(t,i=y.AnnotationMode.ENABLE,a=null,d=!1){let b=y.RenderingIntentFlag.DISPLAY,S=P.SerializableEmpty;switch(t){case"any":b=y.RenderingIntentFlag.ANY;break;case"display":break;case"print":b=y.RenderingIntentFlag.PRINT;break;default:(0,y.warn)(`getRenderingIntent - invalid intent: ${t}`)}switch(i){case y.AnnotationMode.DISABLE:b+=y.RenderingIntentFlag.ANNOTATIONS_DISABLE;break;case y.AnnotationMode.ENABLE:break;case y.AnnotationMode.ENABLE_FORMS:b+=y.RenderingIntentFlag.ANNOTATIONS_FORMS;break;case y.AnnotationMode.ENABLE_STORAGE:b+=y.RenderingIntentFlag.ANNOTATIONS_STORAGE,S=(b&y.RenderingIntentFlag.PRINT&&a instanceof P.PrintAnnotationStorage?a:this.annotationStorage).serializable;break;default:(0,y.warn)(`getRenderingIntent - invalid annotationMode: ${i}`)}return d&&(b+=y.RenderingIntentFlag.OPLIST),{renderingIntent:b,cacheKey:`${b}_${S.hash}`,annotationStorageSerializable:S}}destroy(){if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=new y.PromiseCapability,this.#i?.reject(new Error("Worker was destroyed during onPassword callback"));const t=[];for(const a of this.#e.values())t.push(a._destroy());this.#e.clear(),this.#s.clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const i=this.messageHandler.sendWithPromise("Terminate",null);return t.push(i),Promise.all(t).then(()=>{this.commonObjs.clear(),this.fontLoader.clear(),this.#t.clear(),this.filterFactory.destroy(),this._networkStream?.cancelAllRequests(new y.AbortException("Worker was terminated.")),this.messageHandler&&(this.messageHandler.destroy(),this.messageHandler=null),this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:t,loadingTask:i}=this;t.on("GetReader",(a,d)=>{(0,y.assert)(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=b=>{this._lastProgress={loaded:b.loaded,total:b.total}},d.onPull=()=>{this._fullReader.read().then(function({value:b,done:S}){if(S){d.close();return}(0,y.assert)(b instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),d.enqueue(new Uint8Array(b),1,[b])}).catch(b=>{d.error(b)})},d.onCancel=b=>{this._fullReader.cancel(b),d.ready.catch(S=>{if(!this.destroyed)throw S})}}),t.on("ReaderHeadersReady",a=>{const d=new y.PromiseCapability,b=this._fullReader;return b.headersReady.then(()=>{(!b.isStreamingSupported||!b.isRangeSupported)&&(this._lastProgress&&i.onProgress?.(this._lastProgress),b.onProgress=S=>{i.onProgress?.({loaded:S.loaded,total:S.total})}),d.resolve({isStreamingSupported:b.isStreamingSupported,isRangeSupported:b.isRangeSupported,contentLength:b.contentLength})},d.reject),d.promise}),t.on("GetRangeReader",(a,d)=>{(0,y.assert)(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const b=this._networkStream.getRangeReader(a.begin,a.end);if(!b){d.close();return}d.onPull=()=>{b.read().then(function({value:S,done:R}){if(R){d.close();return}(0,y.assert)(S instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),d.enqueue(new Uint8Array(S),1,[S])}).catch(S=>{d.error(S)})},d.onCancel=S=>{b.cancel(S),d.ready.catch(R=>{if(!this.destroyed)throw R})}}),t.on("GetDoc",({pdfInfo:a})=>{this._numPages=a.numPages,this._htmlForXfa=a.htmlForXfa,delete a.htmlForXfa,i._capability.resolve(new Z(a,this))}),t.on("DocException",function(a){let d;switch(a.name){case"PasswordException":d=new y.PasswordException(a.message,a.code);break;case"InvalidPDFException":d=new y.InvalidPDFException(a.message);break;case"MissingPDFException":d=new y.MissingPDFException(a.message);break;case"UnexpectedResponseException":d=new y.UnexpectedResponseException(a.message,a.status);break;case"UnknownErrorException":d=new y.UnknownErrorException(a.message,a.details);break;default:(0,y.unreachable)("DocException - expected a valid Error.")}i._capability.reject(d)}),t.on("PasswordRequest",a=>{if(this.#i=new y.PromiseCapability,i.onPassword){const d=b=>{b instanceof Error?this.#i.reject(b):this.#i.resolve({password:b})};try{i.onPassword(d,a.code)}catch(b){this.#i.reject(b)}}else this.#i.reject(new y.PasswordException(a.message,a.code));return this.#i.promise}),t.on("DataLoaded",a=>{i.onProgress?.({loaded:a.length,total:a.length}),this.downloadInfoCapability.resolve(a)}),t.on("StartRenderPage",a=>{if(this.destroyed)return;this.#e.get(a.pageIndex)._startRenderPage(a.transparency,a.cacheKey)}),t.on("commonobj",([a,d,b])=>{if(this.destroyed||this.commonObjs.has(a))return null;switch(d){case"Font":const S=this._params;if("error"in b){const H=b.error;(0,y.warn)(`Error during font loading: ${H}`),this.commonObjs.resolve(a,H);break}const R=S.pdfBug&&globalThis.FontInspector?.enabled?(H,V)=>globalThis.FontInspector.fontAdded(H,V):null,_=new T.FontFaceObject(b,{isEvalSupported:S.isEvalSupported,disableFontFace:S.disableFontFace,ignoreErrors:S.ignoreErrors,inspectFont:R});this.fontLoader.bind(_).catch(H=>t.sendWithPromise("FontFallback",{id:a})).finally(()=>{!S.fontExtraProperties&&_.data&&(_.data=null),this.commonObjs.resolve(a,_)});break;case"CopyLocalImage":const{imageRef:N}=b;(0,y.assert)(N,"The imageRef must be defined.");for(const H of this.#e.values())for(const[,V]of H.objs)if(V.ref===N)return V.dataLen?(this.commonObjs.resolve(a,structuredClone(V)),V.dataLen):null;break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(a,b);break;default:throw new Error(`Got unknown common object type ${d}`)}return null}),t.on("obj",([a,d,b,S])=>{if(this.destroyed)return;const R=this.#e.get(d);if(!R.objs.has(a)){if(R._intentStates.size===0){S?.bitmap?.close();return}switch(b){case"Image":R.objs.resolve(a,S),S?.dataLen>y.MAX_IMAGE_SIZE_TO_CACHE&&(R._maybeCleanupAfterRender=!0);break;case"Pattern":R.objs.resolve(a,S);break;default:throw new Error(`Got unknown object type ${b}`)}}}),t.on("DocProgress",a=>{this.destroyed||i.onProgress?.({loaded:a.loaded,total:a.total})}),t.on("FetchBuiltInCMap",a=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.cMapReaderFactory?this.cMapReaderFactory.fetch(a):Promise.reject(new Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter."))),t.on("FetchStandardFontData",a=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.standardFontDataFactory?this.standardFontDataFactory.fetch(a):Promise.reject(new Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter.")))}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){this.annotationStorage.size<=0&&(0,y.warn)("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:t,transfer:i}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:t,filename:this._fullReader?.filename??null},i).finally(()=>{this.annotationStorage.resetModified()})}getPage(t){if(!Number.isInteger(t)||t<=0||t>this._numPages)return Promise.reject(new Error("Invalid page request."));const i=t-1,a=this.#s.get(i);if(a)return a;const d=this.messageHandler.sendWithPromise("GetPage",{pageIndex:i}).then(b=>{if(this.destroyed)throw new Error("Transport destroyed");const S=new tt(i,b,this,this._params.pdfBug);return this.#e.set(i,S),S});return this.#s.set(i,d),d}getPageIndex(t){return typeof t!="object"||t===null||!Number.isInteger(t.num)||t.num<0||!Number.isInteger(t.gen)||t.gen<0?Promise.reject(new Error("Invalid pageIndex request.")):this.messageHandler.sendWithPromise("GetPageIndex",{num:t.num,gen:t.gen})}getAnnotations(t,i){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:t,intent:i})}getFieldObjects(){return this.#n("GetFieldObjects")}hasJSActions(){return this.#n("HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(t){return typeof t!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:t})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getDocJSActions(){return this.#n("GetDocJSActions")}getPageJSActions(t){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:t})}getStructTree(t){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:t})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(){return this.messageHandler.sendWithPromise("GetOptionalContentConfig",null).then(t=>new n.OptionalContentConfig(t))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const t="GetMetadata",i=this.#t.get(t);if(i)return i;const a=this.messageHandler.sendWithPromise(t,null).then(d=>({info:d[0],metadata:d[1]?new p.Metadata(d[1]):null,contentDispositionFilename:this._fullReader?.filename??null,contentLength:this._fullReader?.contentLength??null}));return this.#t.set(t,a),a}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(t=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const i of this.#e.values())if(!i.cleanup())throw new Error(`startCleanup: Page ${i.pageNumber} is currently rendering.`);this.commonObjs.clear(),t||this.fontLoader.clear(),this.#t.clear(),this.filterFactory.destroy(!0)}}get loadingParams(){const{disableAutoFetch:t,enableXfa:i}=this._params;return(0,y.shadow)(this,"loadingParams",{disableAutoFetch:t,enableXfa:i})}}class dt{#t=Object.create(null);#e(t){return this.#t[t]||={capability:new y.PromiseCapability,data:null}}get(t,i=null){if(i){const d=this.#e(t);return d.capability.promise.then(()=>i(d.data)),null}const a=this.#t[t];if(!a?.capability.settled)throw new Error(`Requesting object that isn't resolved yet ${t}.`);return a.data}has(t){return this.#t[t]?.capability.settled??!1}resolve(t,i=null){const a=this.#e(t);a.data=i,a.capability.resolve()}clear(){for(const t in this.#t){const{data:i}=this.#t[t];i?.bitmap?.close()}this.#t=Object.create(null)}*[Symbol.iterator](){for(const t in this.#t){const{capability:i,data:a}=this.#t[t];i.settled&&(yield[t,a])}}}class ct{#t=null;constructor(t){this.#t=t,this.onContinue=null}get promise(){return this.#t.capability.promise}cancel(t=0){this.#t.cancel(null,t)}get separateAnnots(){const{separateAnnots:t}=this.#t.operatorList;if(!t)return!1;const{annotationCanvasMap:i}=this.#t;return t.form||t.canvas&&i?.size>0}}class K{static#t=new WeakSet;constructor({callback:t,params:i,objs:a,commonObjs:d,annotationCanvasMap:b,operatorList:S,pageIndex:R,canvasFactory:_,filterFactory:N,useRequestAnimationFrame:H=!1,pdfBug:V=!1,pageColors:B=null}){this.callback=t,this.params=i,this.objs=a,this.commonObjs=d,this.annotationCanvasMap=b,this.operatorListIdx=null,this.operatorList=S,this._pageIndex=R,this.canvasFactory=_,this.filterFactory=N,this._pdfBug=V,this.pageColors=B,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=H===!0&&typeof window<"u",this.cancelled=!1,this.capability=new y.PromiseCapability,this.task=new ct(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=i.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:t=!1,optionalContentConfig:i}){if(this.cancelled)return;if(this._canvas){if(K.#t.has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");K.#t.add(this._canvas)}this._pdfBug&&globalThis.StepperManager?.enabled&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{canvasContext:a,viewport:d,transform:b,background:S}=this.params;this.gfx=new g.CanvasGraphics(a,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:i},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:b,viewport:d,transparency:t,background:S}),this.operatorListIdx=0,this.graphicsReady=!0,this.graphicsReadyCallback?.()}cancel(t=null,i=0){this.running=!1,this.cancelled=!0,this.gfx?.endDrawing(),K.#t.delete(this._canvas),this.callback(t||new E.RenderingCancelledException(`Rendering cancelled, page ${this._pageIndex+1}`,i))}operatorListChanged(){if(!this.graphicsReady){this.graphicsReadyCallback||=this._continueBound;return}this.stepper?.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?window.requestAnimationFrame(()=>{this._nextBound().catch(this._cancelBound)}):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),K.#t.delete(this._canvas),this.callback())))}}const f="4.0.379",h="9e14d04fd";D()}catch(I){D(I)}})},822:(L,C,x)=>{x.d(C,{BaseCMapReaderFactory:()=>P,BaseCanvasFactory:()=>y,BaseFilterFactory:()=>D,BaseSVGFactory:()=>T,BaseStandardFontDataFactory:()=>E});var l=x(266);class D{constructor(){this.constructor===D&&(0,l.unreachable)("Cannot initialize BaseFilterFactory.")}addFilter(g){return"none"}addHCMFilter(g,o){return"none"}addHighlightHCMFilter(g,o,c,p){return"none"}destroy(g=!1){}}class y{constructor(){this.constructor===y&&(0,l.unreachable)("Cannot initialize BaseCanvasFactory.")}create(g,o){if(g<=0||o<=0)throw new Error("Invalid canvas size");const c=this._createCanvas(g,o);return{canvas:c,context:c.getContext("2d")}}reset(g,o,c){if(!g.canvas)throw new Error("Canvas is not specified");if(o<=0||c<=0)throw new Error("Invalid canvas size");g.canvas.width=o,g.canvas.height=c}destroy(g){if(!g.canvas)throw new Error("Canvas is not specified");g.canvas.width=0,g.canvas.height=0,g.canvas=null,g.context=null}_createCanvas(g,o){(0,l.unreachable)("Abstract method `_createCanvas` called.")}}class P{constructor({baseUrl:g=null,isCompressed:o=!0}){this.constructor===P&&(0,l.unreachable)("Cannot initialize BaseCMapReaderFactory."),this.baseUrl=g,this.isCompressed=o}async fetch({name:g}){if(!this.baseUrl)throw new Error('The CMap "baseUrl" parameter must be specified, ensure that the "cMapUrl" and "cMapPacked" API parameters are provided.');if(!g)throw new Error("CMap name must be specified.");const o=this.baseUrl+g+(this.isCompressed?".bcmap":""),c=this.isCompressed?l.CMapCompressionType.BINARY:l.CMapCompressionType.NONE;return this._fetchData(o,c).catch(p=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${o}`)})}_fetchData(g,o){(0,l.unreachable)("Abstract method `_fetchData` called.")}}class E{constructor({baseUrl:g=null}){this.constructor===E&&(0,l.unreachable)("Cannot initialize BaseStandardFontDataFactory."),this.baseUrl=g}async fetch({filename:g}){if(!this.baseUrl)throw new Error('The standard font "baseUrl" parameter must be specified, ensure that the "standardFontDataUrl" API parameter is provided.');if(!g)throw new Error("Font filename must be specified.");const o=`${this.baseUrl}${g}`;return this._fetchData(o).catch(c=>{throw new Error(`Unable to load font data at: ${o}`)})}_fetchData(g){(0,l.unreachable)("Abstract method `_fetchData` called.")}}class T{constructor(){this.constructor===T&&(0,l.unreachable)("Cannot initialize BaseSVGFactory.")}create(g,o,c=!1){if(g<=0||o<=0)throw new Error("Invalid SVG dimensions");const p=this._createSVG("svg:svg");return p.setAttribute("version","1.1"),c||(p.setAttribute("width",`${g}px`),p.setAttribute("height",`${o}px`)),p.setAttribute("preserveAspectRatio","none"),p.setAttribute("viewBox",`0 0 ${g} ${o}`),p}createElement(g){if(typeof g!="string")throw new Error("Invalid SVG element type");return this._createSVG(g)}_createSVG(g){(0,l.unreachable)("Abstract method `_createSVG` called.")}}},250:(L,C,x)=>{x.d(C,{CanvasGraphics:()=>f});var l=x(266),D=x(473);const y={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function P(h,s){if(!s)return;const t=s[2]-s[0],i=s[3]-s[1],a=new Path2D;a.rect(s[0],s[1],t,i),h.clip(a)}class E{constructor(){this.constructor===E&&(0,l.unreachable)("Cannot initialize BaseShadingPattern.")}getPattern(){(0,l.unreachable)("Abstract method `getPattern` called.")}}class T extends E{constructor(s){super(),this._type=s[1],this._bbox=s[2],this._colorStops=s[3],this._p0=s[4],this._p1=s[5],this._r0=s[6],this._r1=s[7],this.matrix=null}_createGradient(s){let t;this._type==="axial"?t=s.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(t=s.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const i of this._colorStops)t.addColorStop(i[0],i[1]);return t}getPattern(s,t,i,a){let d;if(a===y.STROKE||a===y.FILL){const b=t.current.getClippedPathBoundingBox(a,(0,D.getCurrentTransform)(s))||[0,0,0,0],S=Math.ceil(b[2]-b[0])||1,R=Math.ceil(b[3]-b[1])||1,_=t.cachedCanvases.getCanvas("pattern",S,R,!0),N=_.context;N.clearRect(0,0,N.canvas.width,N.canvas.height),N.beginPath(),N.rect(0,0,N.canvas.width,N.canvas.height),N.translate(-b[0],-b[1]),i=l.Util.transform(i,[1,0,0,1,b[0],b[1]]),N.transform(...t.baseTransform),this.matrix&&N.transform(...this.matrix),P(N,this._bbox),N.fillStyle=this._createGradient(N),N.fill(),d=s.createPattern(_.canvas,"no-repeat");const H=new DOMMatrix(i);d.setTransform(H)}else P(s,this._bbox),d=this._createGradient(s);return d}}function v(h,s,t,i,a,d,b,S){const R=s.coords,_=s.colors,N=h.data,H=h.width*4;let V;R[t+1]>R[i+1]&&(V=t,t=i,i=V,V=d,d=b,b=V),R[i+1]>R[a+1]&&(V=i,i=a,a=V,V=b,b=S,S=V),R[t+1]>R[i+1]&&(V=t,t=i,i=V,V=d,d=b,b=V);const B=(R[t]+s.offsetX)*s.scaleX,F=(R[t+1]+s.offsetY)*s.scaleY,O=(R[i]+s.offsetX)*s.scaleX,Y=(R[i+1]+s.offsetY)*s.scaleY,j=(R[a]+s.offsetX)*s.scaleX,Q=(R[a+1]+s.offsetY)*s.scaleY;if(F>=Q)return;const st=_[d],it=_[d+1],rt=_[d+2],nt=_[b],ht=_[b+1],mt=_[b+2],At=_[S],St=_[S+1],pt=_[S+2],Mt=Math.round(F),Ft=Math.round(Q);let It,xt,Tt,Ct,_t,zt,se,ie;for(let Dt=Mt;Dt<=Ft;Dt++){if(Dt<Y){const Rt=Dt<F?0:(F-Dt)/(F-Y);It=B-(B-O)*Rt,xt=st-(st-nt)*Rt,Tt=it-(it-ht)*Rt,Ct=rt-(rt-mt)*Rt}else{let Rt;Dt>Q?Rt=1:Y===Q?Rt=0:Rt=(Y-Dt)/(Y-Q),It=O-(O-j)*Rt,xt=nt-(nt-At)*Rt,Tt=ht-(ht-St)*Rt,Ct=mt-(mt-pt)*Rt}let Pt;Dt<F?Pt=0:Dt>Q?Pt=1:Pt=(F-Dt)/(F-Q),_t=B-(B-j)*Pt,zt=st-(st-At)*Pt,se=it-(it-St)*Pt,ie=rt-(rt-pt)*Pt;const ne=Math.round(Math.min(It,_t)),Vt=Math.round(Math.max(It,_t));let jt=H*Dt+ne*4;for(let Rt=ne;Rt<=Vt;Rt++)Pt=(It-Rt)/(It-_t),Pt<0?Pt=0:Pt>1&&(Pt=1),N[jt++]=xt-(xt-zt)*Pt|0,N[jt++]=Tt-(Tt-se)*Pt|0,N[jt++]=Ct-(Ct-ie)*Pt|0,N[jt++]=255}}function g(h,s,t){const i=s.coords,a=s.colors;let d,b;switch(s.type){case"lattice":const S=s.verticesPerRow,R=Math.floor(i.length/S)-1,_=S-1;for(d=0;d<R;d++){let N=d*S;for(let H=0;H<_;H++,N++)v(h,t,i[N],i[N+1],i[N+S],a[N],a[N+1],a[N+S]),v(h,t,i[N+S+1],i[N+1],i[N+S],a[N+S+1],a[N+1],a[N+S])}break;case"triangles":for(d=0,b=i.length;d<b;d+=3)v(h,t,i[d],i[d+1],i[d+2],a[d],a[d+1],a[d+2]);break;default:throw new Error("illegal figure")}}class o extends E{constructor(s){super(),this._coords=s[2],this._colors=s[3],this._figures=s[4],this._bounds=s[5],this._bbox=s[7],this._background=s[8],this.matrix=null}_createMeshCanvas(s,t,i){const S=Math.floor(this._bounds[0]),R=Math.floor(this._bounds[1]),_=Math.ceil(this._bounds[2])-S,N=Math.ceil(this._bounds[3])-R,H=Math.min(Math.ceil(Math.abs(_*s[0]*1.1)),3e3),V=Math.min(Math.ceil(Math.abs(N*s[1]*1.1)),3e3),B=_/H,F=N/V,O={coords:this._coords,colors:this._colors,offsetX:-S,offsetY:-R,scaleX:1/B,scaleY:1/F},Y=H+2*2,j=V+2*2,Q=i.getCanvas("mesh",Y,j,!1),st=Q.context,it=st.createImageData(H,V);if(t){const nt=it.data;for(let ht=0,mt=nt.length;ht<mt;ht+=4)nt[ht]=t[0],nt[ht+1]=t[1],nt[ht+2]=t[2],nt[ht+3]=255}for(const nt of this._figures)g(it,nt,O);return st.putImageData(it,2,2),{canvas:Q.canvas,offsetX:S-2*B,offsetY:R-2*F,scaleX:B,scaleY:F}}getPattern(s,t,i,a){P(s,this._bbox);let d;if(a===y.SHADING)d=l.Util.singularValueDecompose2dScale((0,D.getCurrentTransform)(s));else if(d=l.Util.singularValueDecompose2dScale(t.baseTransform),this.matrix){const S=l.Util.singularValueDecompose2dScale(this.matrix);d=[d[0]*S[0],d[1]*S[1]]}const b=this._createMeshCanvas(d,a===y.SHADING?null:this._background,t.cachedCanvases);return a!==y.SHADING&&(s.setTransform(...t.baseTransform),this.matrix&&s.transform(...this.matrix)),s.translate(b.offsetX,b.offsetY),s.scale(b.scaleX,b.scaleY),s.createPattern(b.canvas,"no-repeat")}}class c extends E{getPattern(){return"hotpink"}}function p(h){switch(h[0]){case"RadialAxial":return new T(h);case"Mesh":return new o(h);case"Dummy":return new c}throw new Error(`Unknown IR type: ${h[0]}`)}const n={COLORED:1,UNCOLORED:2};class m{static MAX_PATTERN_SIZE=3e3;constructor(s,t,i,a,d){this.operatorList=s[2],this.matrix=s[3]||[1,0,0,1,0,0],this.bbox=s[4],this.xstep=s[5],this.ystep=s[6],this.paintType=s[7],this.tilingType=s[8],this.color=t,this.ctx=i,this.canvasGraphicsFactory=a,this.baseTransform=d}createPatternCanvas(s){const t=this.operatorList,i=this.bbox,a=this.xstep,d=this.ystep,b=this.paintType,S=this.tilingType,R=this.color,_=this.canvasGraphicsFactory;(0,l.info)("TilingType: "+S);const N=i[0],H=i[1],V=i[2],B=i[3],F=l.Util.singularValueDecompose2dScale(this.matrix),O=l.Util.singularValueDecompose2dScale(this.baseTransform),Y=[F[0]*O[0],F[1]*O[1]],j=this.getSizeAndScale(a,this.ctx.canvas.width,Y[0]),Q=this.getSizeAndScale(d,this.ctx.canvas.height,Y[1]),st=s.cachedCanvases.getCanvas("pattern",j.size,Q.size,!0),it=st.context,rt=_.createCanvasGraphics(it);rt.groupLevel=s.groupLevel,this.setFillAndStrokeStyleToContext(rt,b,R);let nt=N,ht=H,mt=V,At=B;return N<0&&(nt=0,mt+=Math.abs(N)),H<0&&(ht=0,At+=Math.abs(H)),it.translate(-(j.scale*nt),-(Q.scale*ht)),rt.transform(j.scale,0,0,Q.scale,0,0),it.save(),this.clipBbox(rt,nt,ht,mt,At),rt.baseTransform=(0,D.getCurrentTransform)(rt.ctx),rt.executeOperatorList(t),rt.endDrawing(),{canvas:st.canvas,scaleX:j.scale,scaleY:Q.scale,offsetX:nt,offsetY:ht}}getSizeAndScale(s,t,i){s=Math.abs(s);const a=Math.max(m.MAX_PATTERN_SIZE,t);let d=Math.ceil(s*i);return d>=a?d=a:i=d/s,{scale:i,size:d}}clipBbox(s,t,i,a,d){const b=a-t,S=d-i;s.ctx.rect(t,i,b,S),s.current.updateRectMinMax((0,D.getCurrentTransform)(s.ctx),[t,i,a,d]),s.clip(),s.endPath()}setFillAndStrokeStyleToContext(s,t,i){const a=s.ctx,d=s.current;switch(t){case n.COLORED:const b=this.ctx;a.fillStyle=b.fillStyle,a.strokeStyle=b.strokeStyle,d.fillColor=b.fillStyle,d.strokeColor=b.strokeStyle;break;case n.UNCOLORED:const S=l.Util.makeHexColor(i[0],i[1],i[2]);a.fillStyle=S,a.strokeStyle=S,d.fillColor=S,d.strokeColor=S;break;default:throw new l.FormatError(`Unsupported paint type: ${t}`)}}getPattern(s,t,i,a){let d=i;a!==y.SHADING&&(d=l.Util.transform(d,t.baseTransform),this.matrix&&(d=l.Util.transform(d,this.matrix)));const b=this.createPatternCanvas(t);let S=new DOMMatrix(d);S=S.translate(b.offsetX,b.offsetY),S=S.scale(1/b.scaleX,1/b.scaleY);const R=s.createPattern(b.canvas,"repeat");return R.setTransform(S),R}}function e({src:h,srcPos:s=0,dest:t,width:i,height:a,nonBlackColor:d=4294967295,inverseDecode:b=!1}){const S=l.FeatureTest.isLittleEndian?4278190080:255,[R,_]=b?[d,S]:[S,d],N=i>>3,H=i&7,V=h.length;t=new Uint32Array(t.buffer);let B=0;for(let F=0;F<a;F++){for(const Y=s+N;s<Y;s++){const j=s<V?h[s]:255;t[B++]=j&128?_:R,t[B++]=j&64?_:R,t[B++]=j&32?_:R,t[B++]=j&16?_:R,t[B++]=j&8?_:R,t[B++]=j&4?_:R,t[B++]=j&2?_:R,t[B++]=j&1?_:R}if(H===0)continue;const O=s<V?h[s++]:255;for(let Y=0;Y<H;Y++)t[B++]=O&1<<7-Y?_:R}return{srcPos:s,destPos:B}}const r=16,u=100,w=4096,A=15,I=10,k=1e3,M=16;function z(h,s){if(h._removeMirroring)throw new Error("Context is already forwarding operations.");h.__originalSave=h.save,h.__originalRestore=h.restore,h.__originalRotate=h.rotate,h.__originalScale=h.scale,h.__originalTranslate=h.translate,h.__originalTransform=h.transform,h.__originalSetTransform=h.setTransform,h.__originalResetTransform=h.resetTransform,h.__originalClip=h.clip,h.__originalMoveTo=h.moveTo,h.__originalLineTo=h.lineTo,h.__originalBezierCurveTo=h.bezierCurveTo,h.__originalRect=h.rect,h.__originalClosePath=h.closePath,h.__originalBeginPath=h.beginPath,h._removeMirroring=()=>{h.save=h.__originalSave,h.restore=h.__originalRestore,h.rotate=h.__originalRotate,h.scale=h.__originalScale,h.translate=h.__originalTranslate,h.transform=h.__originalTransform,h.setTransform=h.__originalSetTransform,h.resetTransform=h.__originalResetTransform,h.clip=h.__originalClip,h.moveTo=h.__originalMoveTo,h.lineTo=h.__originalLineTo,h.bezierCurveTo=h.__originalBezierCurveTo,h.rect=h.__originalRect,h.closePath=h.__originalClosePath,h.beginPath=h.__originalBeginPath,delete h._removeMirroring},h.save=function(){s.save(),this.__originalSave()},h.restore=function(){s.restore(),this.__originalRestore()},h.translate=function(i,a){s.translate(i,a),this.__originalTranslate(i,a)},h.scale=function(i,a){s.scale(i,a),this.__originalScale(i,a)},h.transform=function(i,a,d,b,S,R){s.transform(i,a,d,b,S,R),this.__originalTransform(i,a,d,b,S,R)},h.setTransform=function(i,a,d,b,S,R){s.setTransform(i,a,d,b,S,R),this.__originalSetTransform(i,a,d,b,S,R)},h.resetTransform=function(){s.resetTransform(),this.__originalResetTransform()},h.rotate=function(i){s.rotate(i),this.__originalRotate(i)},h.clip=function(i){s.clip(i),this.__originalClip(i)},h.moveTo=function(t,i){s.moveTo(t,i),this.__originalMoveTo(t,i)},h.lineTo=function(t,i){s.lineTo(t,i),this.__originalLineTo(t,i)},h.bezierCurveTo=function(t,i,a,d,b,S){s.bezierCurveTo(t,i,a,d,b,S),this.__originalBezierCurveTo(t,i,a,d,b,S)},h.rect=function(t,i,a,d){s.rect(t,i,a,d),this.__originalRect(t,i,a,d)},h.closePath=function(){s.closePath(),this.__originalClosePath()},h.beginPath=function(){s.beginPath(),this.__originalBeginPath()}}class G{constructor(s){this.canvasFactory=s,this.cache=Object.create(null)}getCanvas(s,t,i){let a;return this.cache[s]!==void 0?(a=this.cache[s],this.canvasFactory.reset(a,t,i)):(a=this.canvasFactory.create(t,i),this.cache[s]=a),a}delete(s){delete this.cache[s]}clear(){for(const s in this.cache){const t=this.cache[s];this.canvasFactory.destroy(t),delete this.cache[s]}}}function X(h,s,t,i,a,d,b,S,R,_){const[N,H,V,B,F,O]=(0,D.getCurrentTransform)(h);if(H===0&&V===0){const Q=b*N+F,st=Math.round(Q),it=S*B+O,rt=Math.round(it),nt=(b+R)*N+F,ht=Math.abs(Math.round(nt)-st)||1,mt=(S+_)*B+O,At=Math.abs(Math.round(mt)-rt)||1;return h.setTransform(Math.sign(N),0,0,Math.sign(B),st,rt),h.drawImage(s,t,i,a,d,0,0,ht,At),h.setTransform(N,H,V,B,F,O),[ht,At]}if(N===0&&B===0){const Q=S*V+F,st=Math.round(Q),it=b*H+O,rt=Math.round(it),nt=(S+_)*V+F,ht=Math.abs(Math.round(nt)-st)||1,mt=(b+R)*H+O,At=Math.abs(Math.round(mt)-rt)||1;return h.setTransform(0,Math.sign(H),Math.sign(V),0,st,rt),h.drawImage(s,t,i,a,d,0,0,At,ht),h.setTransform(N,H,V,B,F,O),[At,ht]}h.drawImage(s,t,i,a,d,b,S,R,_);const Y=Math.hypot(N,H),j=Math.hypot(V,B);return[Y*R,j*_]}function q(h){const{width:s,height:t}=h;if(s>k||t>k)return null;const i=1e3,a=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),d=s+1;let b=new Uint8Array(d*(t+1)),S,R,_;const N=s+7&-8;let H=new Uint8Array(N*t),V=0;for(const j of h.data){let Q=128;for(;Q>0;)H[V++]=j&Q?0:255,Q>>=1}let B=0;for(V=0,H[V]!==0&&(b[0]=1,++B),R=1;R<s;R++)H[V]!==H[V+1]&&(b[R]=H[V]?2:1,++B),V++;for(H[V]!==0&&(b[R]=2,++B),S=1;S<t;S++){V=S*N,_=S*d,H[V-N]!==H[V]&&(b[_]=H[V]?1:8,++B);let j=(H[V]?4:0)+(H[V-N]?8:0);for(R=1;R<s;R++)j=(j>>2)+(H[V+1]?4:0)+(H[V-N+1]?8:0),a[j]&&(b[_+R]=a[j],++B),V++;if(H[V-N]!==H[V]&&(b[_+R]=H[V]?2:4,++B),B>i)return null}for(V=N*(t-1),_=S*d,H[V]!==0&&(b[_]=8,++B),R=1;R<s;R++)H[V]!==H[V+1]&&(b[_+R]=H[V]?4:8,++B),V++;if(H[V]!==0&&(b[_+R]=4,++B),B>i)return null;const F=new Int32Array([0,d,-1,0,-d,0,0,0,1]),O=new Path2D;for(S=0;B&&S<=t;S++){let j=S*d;const Q=j+s;for(;j<Q&&!b[j];)j++;if(j===Q)continue;O.moveTo(j%d,S);const st=j;let it=b[j];do{const rt=F[it];do j+=rt;while(!b[j]);const nt=b[j];nt!==5&&nt!==10?(it=nt,b[j]=0):(it=nt&51*it>>4,b[j]&=it>>2|it<<2),O.lineTo(j%d,j/d|0),b[j]||--B}while(st!==j);--S}return H=null,b=null,function(j){j.save(),j.scale(1/s,-1/t),j.translate(0,-t),j.fill(O),j.beginPath(),j.restore()}}class et{constructor(s,t){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=l.IDENTITY_MATRIX,this.textMatrixScale=1,this.fontMatrix=l.FONT_IDENTITY_MATRIX,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=l.TextRenderingMode.FILL,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps="none",this.startNewPathAndClipBox([0,0,s,t])}clone(){const s=Object.create(this);return s.clipBox=this.clipBox.slice(),s}setCurrentPoint(s,t){this.x=s,this.y=t}updatePathMinMax(s,t,i){[t,i]=l.Util.applyTransform([t,i],s),this.minX=Math.min(this.minX,t),this.minY=Math.min(this.minY,i),this.maxX=Math.max(this.maxX,t),this.maxY=Math.max(this.maxY,i)}updateRectMinMax(s,t){const i=l.Util.applyTransform(t,s),a=l.Util.applyTransform(t.slice(2),s),d=l.Util.applyTransform([t[0],t[3]],s),b=l.Util.applyTransform([t[2],t[1]],s);this.minX=Math.min(this.minX,i[0],a[0],d[0],b[0]),this.minY=Math.min(this.minY,i[1],a[1],d[1],b[1]),this.maxX=Math.max(this.maxX,i[0],a[0],d[0],b[0]),this.maxY=Math.max(this.maxY,i[1],a[1],d[1],b[1])}updateScalingPathMinMax(s,t){l.Util.scaleMinMax(s,t),this.minX=Math.min(this.minX,t[0]),this.maxX=Math.max(this.maxX,t[1]),this.minY=Math.min(this.minY,t[2]),this.maxY=Math.max(this.maxY,t[3])}updateCurvePathMinMax(s,t,i,a,d,b,S,R,_,N){const H=l.Util.bezierBoundingBox(t,i,a,d,b,S,R,_);if(N){N[0]=Math.min(N[0],H[0],H[2]),N[1]=Math.max(N[1],H[0],H[2]),N[2]=Math.min(N[2],H[1],H[3]),N[3]=Math.max(N[3],H[1],H[3]);return}this.updateRectMinMax(s,H)}getPathBoundingBox(s=y.FILL,t=null){const i=[this.minX,this.minY,this.maxX,this.maxY];if(s===y.STROKE){t||(0,l.unreachable)("Stroke bounding box must include transform.");const a=l.Util.singularValueDecompose2dScale(t),d=a[0]*this.lineWidth/2,b=a[1]*this.lineWidth/2;i[0]-=d,i[1]-=b,i[2]+=d,i[3]+=b}return i}updateClipFromPath(){const s=l.Util.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(s||[0,0,0,0])}isEmptyClip(){return this.minX===1/0}startNewPathAndClipBox(s){this.clipBox=s,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}getClippedPathBoundingBox(s=y.FILL,t=null){return l.Util.intersect(this.clipBox,this.getPathBoundingBox(s,t))}}function at(h,s){if(typeof ImageData<"u"&&s instanceof ImageData){h.putImageData(s,0,0);return}const t=s.height,i=s.width,a=t%M,d=(t-a)/M,b=a===0?d:d+1,S=h.createImageData(i,M);let R=0,_;const N=s.data,H=S.data;let V,B,F,O;if(s.kind===l.ImageKind.GRAYSCALE_1BPP){const Y=N.byteLength,j=new Uint32Array(H.buffer,0,H.byteLength>>2),Q=j.length,st=i+7>>3,it=4294967295,rt=l.FeatureTest.isLittleEndian?4278190080:255;for(V=0;V<b;V++){for(F=V<d?M:a,_=0,B=0;B<F;B++){const nt=Y-R;let ht=0;const mt=nt>st?i:nt*8-7,At=mt&-8;let St=0,pt=0;for(;ht<At;ht+=8)pt=N[R++],j[_++]=pt&128?it:rt,j[_++]=pt&64?it:rt,j[_++]=pt&32?it:rt,j[_++]=pt&16?it:rt,j[_++]=pt&8?it:rt,j[_++]=pt&4?it:rt,j[_++]=pt&2?it:rt,j[_++]=pt&1?it:rt;for(;ht<mt;ht++)St===0&&(pt=N[R++],St=128),j[_++]=pt&St?it:rt,St>>=1}for(;_<Q;)j[_++]=0;h.putImageData(S,0,V*M)}}else if(s.kind===l.ImageKind.RGBA_32BPP){for(B=0,O=i*M*4,V=0;V<d;V++)H.set(N.subarray(R,R+O)),R+=O,h.putImageData(S,0,B),B+=M;V<b&&(O=i*a*4,H.set(N.subarray(R,R+O)),h.putImageData(S,0,B))}else if(s.kind===l.ImageKind.RGB_24BPP)for(F=M,O=i*F,V=0;V<b;V++){for(V>=d&&(F=a,O=i*F),_=0,B=O;B--;)H[_++]=N[R++],H[_++]=N[R++],H[_++]=N[R++],H[_++]=255;h.putImageData(S,0,V*M)}else throw new Error(`bad image kind: ${s.kind}`)}function W(h,s){if(s.bitmap){h.drawImage(s.bitmap,0,0);return}const t=s.height,i=s.width,a=t%M,d=(t-a)/M,b=a===0?d:d+1,S=h.createImageData(i,M);let R=0;const _=s.data,N=S.data;for(let H=0;H<b;H++){const V=H<d?M:a;({srcPos:R}=e({src:_,srcPos:R,dest:N,width:i,height:V,nonBlackColor:0})),h.putImageData(S,0,H*M)}}function $(h,s){const t=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const i of t)h[i]!==void 0&&(s[i]=h[i]);h.setLineDash!==void 0&&(s.setLineDash(h.getLineDash()),s.lineDashOffset=h.lineDashOffset)}function U(h){if(h.strokeStyle=h.fillStyle="#000000",h.fillRule="nonzero",h.globalAlpha=1,h.lineWidth=1,h.lineCap="butt",h.lineJoin="miter",h.miterLimit=10,h.globalCompositeOperation="source-over",h.font="10px sans-serif",h.setLineDash!==void 0&&(h.setLineDash([]),h.lineDashOffset=0),!l.isNodeJS){const{filter:s}=h;s!=="none"&&s!==""&&(h.filter="none")}}function J(h,s,t,i){const a=h.length;for(let d=3;d<a;d+=4){const b=h[d];if(b===0)h[d-3]=s,h[d-2]=t,h[d-1]=i;else if(b<255){const S=255-b;h[d-3]=h[d-3]*b+s*S>>8,h[d-2]=h[d-2]*b+t*S>>8,h[d-1]=h[d-1]*b+i*S>>8}}}function Z(h,s,t){const i=h.length,a=1/255;for(let d=3;d<i;d+=4){const b=t?t[h[d]]:h[d];s[d]=s[d]*b*a|0}}function tt(h,s,t){const i=h.length;for(let a=3;a<i;a+=4){const d=h[a-3]*77+h[a-2]*152+h[a-1]*28;s[a]=t?s[a]*t[d>>8]>>8:s[a]*d>>16}}function ft(h,s,t,i,a,d,b,S,R,_,N){const H=!!d,V=H?d[0]:0,B=H?d[1]:0,F=H?d[2]:0,O=a==="Luminosity"?tt:Z,j=Math.min(i,Math.ceil(1048576/t));for(let Q=0;Q<i;Q+=j){const st=Math.min(j,i-Q),it=h.getImageData(S-_,Q+(R-N),t,st),rt=s.getImageData(S,Q+R,t,st);H&&J(it.data,V,B,F),O(it.data,rt.data,b),s.putImageData(rt,S,Q+R)}}function lt(h,s,t,i){const a=i[0],d=i[1],b=i[2]-a,S=i[3]-d;b===0||S===0||(ft(s.context,t,b,S,s.subtype,s.backdrop,s.transferMap,a,d,s.offsetX,s.offsetY),h.save(),h.globalAlpha=1,h.globalCompositeOperation="source-over",h.setTransform(1,0,0,1,0,0),h.drawImage(t.canvas,0,0),h.restore())}function ot(h,s){const t=l.Util.singularValueDecompose2dScale(h);t[0]=Math.fround(t[0]),t[1]=Math.fround(t[1]);const i=Math.fround((globalThis.devicePixelRatio||1)*D.PixelsPerInch.PDF_TO_CSS_UNITS);return s!==void 0?s:t[0]<=i||t[1]<=i}const gt=["butt","round","square"],dt=["miter","round","bevel"],ct={},K={};class f{constructor(s,t,i,a,d,{optionalContentConfig:b,markedContentStack:S=null},R,_){this.ctx=s,this.current=new et(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=t,this.objs=i,this.canvasFactory=a,this.filterFactory=d,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=S||[],this.optionalContentConfig=b,this.cachedCanvases=new G(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=R,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=_,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(s,t=null){return typeof s=="string"?s.startsWith("g_")?this.commonObjs.get(s):this.objs.get(s):t}beginDrawing({transform:s,viewport:t,transparency:i=!1,background:a=null}){const d=this.ctx.canvas.width,b=this.ctx.canvas.height,S=this.ctx.fillStyle;if(this.ctx.fillStyle=a||"#ffffff",this.ctx.fillRect(0,0,d,b),this.ctx.fillStyle=S,i){const R=this.cachedCanvases.getCanvas("transparent",d,b);this.compositeCtx=this.ctx,this.transparentCanvas=R.canvas,this.ctx=R.context,this.ctx.save(),this.ctx.transform(...(0,D.getCurrentTransform)(this.compositeCtx))}this.ctx.save(),U(this.ctx),s&&(this.ctx.transform(...s),this.outputScaleX=s[0],this.outputScaleY=s[0]),this.ctx.transform(...t.transform),this.viewportScale=t.scale,this.baseTransform=(0,D.getCurrentTransform)(this.ctx)}executeOperatorList(s,t,i,a){const d=s.argsArray,b=s.fnArray;let S=t||0;const R=d.length;if(R===S)return S;const _=R-S>I&&typeof i=="function",N=_?Date.now()+A:0;let H=0;const V=this.commonObjs,B=this.objs;let F;for(;;){if(a!==void 0&&S===a.nextBreakPoint)return a.breakIt(S,i),S;if(F=b[S],F!==l.OPS.dependency)this[F].apply(this,d[S]);else for(const O of d[S]){const Y=O.startsWith("g_")?V:B;if(!Y.has(O))return Y.get(O,i),S}if(S++,S===R)return S;if(_&&++H>I){if(Date.now()>N)return i(),S;H=0}}}#t(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)}endDrawing(){this.#t(),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const s of this._cachedBitmapsMap.values()){for(const t of s.values())typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement&&(t.width=t.height=0);s.clear()}this._cachedBitmapsMap.clear(),this.#e()}#e(){if(this.pageColors){const s=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(s!=="none"){const t=this.ctx.filter;this.ctx.filter=s,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=t}}}_scaleImage(s,t){const i=s.width,a=s.height;let d=Math.max(Math.hypot(t[0],t[1]),1),b=Math.max(Math.hypot(t[2],t[3]),1),S=i,R=a,_="prescale1",N,H;for(;d>2&&S>1||b>2&&R>1;){let V=S,B=R;d>2&&S>1&&(V=S>=16384?Math.floor(S/2)-1||1:Math.ceil(S/2),d/=S/V),b>2&&R>1&&(B=R>=16384?Math.floor(R/2)-1||1:Math.ceil(R)/2,b/=R/B),N=this.cachedCanvases.getCanvas(_,V,B),H=N.context,H.clearRect(0,0,V,B),H.drawImage(s,0,0,S,R,0,0,V,B),s=N.canvas,S=V,R=B,_=_==="prescale1"?"prescale2":"prescale1"}return{img:s,paintWidth:S,paintHeight:R}}_createMaskCanvas(s){const t=this.ctx,{width:i,height:a}=s,d=this.current.fillColor,b=this.current.patternFill,S=(0,D.getCurrentTransform)(t);let R,_,N,H;if((s.bitmap||s.data)&&s.count>1){const mt=s.bitmap||s.data.buffer;_=JSON.stringify(b?S:[S.slice(0,4),d]),R=this._cachedBitmapsMap.get(mt),R||(R=new Map,this._cachedBitmapsMap.set(mt,R));const At=R.get(_);if(At&&!b){const St=Math.round(Math.min(S[0],S[2])+S[4]),pt=Math.round(Math.min(S[1],S[3])+S[5]);return{canvas:At,offsetX:St,offsetY:pt}}N=At}N||(H=this.cachedCanvases.getCanvas("maskCanvas",i,a),W(H.context,s));let V=l.Util.transform(S,[1/i,0,0,-1/a,0,0]);V=l.Util.transform(V,[1,0,0,1,0,-a]);const[B,F,O,Y]=l.Util.getAxialAlignedBoundingBox([0,0,i,a],V),j=Math.round(O-B)||1,Q=Math.round(Y-F)||1,st=this.cachedCanvases.getCanvas("fillCanvas",j,Q),it=st.context,rt=B,nt=F;it.translate(-rt,-nt),it.transform(...V),N||(N=this._scaleImage(H.canvas,(0,D.getCurrentTransformInverse)(it)),N=N.img,R&&b&&R.set(_,N)),it.imageSmoothingEnabled=ot((0,D.getCurrentTransform)(it),s.interpolate),X(it,N,0,0,N.width,N.height,0,0,i,a),it.globalCompositeOperation="source-in";const ht=l.Util.transform((0,D.getCurrentTransformInverse)(it),[1,0,0,1,-rt,-nt]);return it.fillStyle=b?d.getPattern(t,this,ht,y.FILL):d,it.fillRect(0,0,i,a),R&&!b&&(this.cachedCanvases.delete("fillCanvas"),R.set(_,st.canvas)),{canvas:st.canvas,offsetX:Math.round(rt),offsetY:Math.round(nt)}}setLineWidth(s){s!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=s,this.ctx.lineWidth=s}setLineCap(s){this.ctx.lineCap=gt[s]}setLineJoin(s){this.ctx.lineJoin=dt[s]}setMiterLimit(s){this.ctx.miterLimit=s}setDash(s,t){const i=this.ctx;i.setLineDash!==void 0&&(i.setLineDash(s),i.lineDashOffset=t)}setRenderingIntent(s){}setFlatness(s){}setGState(s){for(const[t,i]of s)switch(t){case"LW":this.setLineWidth(i);break;case"LC":this.setLineCap(i);break;case"LJ":this.setLineJoin(i);break;case"ML":this.setMiterLimit(i);break;case"D":this.setDash(i[0],i[1]);break;case"RI":this.setRenderingIntent(i);break;case"FL":this.setFlatness(i);break;case"Font":this.setFont(i[0],i[1]);break;case"CA":this.current.strokeAlpha=i;break;case"ca":this.current.fillAlpha=i,this.ctx.globalAlpha=i;break;case"BM":this.ctx.globalCompositeOperation=i;break;case"SMask":this.current.activeSMask=i?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(i);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const s=this.inSMaskMode;this.current.activeSMask&&!s?this.beginSMaskMode():!this.current.activeSMask&&s&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const s=this.ctx.canvas.width,t=this.ctx.canvas.height,i="smaskGroupAt"+this.groupLevel,a=this.cachedCanvases.getCanvas(i,s,t);this.suspendedCtx=this.ctx,this.ctx=a.context;const d=this.ctx;d.setTransform(...(0,D.getCurrentTransform)(this.suspendedCtx)),$(this.suspendedCtx,d),z(d,this.suspendedCtx),this.setGState([["BM","source-over"],["ca",1],["CA",1]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),$(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(s){if(!this.current.activeSMask)return;s?(s[0]=Math.floor(s[0]),s[1]=Math.floor(s[1]),s[2]=Math.ceil(s[2]),s[3]=Math.ceil(s[3])):s=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const t=this.current.activeSMask,i=this.suspendedCtx;lt(i,t,this.ctx,s),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}save(){this.inSMaskMode?($(this.ctx,this.suspendedCtx),this.suspendedCtx.save()):this.ctx.save();const s=this.current;this.stateStack.push(s),this.current=s.clone()}restore(){this.stateStack.length===0&&this.inSMaskMode&&this.endSMaskMode(),this.stateStack.length!==0&&(this.current=this.stateStack.pop(),this.inSMaskMode?(this.suspendedCtx.restore(),$(this.suspendedCtx,this.ctx)):this.ctx.restore(),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null)}transform(s,t,i,a,d,b){this.ctx.transform(s,t,i,a,d,b),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(s,t,i){const a=this.ctx,d=this.current;let b=d.x,S=d.y,R,_;const N=(0,D.getCurrentTransform)(a),H=N[0]===0&&N[3]===0||N[1]===0&&N[2]===0,V=H?i.slice(0):null;for(let B=0,F=0,O=s.length;B<O;B++)switch(s[B]|0){case l.OPS.rectangle:b=t[F++],S=t[F++];const Y=t[F++],j=t[F++],Q=b+Y,st=S+j;a.moveTo(b,S),Y===0||j===0?a.lineTo(Q,st):(a.lineTo(Q,S),a.lineTo(Q,st),a.lineTo(b,st)),H||d.updateRectMinMax(N,[b,S,Q,st]),a.closePath();break;case l.OPS.moveTo:b=t[F++],S=t[F++],a.moveTo(b,S),H||d.updatePathMinMax(N,b,S);break;case l.OPS.lineTo:b=t[F++],S=t[F++],a.lineTo(b,S),H||d.updatePathMinMax(N,b,S);break;case l.OPS.curveTo:R=b,_=S,b=t[F+4],S=t[F+5],a.bezierCurveTo(t[F],t[F+1],t[F+2],t[F+3],b,S),d.updateCurvePathMinMax(N,R,_,t[F],t[F+1],t[F+2],t[F+3],b,S,V),F+=6;break;case l.OPS.curveTo2:R=b,_=S,a.bezierCurveTo(b,S,t[F],t[F+1],t[F+2],t[F+3]),d.updateCurvePathMinMax(N,R,_,b,S,t[F],t[F+1],t[F+2],t[F+3],V),b=t[F+2],S=t[F+3],F+=4;break;case l.OPS.curveTo3:R=b,_=S,b=t[F+2],S=t[F+3],a.bezierCurveTo(t[F],t[F+1],b,S,b,S),d.updateCurvePathMinMax(N,R,_,t[F],t[F+1],b,S,b,S,V),F+=4;break;case l.OPS.closePath:a.closePath();break}H&&d.updateScalingPathMinMax(N,V),d.setCurrentPoint(b,S)}closePath(){this.ctx.closePath()}stroke(s=!0){const t=this.ctx,i=this.current.strokeColor;t.globalAlpha=this.current.strokeAlpha,this.contentVisible&&(typeof i=="object"&&i?.getPattern?(t.save(),t.strokeStyle=i.getPattern(t,this,(0,D.getCurrentTransformInverse)(t),y.STROKE),this.rescaleAndStroke(!1),t.restore()):this.rescaleAndStroke(!0)),s&&this.consumePath(this.current.getClippedPathBoundingBox()),t.globalAlpha=this.current.fillAlpha}closeStroke(){this.closePath(),this.stroke()}fill(s=!0){const t=this.ctx,i=this.current.fillColor,a=this.current.patternFill;let d=!1;a&&(t.save(),t.fillStyle=i.getPattern(t,this,(0,D.getCurrentTransformInverse)(t),y.FILL),d=!0);const b=this.current.getClippedPathBoundingBox();this.contentVisible&&b!==null&&(this.pendingEOFill?(t.fill("evenodd"),this.pendingEOFill=!1):t.fill()),d&&t.restore(),s&&this.consumePath(b)}eoFill(){this.pendingEOFill=!0,this.fill()}fillStroke(){this.fill(!1),this.stroke(!1),this.consumePath()}eoFillStroke(){this.pendingEOFill=!0,this.fillStroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()}endPath(){this.consumePath()}clip(){this.pendingClip=ct}eoClip(){this.pendingClip=K}beginText(){this.current.textMatrix=l.IDENTITY_MATRIX,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){const s=this.pendingTextPaths,t=this.ctx;if(s===void 0){t.beginPath();return}t.save(),t.beginPath();for(const i of s)t.setTransform(...i.transform),t.translate(i.x,i.y),i.addToPath(t,i.fontSize);t.restore(),t.clip(),t.beginPath(),delete this.pendingTextPaths}setCharSpacing(s){this.current.charSpacing=s}setWordSpacing(s){this.current.wordSpacing=s}setHScale(s){this.current.textHScale=s/100}setLeading(s){this.current.leading=-s}setFont(s,t){const i=this.commonObjs.get(s),a=this.current;if(!i)throw new Error(`Can't find font for ${s}`);if(a.fontMatrix=i.fontMatrix||l.FONT_IDENTITY_MATRIX,(a.fontMatrix[0]===0||a.fontMatrix[3]===0)&&(0,l.warn)("Invalid font matrix for font "+s),t<0?(t=-t,a.fontDirection=-1):a.fontDirection=1,this.current.font=i,this.current.fontSize=t,i.isType3Font)return;const d=i.loadedName||"sans-serif",b=i.systemFontInfo?.css||`"${d}", ${i.fallbackName}`;let S="normal";i.black?S="900":i.bold&&(S="bold");const R=i.italic?"italic":"normal";let _=t;t<r?_=r:t>u&&(_=u),this.current.fontSizeScale=t/_,this.ctx.font=`${R} ${S} ${_}px ${b}`}setTextRenderingMode(s){this.current.textRenderingMode=s}setTextRise(s){this.current.textRise=s}moveText(s,t){this.current.x=this.current.lineX+=s,this.current.y=this.current.lineY+=t}setLeadingMoveText(s,t){this.setLeading(-t),this.moveText(s,t)}setTextMatrix(s,t,i,a,d,b){this.current.textMatrix=[s,t,i,a,d,b],this.current.textMatrixScale=Math.hypot(s,t),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(s,t,i,a){const d=this.ctx,b=this.current,S=b.font,R=b.textRenderingMode,_=b.fontSize/b.fontSizeScale,N=R&l.TextRenderingMode.FILL_STROKE_MASK,H=!!(R&l.TextRenderingMode.ADD_TO_PATH_FLAG),V=b.patternFill&&!S.missingFile;let B;(S.disableFontFace||H||V)&&(B=S.getPathGenerator(this.commonObjs,s)),S.disableFontFace||V?(d.save(),d.translate(t,i),d.beginPath(),B(d,_),a&&d.setTransform(...a),(N===l.TextRenderingMode.FILL||N===l.TextRenderingMode.FILL_STROKE)&&d.fill(),(N===l.TextRenderingMode.STROKE||N===l.TextRenderingMode.FILL_STROKE)&&d.stroke(),d.restore()):((N===l.TextRenderingMode.FILL||N===l.TextRenderingMode.FILL_STROKE)&&d.fillText(s,t,i),(N===l.TextRenderingMode.STROKE||N===l.TextRenderingMode.FILL_STROKE)&&d.strokeText(s,t,i)),H&&(this.pendingTextPaths||=[]).push({transform:(0,D.getCurrentTransform)(d),x:t,y:i,fontSize:_,addToPath:B})}get isFontSubpixelAAEnabled(){const{context:s}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);s.scale(1.5,1),s.fillText("I",0,10);const t=s.getImageData(0,0,10,10).data;let i=!1;for(let a=3;a<t.length;a+=4)if(t[a]>0&&t[a]<255){i=!0;break}return(0,l.shadow)(this,"isFontSubpixelAAEnabled",i)}showText(s){const t=this.current,i=t.font;if(i.isType3Font)return this.showType3Text(s);const a=t.fontSize;if(a===0)return;const d=this.ctx,b=t.fontSizeScale,S=t.charSpacing,R=t.wordSpacing,_=t.fontDirection,N=t.textHScale*_,H=s.length,V=i.vertical,B=V?1:-1,F=i.defaultVMetrics,O=a*t.fontMatrix[0],Y=t.textRenderingMode===l.TextRenderingMode.FILL&&!i.disableFontFace&&!t.patternFill;d.save(),d.transform(...t.textMatrix),d.translate(t.x,t.y+t.textRise),_>0?d.scale(N,-1):d.scale(N,1);let j;if(t.patternFill){d.save();const nt=t.fillColor.getPattern(d,this,(0,D.getCurrentTransformInverse)(d),y.FILL);j=(0,D.getCurrentTransform)(d),d.restore(),d.fillStyle=nt}let Q=t.lineWidth;const st=t.textMatrixScale;if(st===0||Q===0){const nt=t.textRenderingMode&l.TextRenderingMode.FILL_STROKE_MASK;(nt===l.TextRenderingMode.STROKE||nt===l.TextRenderingMode.FILL_STROKE)&&(Q=this.getSinglePixelWidth())}else Q/=st;if(b!==1&&(d.scale(b,b),Q/=b),d.lineWidth=Q,i.isInvalidPDFjsFont){const nt=[];let ht=0;for(const mt of s)nt.push(mt.unicode),ht+=mt.width;d.fillText(nt.join(""),0,0),t.x+=ht*O*N,d.restore(),this.compose();return}let it=0,rt;for(rt=0;rt<H;++rt){const nt=s[rt];if(typeof nt=="number"){it+=B*nt*a/1e3;continue}let ht=!1;const mt=(nt.isSpace?R:0)+S,At=nt.fontChar,St=nt.accent;let pt,Mt,Ft=nt.width;if(V){const xt=nt.vmetric||F,Tt=-(nt.vmetric?xt[1]:Ft*.5)*O,Ct=xt[2]*O;Ft=xt?-xt[0]:Ft,pt=Tt/b,Mt=(it+Ct)/b}else pt=it/b,Mt=0;if(i.remeasure&&Ft>0){const xt=d.measureText(At).width*1e3/a*b;if(Ft<xt&&this.isFontSubpixelAAEnabled){const Tt=Ft/xt;ht=!0,d.save(),d.scale(Tt,1),pt/=Tt}else Ft!==xt&&(pt+=(Ft-xt)/2e3*a/b)}if(this.contentVisible&&(nt.isInFont||i.missingFile)){if(Y&&!St)d.fillText(At,pt,Mt);else if(this.paintChar(At,pt,Mt,j),St){const xt=pt+a*St.offset.x/b,Tt=Mt-a*St.offset.y/b;this.paintChar(St.fontChar,xt,Tt,j)}}const It=V?Ft*O-mt*_:Ft*O+mt*_;it+=It,ht&&d.restore()}V?t.y-=it:t.x+=it*N,d.restore(),this.compose()}showType3Text(s){const t=this.ctx,i=this.current,a=i.font,d=i.fontSize,b=i.fontDirection,S=a.vertical?1:-1,R=i.charSpacing,_=i.wordSpacing,N=i.textHScale*b,H=i.fontMatrix||l.FONT_IDENTITY_MATRIX,V=s.length,B=i.textRenderingMode===l.TextRenderingMode.INVISIBLE;let F,O,Y,j;if(!(B||d===0)){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,t.save(),t.transform(...i.textMatrix),t.translate(i.x,i.y),t.scale(N,b),F=0;F<V;++F){if(O=s[F],typeof O=="number"){j=S*O*d/1e3,this.ctx.translate(j,0),i.x+=j*N;continue}const Q=(O.isSpace?_:0)+R,st=a.charProcOperatorList[O.operatorListId];if(!st){(0,l.warn)(`Type3 character "${O.operatorListId}" is not available.`);continue}this.contentVisible&&(this.processingType3=O,this.save(),t.scale(d,d),t.transform(...H),this.executeOperatorList(st),this.restore()),Y=l.Util.applyTransform([O.width,0],H)[0]*d+Q,t.translate(Y,0),i.x+=Y*N}t.restore(),this.processingType3=null}}setCharWidth(s,t){}setCharWidthAndBounds(s,t,i,a,d,b){this.ctx.rect(i,a,d-i,b-a),this.ctx.clip(),this.endPath()}getColorN_Pattern(s){let t;if(s[0]==="TilingPattern"){const i=s[1],a=this.baseTransform||(0,D.getCurrentTransform)(this.ctx),d={createCanvasGraphics:b=>new f(b,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})};t=new m(s,i,this.ctx,d,a)}else t=this._getPattern(s[1],s[2]);return t}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments)}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(s,t,i){const a=l.Util.makeHexColor(s,t,i);this.ctx.strokeStyle=a,this.current.strokeColor=a}setFillRGBColor(s,t,i){const a=l.Util.makeHexColor(s,t,i);this.ctx.fillStyle=a,this.current.fillColor=a,this.current.patternFill=!1}_getPattern(s,t=null){let i;return this.cachedPatterns.has(s)?i=this.cachedPatterns.get(s):(i=p(this.getObject(s)),this.cachedPatterns.set(s,i)),t&&(i.matrix=t),i}shadingFill(s){if(!this.contentVisible)return;const t=this.ctx;this.save();const i=this._getPattern(s);t.fillStyle=i.getPattern(t,this,(0,D.getCurrentTransformInverse)(t),y.SHADING);const a=(0,D.getCurrentTransformInverse)(t);if(a){const{width:d,height:b}=t.canvas,[S,R,_,N]=l.Util.getAxialAlignedBoundingBox([0,0,d,b],a);this.ctx.fillRect(S,R,_-S,N-R)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){(0,l.unreachable)("Should not call beginInlineImage")}beginImageData(){(0,l.unreachable)("Should not call beginImageData")}paintFormXObjectBegin(s,t){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),Array.isArray(s)&&s.length===6&&this.transform(...s),this.baseTransform=(0,D.getCurrentTransform)(this.ctx),t)){const i=t[2]-t[0],a=t[3]-t[1];this.ctx.rect(t[0],t[1],i,a),this.current.updateRectMinMax((0,D.getCurrentTransform)(this.ctx),t),this.clip(),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(s){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const t=this.ctx;s.isolated||(0,l.info)("TODO: Support non-isolated groups."),s.knockout&&(0,l.warn)("Knockout groups not supported.");const i=(0,D.getCurrentTransform)(t);if(s.matrix&&t.transform(...s.matrix),!s.bbox)throw new Error("Bounding box is required.");let a=l.Util.getAxialAlignedBoundingBox(s.bbox,(0,D.getCurrentTransform)(t));const d=[0,0,t.canvas.width,t.canvas.height];a=l.Util.intersect(a,d)||[0,0,0,0];const b=Math.floor(a[0]),S=Math.floor(a[1]);let R=Math.max(Math.ceil(a[2])-b,1),_=Math.max(Math.ceil(a[3])-S,1),N=1,H=1;R>w&&(N=R/w,R=w),_>w&&(H=_/w,_=w),this.current.startNewPathAndClipBox([0,0,R,_]);let V="groupAt"+this.groupLevel;s.smask&&(V+="_smask_"+this.smaskCounter++%2);const B=this.cachedCanvases.getCanvas(V,R,_),F=B.context;F.scale(1/N,1/H),F.translate(-b,-S),F.transform(...i),s.smask?this.smaskStack.push({canvas:B.canvas,context:F,offsetX:b,offsetY:S,scaleX:N,scaleY:H,subtype:s.smask.subtype,backdrop:s.smask.backdrop,transferMap:s.smask.transferMap||null,startTransformInverse:null}):(t.setTransform(1,0,0,1,0,0),t.translate(b,S),t.scale(N,H),t.save()),$(t,F),this.ctx=F,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(t),this.groupLevel++}endGroup(s){if(!this.contentVisible)return;this.groupLevel--;const t=this.ctx,i=this.groupStack.pop();if(this.ctx=i,this.ctx.imageSmoothingEnabled=!1,s.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();const a=(0,D.getCurrentTransform)(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...a);const d=l.Util.getAxialAlignedBoundingBox([0,0,t.canvas.width,t.canvas.height],a);this.ctx.drawImage(t.canvas,0,0),this.ctx.restore(),this.compose(d)}}beginAnnotation(s,t,i,a,d){if(this.#t(),U(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),Array.isArray(t)&&t.length===4){const b=t[2]-t[0],S=t[3]-t[1];if(d&&this.annotationCanvasMap){i=i.slice(),i[4]-=t[0],i[5]-=t[1],t=t.slice(),t[0]=t[1]=0,t[2]=b,t[3]=S;const[R,_]=l.Util.singularValueDecompose2dScale((0,D.getCurrentTransform)(this.ctx)),{viewportScale:N}=this,H=Math.ceil(b*this.outputScaleX*N),V=Math.ceil(S*this.outputScaleY*N);this.annotationCanvas=this.canvasFactory.create(H,V);const{canvas:B,context:F}=this.annotationCanvas;this.annotationCanvasMap.set(s,B),this.annotationCanvas.savedCtx=this.ctx,this.ctx=F,this.ctx.save(),this.ctx.setTransform(R,0,0,-_,0,S*_),U(this.ctx)}else U(this.ctx),this.ctx.rect(t[0],t[1],b,S),this.ctx.clip(),this.endPath()}this.current=new et(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...i),this.transform(...a)}endAnnotation(){this.annotationCanvas&&(this.ctx.restore(),this.#e(),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(s){if(!this.contentVisible)return;const t=s.count;s=this.getObject(s.data,s),s.count=t;const i=this.ctx,a=this.processingType3;if(a&&(a.compiled===void 0&&(a.compiled=q(s)),a.compiled)){a.compiled(i);return}const d=this._createMaskCanvas(s),b=d.canvas;i.save(),i.setTransform(1,0,0,1,0,0),i.drawImage(b,d.offsetX,d.offsetY),i.restore(),this.compose()}paintImageMaskXObjectRepeat(s,t,i=0,a=0,d,b){if(!this.contentVisible)return;s=this.getObject(s.data,s);const S=this.ctx;S.save();const R=(0,D.getCurrentTransform)(S);S.transform(t,i,a,d,0,0);const _=this._createMaskCanvas(s);S.setTransform(1,0,0,1,_.offsetX-R[4],_.offsetY-R[5]);for(let N=0,H=b.length;N<H;N+=2){const V=l.Util.transform(R,[t,i,a,d,b[N],b[N+1]]),[B,F]=l.Util.applyTransform([0,0],V);S.drawImage(_.canvas,B,F)}S.restore(),this.compose()}paintImageMaskXObjectGroup(s){if(!this.contentVisible)return;const t=this.ctx,i=this.current.fillColor,a=this.current.patternFill;for(const d of s){const{data:b,width:S,height:R,transform:_}=d,N=this.cachedCanvases.getCanvas("maskCanvas",S,R),H=N.context;H.save();const V=this.getObject(b,d);W(H,V),H.globalCompositeOperation="source-in",H.fillStyle=a?i.getPattern(H,this,(0,D.getCurrentTransformInverse)(t),y.FILL):i,H.fillRect(0,0,S,R),H.restore(),t.save(),t.transform(..._),t.scale(1,-1),X(t,N.canvas,0,0,S,R,0,-1,1,1),t.restore()}this.compose()}paintImageXObject(s){if(!this.contentVisible)return;const t=this.getObject(s);if(!t){(0,l.warn)("Dependent image isn't ready yet");return}this.paintInlineImageXObject(t)}paintImageXObjectRepeat(s,t,i,a){if(!this.contentVisible)return;const d=this.getObject(s);if(!d){(0,l.warn)("Dependent image isn't ready yet");return}const b=d.width,S=d.height,R=[];for(let _=0,N=a.length;_<N;_+=2)R.push({transform:[t,0,0,i,a[_],a[_+1]],x:0,y:0,w:b,h:S});this.paintInlineImageXObjectGroup(d,R)}applyTransferMapsToCanvas(s){return this.current.transferMaps!=="none"&&(s.filter=this.current.transferMaps,s.drawImage(s.canvas,0,0),s.filter="none"),s.canvas}applyTransferMapsToBitmap(s){if(this.current.transferMaps==="none")return s.bitmap;const{bitmap:t,width:i,height:a}=s,d=this.cachedCanvases.getCanvas("inlineImage",i,a),b=d.context;return b.filter=this.current.transferMaps,b.drawImage(t,0,0),b.filter="none",d.canvas}paintInlineImageXObject(s){if(!this.contentVisible)return;const t=s.width,i=s.height,a=this.ctx;if(this.save(),!l.isNodeJS){const{filter:S}=a;S!=="none"&&S!==""&&(a.filter="none")}a.scale(1/t,-1/i);let d;if(s.bitmap)d=this.applyTransferMapsToBitmap(s);else if(typeof HTMLElement=="function"&&s instanceof HTMLElement||!s.data)d=s;else{const R=this.cachedCanvases.getCanvas("inlineImage",t,i).context;at(R,s),d=this.applyTransferMapsToCanvas(R)}const b=this._scaleImage(d,(0,D.getCurrentTransformInverse)(a));a.imageSmoothingEnabled=ot((0,D.getCurrentTransform)(a),s.interpolate),X(a,b.img,0,0,b.paintWidth,b.paintHeight,0,-i,t,i),this.compose(),this.restore()}paintInlineImageXObjectGroup(s,t){if(!this.contentVisible)return;const i=this.ctx;let a;if(s.bitmap)a=s.bitmap;else{const d=s.width,b=s.height,R=this.cachedCanvases.getCanvas("inlineImage",d,b).context;at(R,s),a=this.applyTransferMapsToCanvas(R)}for(const d of t)i.save(),i.transform(...d.transform),i.scale(1,-1),X(i,a,d.x,d.y,d.w,d.h,0,-1,1,1),i.restore();this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(s){}markPointProps(s,t){}beginMarkedContent(s){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(s,t){s==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(t)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(s){const t=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(s);const i=this.ctx;this.pendingClip&&(t||(this.pendingClip===K?i.clip("evenodd"):i.clip()),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),i.beginPath()}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const s=(0,D.getCurrentTransform)(this.ctx);if(s[1]===0&&s[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(s[0]),Math.abs(s[3]));else{const t=Math.abs(s[0]*s[3]-s[2]*s[1]),i=Math.hypot(s[0],s[2]),a=Math.hypot(s[1],s[3]);this._cachedGetSinglePixelWidth=Math.max(i,a)/t}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:s}=this.current,{a:t,b:i,c:a,d}=this.ctx.getTransform();let b,S;if(i===0&&a===0){const R=Math.abs(t),_=Math.abs(d);if(R===_)if(s===0)b=S=1/R;else{const N=R*s;b=S=N<1?1/N:1}else if(s===0)b=1/R,S=1/_;else{const N=R*s,H=_*s;b=N<1?1/N:1,S=H<1?1/H:1}}else{const R=Math.abs(t*d-i*a),_=Math.hypot(t,i),N=Math.hypot(a,d);if(s===0)b=N/R,S=_/R;else{const H=s*R;b=N>H?N/H:1,S=_>H?_/H:1}}this._cachedScaleForStroking[0]=b,this._cachedScaleForStroking[1]=S}return this._cachedScaleForStroking}rescaleAndStroke(s){const{ctx:t}=this,{lineWidth:i}=this.current,[a,d]=this.getScaleForStroking();if(t.lineWidth=i||1,a===1&&d===1){t.stroke();return}const b=t.getLineDash();if(s&&t.save(),t.scale(a,d),b.length>0){const S=Math.max(a,d);t.setLineDash(b.map(R=>R/S)),t.lineDashOffset/=S}t.stroke(),s&&t.restore()}isContentVisible(){for(let s=this.markedContentStack.length-1;s>=0;s--)if(!this.markedContentStack[s].visible)return!1;return!0}}for(const h in l.OPS)f.prototype[h]!==void 0&&(f.prototype[l.OPS[h]]=f.prototype[h])},473:(L,C,x)=>{x.d(C,{DOMCMapReaderFactory:()=>g,DOMCanvasFactory:()=>T,DOMFilterFactory:()=>E,DOMSVGFactory:()=>c,DOMStandardFontDataFactory:()=>o,PDFDateString:()=>M,PageViewport:()=>p,PixelsPerInch:()=>P,RenderingCancelledException:()=>n,StatTimer:()=>w,fetchData:()=>v,getColorValues:()=>X,getCurrentTransform:()=>q,getCurrentTransformInverse:()=>et,getFilenameFromUrl:()=>r,getPdfFilenameFromUrl:()=>u,getRGB:()=>G,getXfaPageViewport:()=>z,isDataScheme:()=>m,isPdfFile:()=>e,isValidFetchUrl:()=>A,noContextMenu:()=>I,setLayerDimensions:()=>at});var l=x(822),D=x(266);const y="http://www.w3.org/2000/svg";class P{static CSS=96;static PDF=72;static PDF_TO_CSS_UNITS=this.CSS/this.PDF}class E extends l.BaseFilterFactory{#t;#e;#s;#i;#n;#r;#o;#l;#h;#c;#f=0;constructor({docId:$,ownerDocument:U=globalThis.document}={}){super(),this.#s=$,this.#i=U}get#u(){return this.#t||=new Map}get#d(){if(!this.#e){const $=this.#i.createElement("div"),{style:U}=$;U.visibility="hidden",U.contain="strict",U.width=U.height=0,U.position="absolute",U.top=U.left=0,U.zIndex=-1;const J=this.#i.createElementNS(y,"svg");J.setAttribute("width",0),J.setAttribute("height",0),this.#e=this.#i.createElementNS(y,"defs"),$.append(J),J.append(this.#e),this.#i.body.append($)}return this.#e}addFilter($){if(!$)return"none";let U=this.#u.get($);if(U)return U;let J,Z,tt,ft;if($.length===1){const dt=$[0],ct=new Array(256);for(let K=0;K<256;K++)ct[K]=dt[K]/255;ft=J=Z=tt=ct.join(",")}else{const[dt,ct,K]=$,f=new Array(256),h=new Array(256),s=new Array(256);for(let t=0;t<256;t++)f[t]=dt[t]/255,h[t]=ct[t]/255,s[t]=K[t]/255;J=f.join(","),Z=h.join(","),tt=s.join(","),ft=`${J}${Z}${tt}`}if(U=this.#u.get(ft),U)return this.#u.set($,U),U;const lt=`g_${this.#s}_transfer_map_${this.#f++}`,ot=`url(#${lt})`;this.#u.set($,ot),this.#u.set(ft,ot);const gt=this.#p(lt);return this.#b(J,Z,tt,gt),ot}addHCMFilter($,U){const J=`${$}-${U}`;if(this.#r===J)return this.#o;if(this.#r=J,this.#o="none",this.#n?.remove(),!$||!U)return this.#o;const Z=this.#A($);$=D.Util.makeHexColor(...Z);const tt=this.#A(U);if(U=D.Util.makeHexColor(...tt),this.#d.style.color="",$==="#000000"&&U==="#ffffff"||$===U)return this.#o;const ft=new Array(256);for(let ct=0;ct<=255;ct++){const K=ct/255;ft[ct]=K<=.03928?K/12.92:((K+.055)/1.055)**2.4}const lt=ft.join(","),ot=`g_${this.#s}_hcm_filter`,gt=this.#l=this.#p(ot);this.#b(lt,lt,lt,gt),this.#a(gt);const dt=(ct,K)=>{const f=Z[ct]/255,h=tt[ct]/255,s=new Array(K+1);for(let t=0;t<=K;t++)s[t]=f+t/K*(h-f);return s.join(",")};return this.#b(dt(0,5),dt(1,5),dt(2,5),gt),this.#o=`url(#${ot})`,this.#o}addHighlightHCMFilter($,U,J,Z){const tt=`${$}-${U}-${J}-${Z}`;if(this.#h===tt)return this.#c;if(this.#h=tt,this.#c="none",this.#l?.remove(),!$||!U)return this.#c;const[ft,lt]=[$,U].map(this.#A.bind(this));let ot=Math.round(.2126*ft[0]+.7152*ft[1]+.0722*ft[2]),gt=Math.round(.2126*lt[0]+.7152*lt[1]+.0722*lt[2]),[dt,ct]=[J,Z].map(this.#A.bind(this));gt<ot&&([ot,gt,dt,ct]=[gt,ot,ct,dt]),this.#d.style.color="";const K=(s,t,i)=>{const a=new Array(256),d=(gt-ot)/i,b=s/255,S=(t-s)/(255*i);let R=0;for(let _=0;_<=i;_++){const N=Math.round(ot+_*d),H=b+_*S;for(let V=R;V<=N;V++)a[V]=H;R=N+1}for(let _=R;_<256;_++)a[_]=a[R-1];return a.join(",")},f=`g_${this.#s}_hcm_highlight_filter`,h=this.#l=this.#p(f);return this.#a(h),this.#b(K(dt[0],ct[0],5),K(dt[1],ct[1],5),K(dt[2],ct[2],5),h),this.#c=`url(#${f})`,this.#c}destroy($=!1){$&&(this.#o||this.#c)||(this.#e&&(this.#e.parentNode.parentNode.remove(),this.#e=null),this.#t&&(this.#t.clear(),this.#t=null),this.#f=0)}#a($){const U=this.#i.createElementNS(y,"feColorMatrix");U.setAttribute("type","matrix"),U.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),$.append(U)}#p($){const U=this.#i.createElementNS(y,"filter");return U.setAttribute("color-interpolation-filters","sRGB"),U.setAttribute("id",$),this.#d.append(U),U}#m($,U,J){const Z=this.#i.createElementNS(y,U);Z.setAttribute("type","discrete"),Z.setAttribute("tableValues",J),$.append(Z)}#b($,U,J,Z){const tt=this.#i.createElementNS(y,"feComponentTransfer");Z.append(tt),this.#m(tt,"feFuncR",$),this.#m(tt,"feFuncG",U),this.#m(tt,"feFuncB",J)}#A($){return this.#d.style.color=$,G(getComputedStyle(this.#d).getPropertyValue("color"))}}class T extends l.BaseCanvasFactory{constructor({ownerDocument:$=globalThis.document}={}){super(),this._document=$}_createCanvas($,U){const J=this._document.createElement("canvas");return J.width=$,J.height=U,J}}async function v(W,$="text"){if(A(W,document.baseURI)){const U=await fetch(W);if(!U.ok)throw new Error(U.statusText);switch($){case"arraybuffer":return U.arrayBuffer();case"blob":return U.blob();case"json":return U.json()}return U.text()}return new Promise((U,J)=>{const Z=new XMLHttpRequest;Z.open("GET",W,!0),Z.responseType=$,Z.onreadystatechange=()=>{if(Z.readyState===XMLHttpRequest.DONE){if(Z.status===200||Z.status===0){let tt;switch($){case"arraybuffer":case"blob":case"json":tt=Z.response;break;default:tt=Z.responseText;break}if(tt){U(tt);return}}J(new Error(Z.statusText))}},Z.send(null)})}class g extends l.BaseCMapReaderFactory{_fetchData($,U){return v($,this.isCompressed?"arraybuffer":"text").then(J=>({cMapData:J instanceof ArrayBuffer?new Uint8Array(J):(0,D.stringToBytes)(J),compressionType:U}))}}class o extends l.BaseStandardFontDataFactory{_fetchData($){return v($,"arraybuffer").then(U=>new Uint8Array(U))}}class c extends l.BaseSVGFactory{_createSVG($){return document.createElementNS(y,$)}}class p{constructor({viewBox:$,scale:U,rotation:J,offsetX:Z=0,offsetY:tt=0,dontFlip:ft=!1}){this.viewBox=$,this.scale=U,this.rotation=J,this.offsetX=Z,this.offsetY=tt;const lt=($[2]+$[0])/2,ot=($[3]+$[1])/2;let gt,dt,ct,K;switch(J%=360,J<0&&(J+=360),J){case 180:gt=-1,dt=0,ct=0,K=1;break;case 90:gt=0,dt=1,ct=1,K=0;break;case 270:gt=0,dt=-1,ct=-1,K=0;break;case 0:gt=1,dt=0,ct=0,K=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}ft&&(ct=-ct,K=-K);let f,h,s,t;gt===0?(f=Math.abs(ot-$[1])*U+Z,h=Math.abs(lt-$[0])*U+tt,s=($[3]-$[1])*U,t=($[2]-$[0])*U):(f=Math.abs(lt-$[0])*U+Z,h=Math.abs(ot-$[1])*U+tt,s=($[2]-$[0])*U,t=($[3]-$[1])*U),this.transform=[gt*U,dt*U,ct*U,K*U,f-gt*U*lt-ct*U*ot,h-dt*U*lt-K*U*ot],this.width=s,this.height=t}get rawDims(){const{viewBox:$}=this;return(0,D.shadow)(this,"rawDims",{pageWidth:$[2]-$[0],pageHeight:$[3]-$[1],pageX:$[0],pageY:$[1]})}clone({scale:$=this.scale,rotation:U=this.rotation,offsetX:J=this.offsetX,offsetY:Z=this.offsetY,dontFlip:tt=!1}={}){return new p({viewBox:this.viewBox.slice(),scale:$,rotation:U,offsetX:J,offsetY:Z,dontFlip:tt})}convertToViewportPoint($,U){return D.Util.applyTransform([$,U],this.transform)}convertToViewportRectangle($){const U=D.Util.applyTransform([$[0],$[1]],this.transform),J=D.Util.applyTransform([$[2],$[3]],this.transform);return[U[0],U[1],J[0],J[1]]}convertToPdfPoint($,U){return D.Util.applyInverseTransform([$,U],this.transform)}}class n extends D.BaseException{constructor($,U=0){super($,"RenderingCancelledException"),this.extraDelay=U}}function m(W){const $=W.length;let U=0;for(;U<$&&W[U].trim()==="";)U++;return W.substring(U,U+5).toLowerCase()==="data:"}function e(W){return typeof W=="string"&&/\.pdf$/i.test(W)}function r(W,$=!1){return $||([W]=W.split(/[#?]/,1)),W.substring(W.lastIndexOf("/")+1)}function u(W,$="document.pdf"){if(typeof W!="string")return $;if(m(W))return(0,D.warn)('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),$;const U=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/,J=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,Z=U.exec(W);let tt=J.exec(Z[1])||J.exec(Z[2])||J.exec(Z[3]);if(tt&&(tt=tt[0],tt.includes("%")))try{tt=J.exec(decodeURIComponent(tt))[0]}catch{}return tt||$}class w{started=Object.create(null);times=[];time($){$ in this.started&&(0,D.warn)(`Timer is already running for ${$}`),this.started[$]=Date.now()}timeEnd($){$ in this.started||(0,D.warn)(`Timer has not been started for ${$}`),this.times.push({name:$,start:this.started[$],end:Date.now()}),delete this.started[$]}toString(){const $=[];let U=0;for(const{name:J}of this.times)U=Math.max(J.length,U);for(const{name:J,start:Z,end:tt}of this.times)$.push(`${J.padEnd(U)} ${tt-Z}ms
`);return $.join("")}}function A(W,$){try{const{protocol:U}=$?new URL(W,$):new URL(W);return U==="http:"||U==="https:"}catch{return!1}}function I(W){W.preventDefault()}let k;class M{static toDateObject($){if(!$||typeof $!="string")return null;k||=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?");const U=k.exec($);if(!U)return null;const J=parseInt(U[1],10);let Z=parseInt(U[2],10);Z=Z>=1&&Z<=12?Z-1:0;let tt=parseInt(U[3],10);tt=tt>=1&&tt<=31?tt:1;let ft=parseInt(U[4],10);ft=ft>=0&&ft<=23?ft:0;let lt=parseInt(U[5],10);lt=lt>=0&&lt<=59?lt:0;let ot=parseInt(U[6],10);ot=ot>=0&&ot<=59?ot:0;const gt=U[7]||"Z";let dt=parseInt(U[8],10);dt=dt>=0&&dt<=23?dt:0;let ct=parseInt(U[9],10)||0;return ct=ct>=0&&ct<=59?ct:0,gt==="-"?(ft+=dt,lt+=ct):gt==="+"&&(ft-=dt,lt-=ct),new Date(Date.UTC(J,Z,tt,ft,lt,ot))}}function z(W,{scale:$=1,rotation:U=0}){const{width:J,height:Z}=W.attributes.style,tt=[0,0,parseInt(J),parseInt(Z)];return new p({viewBox:tt,scale:$,rotation:U})}function G(W){if(W.startsWith("#")){const $=parseInt(W.slice(1),16);return[($&16711680)>>16,($&65280)>>8,$&255]}return W.startsWith("rgb(")?W.slice(4,-1).split(",").map($=>parseInt($)):W.startsWith("rgba(")?W.slice(5,-1).split(",").map($=>parseInt($)).slice(0,3):((0,D.warn)(`Not a valid color format: "${W}"`),[0,0,0])}function X(W){const $=document.createElement("span");$.style.visibility="hidden",document.body.append($);for(const U of W.keys()){$.style.color=U;const J=window.getComputedStyle($).color;W.set(U,G(J))}$.remove()}function q(W){const{a:$,b:U,c:J,d:Z,e:tt,f:ft}=W.getTransform();return[$,U,J,Z,tt,ft]}function et(W){const{a:$,b:U,c:J,d:Z,e:tt,f:ft}=W.getTransform().invertSelf();return[$,U,J,Z,tt,ft]}function at(W,$,U=!1,J=!0){if($ instanceof p){const{pageWidth:Z,pageHeight:tt}=$.rawDims,{style:ft}=W,lt=D.FeatureTest.isCSSRoundSupported,ot=`var(--scale-factor) * ${Z}px`,gt=`var(--scale-factor) * ${tt}px`,dt=lt?`round(${ot}, 1px)`:`calc(${ot})`,ct=lt?`round(${gt}, 1px)`:`calc(${gt})`;!U||$.rotation%180===0?(ft.width=dt,ft.height=ct):(ft.width=ct,ft.height=dt)}J&&W.setAttribute("data-main-rotation",$.rotation)}},423:(L,C,x)=>{x.d(C,{DrawLayer:()=>y});var l=x(473),D=x(266);class y{#t=null;#e=0;#s=new Map;constructor({pageIndex:E}){this.pageIndex=E}setParent(E){if(!this.#t){this.#t=E;return}if(this.#t!==E){if(this.#s.size>0)for(const T of this.#s.values())T.remove(),E.append(T);this.#t=E}}static get _svgFactory(){return(0,D.shadow)(this,"_svgFactory",new l.DOMSVGFactory)}static#i(E,{x:T,y:v,width:g,height:o}){const{style:c}=E;c.top=`${100*v}%`,c.left=`${100*T}%`,c.width=`${100*g}%`,c.height=`${100*o}%`}#n(E){const T=y._svgFactory.create(1,1,!0);return this.#t.append(T),y.#i(T,E),T}highlight({outlines:E,box:T},v,g){const o=this.#e++,c=this.#n(T);c.classList.add("highlight");const p=y._svgFactory.createElement("defs");c.append(p);const n=y._svgFactory.createElement("path");p.append(n);const m=`path_p${this.pageIndex}_${o}`;n.setAttribute("id",m),n.setAttribute("d",y.#r(E));const e=y._svgFactory.createElement("clipPath");p.append(e);const r=`clip_${m}`;e.setAttribute("id",r),e.setAttribute("clipPathUnits","objectBoundingBox");const u=y._svgFactory.createElement("use");e.append(u),u.setAttribute("href",`#${m}`),u.classList.add("clip");const w=y._svgFactory.createElement("use");return c.append(w),c.setAttribute("fill",v),c.setAttribute("fill-opacity",g),w.setAttribute("href",`#${m}`),this.#s.set(o,c),{id:o,clipPathId:`url(#${r})`}}highlightOutline({outlines:E,box:T}){const v=this.#e++,g=this.#n(T);g.classList.add("highlightOutline");const o=y._svgFactory.createElement("defs");g.append(o);const c=y._svgFactory.createElement("path");o.append(c);const p=`path_p${this.pageIndex}_${v}`;c.setAttribute("id",p),c.setAttribute("d",y.#r(E)),c.setAttribute("vector-effect","non-scaling-stroke");const n=y._svgFactory.createElement("use");g.append(n),n.setAttribute("href",`#${p}`);const m=n.cloneNode();return g.append(m),n.classList.add("mainOutline"),m.classList.add("secondaryOutline"),this.#s.set(v,g),v}static#r(E){const T=[];for(const v of E){let[g,o]=v;T.push(`M${g} ${o}`);for(let c=2;c<v.length;c+=2){const p=v[c],n=v[c+1];p===g?(T.push(`V${n}`),o=n):n===o&&(T.push(`H${p}`),g=p)}T.push("Z")}return T.join(" ")}updateBox(E,T){y.#i(this.#s.get(E),T)}rotate(E,T){this.#s.get(E).setAttribute("data-main-rotation",T)}changeColor(E,T){this.#s.get(E).setAttribute("fill",T)}changeOpacity(E,T){this.#s.get(E).setAttribute("fill-opacity",T)}addClass(E,T){this.#s.get(E).classList.add(T)}removeClass(E,T){this.#s.get(E).classList.remove(T)}remove(E){this.#t!==null&&(this.#s.get(E).remove(),this.#s.delete(E))}destroy(){this.#t=null;for(const E of this.#s.values())E.remove();this.#s.clear()}}},629:(L,C,x)=>{x.d(C,{AnnotationEditorLayer:()=>n});var l=x(266),D=x(115),y=x(812),P=x(640);class E extends D.AnnotationEditor{#t=this.editorDivBlur.bind(this);#e=this.editorDivFocus.bind(this);#s=this.editorDivInput.bind(this);#i=this.editorDivKeydown.bind(this);#n;#r="";#o=`${this.id}-editor`;#l;#h=null;static _freeTextDefaultContent="";static _internalPadding=0;static _defaultColor=null;static _defaultFontSize=10;static get _keyboardManager(){const e=E.prototype,r=A=>A.isEmpty(),u=y.AnnotationEditorUIManager.TRANSLATE_SMALL,w=y.AnnotationEditorUIManager.TRANSLATE_BIG;return(0,l.shadow)(this,"_keyboardManager",new y.KeyboardManager([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],e.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],e.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],e._translateEmpty,{args:[-u,0],checker:r}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e._translateEmpty,{args:[-w,0],checker:r}],[["ArrowRight","mac+ArrowRight"],e._translateEmpty,{args:[u,0],checker:r}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e._translateEmpty,{args:[w,0],checker:r}],[["ArrowUp","mac+ArrowUp"],e._translateEmpty,{args:[0,-u],checker:r}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e._translateEmpty,{args:[0,-w],checker:r}],[["ArrowDown","mac+ArrowDown"],e._translateEmpty,{args:[0,u],checker:r}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e._translateEmpty,{args:[0,w],checker:r}]]))}static _type="freetext";static _editorType=l.AnnotationEditorType.FREETEXT;constructor(e){super({...e,name:"freeTextEditor"}),this.#n=e.color||E._defaultColor||D.AnnotationEditor._defaultLineColor,this.#l=e.fontSize||E._defaultFontSize}static initialize(e){D.AnnotationEditor.initialize(e,{strings:["pdfjs-free-text-default-content"]});const r=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(r.getPropertyValue("--freetext-padding"))}static updateDefaultParams(e,r){switch(e){case l.AnnotationEditorParamsType.FREETEXT_SIZE:E._defaultFontSize=r;break;case l.AnnotationEditorParamsType.FREETEXT_COLOR:E._defaultColor=r;break}}updateParams(e,r){switch(e){case l.AnnotationEditorParamsType.FREETEXT_SIZE:this.#c(r);break;case l.AnnotationEditorParamsType.FREETEXT_COLOR:this.#f(r);break}}static get defaultPropertiesToUpdate(){return[[l.AnnotationEditorParamsType.FREETEXT_SIZE,E._defaultFontSize],[l.AnnotationEditorParamsType.FREETEXT_COLOR,E._defaultColor||D.AnnotationEditor._defaultLineColor]]}get propertiesToUpdate(){return[[l.AnnotationEditorParamsType.FREETEXT_SIZE,this.#l],[l.AnnotationEditorParamsType.FREETEXT_COLOR,this.#n]]}#c(e){const r=w=>{this.editorDiv.style.fontSize=`calc(${w}px * var(--scale-factor))`,this.translate(0,-(w-this.#l)*this.parentScale),this.#l=w,this.#d()},u=this.#l;this.addCommands({cmd:()=>{r(e)},undo:()=>{r(u)},mustExec:!0,type:l.AnnotationEditorParamsType.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})}#f(e){const r=this.#n;this.addCommands({cmd:()=>{this.#n=this.editorDiv.style.color=e},undo:()=>{this.#n=this.editorDiv.style.color=r},mustExec:!0,type:l.AnnotationEditorParamsType.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})}_translateEmpty(e,r){this._uiManager.translateSelectedEditors(e,r,!0)}getInitialTranslation(){const e=this.parentScale;return[-E._internalPadding*e,-(E._internalPadding+this.#l)*e]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){this.isInEditMode()||(this.parent.setEditingState(!1),this.parent.updateToolbar(l.AnnotationEditorType.FREETEXT),super.enableEditMode(),this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),this.editorDiv.addEventListener("keydown",this.#i),this.editorDiv.addEventListener("focus",this.#e),this.editorDiv.addEventListener("blur",this.#t),this.editorDiv.addEventListener("input",this.#s))}disableEditMode(){this.isInEditMode()&&(this.parent.setEditingState(!0),super.disableEditMode(),this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",this.#o),this._isDraggable=!0,this.editorDiv.removeEventListener("keydown",this.#i),this.editorDiv.removeEventListener("focus",this.#e),this.editorDiv.removeEventListener("blur",this.#t),this.editorDiv.removeEventListener("input",this.#s),this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"))}focusin(e){this._focusEventsAllowed&&(super.focusin(e),e.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(){if(this.width){this.#m();return}this.enableEditMode(),this.editorDiv.focus(),this._initialOptions?.isCentered&&this.center(),this._initialOptions=null}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}#u(){const e=this.editorDiv.getElementsByTagName("div");if(e.length===0)return this.editorDiv.innerText;const r=[];for(const u of e)r.push(u.innerText.replace(/\r\n?|\n/,""));return r.join(`
`)}#d(){const[e,r]=this.parentDimensions;let u;if(this.isAttachedToDOM)u=this.div.getBoundingClientRect();else{const{currentLayer:w,div:A}=this,I=A.style.display;A.style.display="hidden",w.div.append(this.div),u=A.getBoundingClientRect(),A.remove(),A.style.display=I}this.rotation%180===this.parentRotation%180?(this.width=u.width/e,this.height=u.height/r):(this.width=u.height/e,this.height=u.width/r),this.fixAndSetPosition()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const e=this.#r,r=this.#r=this.#u().trimEnd();if(e===r)return;const u=w=>{if(this.#r=w,!w){this.remove();return}this.#a(),this._uiManager.rebuild(this),this.#d()};this.addCommands({cmd:()=>{u(r)},undo:()=>{u(e)},mustExec:!1}),this.#d()}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}dblclick(e){this.enterInEditMode()}keydown(e){e.target===this.div&&e.key==="Enter"&&(this.enterInEditMode(),e.preventDefault())}editorDivKeydown(e){E._keyboardManager.exec(this,e)}editorDivFocus(e){this.isEditing=!0}editorDivBlur(e){this.isEditing=!1}editorDivInput(e){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}render(){if(this.div)return this.div;let e,r;this.width&&(e=this.x,r=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",this.#o),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text"),this.enableEditing(),D.AnnotationEditor._l10nPromise.get("pdfjs-free-text-default-content").then(w=>this.editorDiv?.setAttribute("default-content",w)),this.editorDiv.contentEditable=!0;const{style:u}=this.editorDiv;if(u.fontSize=`calc(${this.#l}px * var(--scale-factor))`,u.color=this.#n,this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),(0,y.bindEvents)(this,this.div,["dblclick","keydown"]),this.width){const[w,A]=this.parentDimensions;if(this.annotationElementId){const{position:I}=this.#h;let[k,M]=this.getInitialTranslation();[k,M]=this.pageTranslationToScreen(k,M);const[z,G]=this.pageDimensions,[X,q]=this.pageTranslation;let et,at;switch(this.rotation){case 0:et=e+(I[0]-X)/z,at=r+this.height-(I[1]-q)/G;break;case 90:et=e+(I[0]-X)/z,at=r-(I[1]-q)/G,[k,M]=[M,-k];break;case 180:et=e-this.width+(I[0]-X)/z,at=r-(I[1]-q)/G,[k,M]=[-k,-M];break;case 270:et=e+(I[0]-X-this.height*G)/z,at=r+(I[1]-q-this.width*z)/G,[k,M]=[-M,k];break}this.setAt(et*w,at*A,k,M)}else this.setAt(e*w,r*A,this.width*w,this.height*A);this.#a(),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}#a(){if(this.editorDiv.replaceChildren(),!!this.#r)for(const e of this.#r.split(`
`)){const r=document.createElement("div");r.append(e?document.createTextNode(e):document.createElement("br")),this.editorDiv.append(r)}}get contentDiv(){return this.editorDiv}static deserialize(e,r,u){let w=null;if(e instanceof P.FreeTextAnnotationElement){const{data:{defaultAppearanceData:{fontSize:I,fontColor:k},rect:M,rotation:z,id:G},textContent:X,textPosition:q,parent:{page:{pageNumber:et}}}=e;if(!X||X.length===0)return null;w=e={annotationType:l.AnnotationEditorType.FREETEXT,color:Array.from(k),fontSize:I,value:X.join(`
`),position:q,pageIndex:et-1,rect:M,rotation:z,id:G,deleted:!1}}const A=super.deserialize(e,r,u);return A.#l=e.fontSize,A.#n=l.Util.makeHexColor(...e.color),A.#r=e.value,A.annotationElementId=e.id||null,A.#h=w,A}serialize(e=!1){if(this.isEmpty())return null;if(this.deleted)return{pageIndex:this.pageIndex,id:this.annotationElementId,deleted:!0};const r=E._internalPadding*this.parentScale,u=this.getRect(r,r),w=D.AnnotationEditor._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:this.#n),A={annotationType:l.AnnotationEditorType.FREETEXT,color:w,fontSize:this.#l,value:this.#r,pageIndex:this.pageIndex,rect:u,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return e?A:this.annotationElementId&&!this.#p(A)?null:(A.id=this.annotationElementId,A)}#p(e){const{value:r,fontSize:u,color:w,rect:A,pageIndex:I}=this.#h;return e.value!==r||e.fontSize!==u||e.rect.some((k,M)=>Math.abs(k-A[M])>=1)||e.color.some((k,M)=>k!==w[M])||e.pageIndex!==I}#m(e=!1){if(!this.annotationElementId)return;if(this.#d(),!e&&(this.width===0||this.height===0)){setTimeout(()=>this.#m(!0),0);return}const r=E._internalPadding*this.parentScale;this.#h.rect=this.getRect(r,r)}}var T=x(97),v=x(405);class g extends D.AnnotationEditor{#t;#e=null;#s=null;#i=null;#n=null;#r=null;#o=null;#l=null;#h;#c=null;static _defaultColor=null;static _defaultOpacity=1;static _l10nPromise;static _type="highlight";static _editorType=l.AnnotationEditorType.HIGHLIGHT;constructor(e){super({...e,name:"highlightEditor"}),g._defaultColor||=this._uiManager.highlightColors?.values().next().value||"#fff066",this.color=e.color||g._defaultColor,this.#h=e.opacity||g._defaultOpacity,this.#t=e.boxes||null,this._isDraggable=!1,this.#f(),this.#a(),this.rotate(this.rotation)}#f(){const e=new v.Outliner(this.#t,.001);this.#r=e.getOutlines(),{x:this.x,y:this.y,width:this.width,height:this.height}=this.#r.box;const r=new v.Outliner(this.#t,.0025,.001,this._uiManager.direction==="ltr");this.#i=r.getOutlines();const{lastPoint:u}=this.#i.box;this.#l=[(u[0]-this.x)/this.width,(u[1]-this.y)/this.height]}static initialize(e){D.AnnotationEditor.initialize(e)}static updateDefaultParams(e,r){switch(e){case l.AnnotationEditorParamsType.HIGHLIGHT_DEFAULT_COLOR:g._defaultColor=r;break}}get toolbarPosition(){return this.#l}updateParams(e,r){switch(e){case l.AnnotationEditorParamsType.HIGHLIGHT_COLOR:this.#u(r);break}}static get defaultPropertiesToUpdate(){return[[l.AnnotationEditorParamsType.HIGHLIGHT_DEFAULT_COLOR,g._defaultColor]]}get propertiesToUpdate(){return[[l.AnnotationEditorParamsType.HIGHLIGHT_COLOR,this.color||g._defaultColor]]}#u(e){const r=this.color;this.addCommands({cmd:()=>{this.color=e,this.parent.drawLayer.changeColor(this.#o,e),this.#s?.updateColor(e)},undo:()=>{this.color=r,this.parent.drawLayer.changeColor(this.#o,r),this.#s?.updateColor(r)},mustExec:!0,type:l.AnnotationEditorParamsType.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0})}async addEditToolbar(){const e=await super.addEditToolbar();return e?(this._uiManager.highlightColors&&(this.#s=new T.ColorPicker({editor:this}),e.addColorPicker(this.#s)),e):null}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(0)}getRect(e,r){return super.getRect(e,r,0)}onceAdded(){this.parent.addUndoableEditor(this),this.div.focus()}remove(){super.remove(),this.#d()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.#a(),this.isAttachedToDOM||this.parent.add(this)))}setParent(e){let r=!1;this.parent&&!e?this.#d():e&&(this.#a(e),r=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(e),r&&this.select()}#d(){this.#o===null||!this.parent||(this.parent.drawLayer.remove(this.#o),this.#o=null,this.parent.drawLayer.remove(this.#c),this.#c=null)}#a(e=this.parent){this.#o===null&&({id:this.#o,clipPathId:this.#e}=e.drawLayer.highlight(this.#r,this.color,this.#h),this.#n&&(this.#n.style.clipPath=this.#e),this.#c=e.drawLayer.highlightOutline(this.#i))}static#p({x:e,y:r,width:u,height:w},A){switch(A){case 90:return{x:1-r-w,y:e,width:w,height:u};case 180:return{x:1-e-u,y:1-r-w,width:u,height:w};case 270:return{x:r,y:1-e-u,width:w,height:u}}return{x:e,y:r,width:u,height:w}}rotate(e){const{drawLayer:r}=this.parent;r.rotate(this.#o,e),r.rotate(this.#c,e),r.updateBox(this.#o,g.#p(this,e)),r.updateBox(this.#c,g.#p(this.#i.box,e))}render(){if(this.div)return this.div;const e=super.render(),r=this.#n=document.createElement("div");e.append(r),r.className="internal",r.style.clipPath=this.#e;const[u,w]=this.parentDimensions;return this.setDims(this.width*u,this.height*w),(0,y.bindEvents)(this,this.#n,["pointerover","pointerleave"]),this.enableEditing(),e}pointerover(){this.parent.drawLayer.addClass(this.#c,"hovered")}pointerleave(){this.parent.drawLayer.removeClass(this.#c,"hovered")}select(){super.select(),this.parent?.drawLayer.removeClass(this.#c,"hovered"),this.parent?.drawLayer.addClass(this.#c,"selected")}unselect(){super.unselect(),this.parent?.drawLayer.removeClass(this.#c,"selected")}#m(){const[e,r]=this.pageDimensions,u=this.#t,w=new Array(u.length*8);let A=0;for(const{x:I,y:k,width:M,height:z}of u){const G=I*e,X=(1-k-z)*r;w[A]=w[A+4]=G,w[A+1]=w[A+3]=X,w[A+2]=w[A+6]=G+M*e,w[A+5]=w[A+7]=X+z*r,A+=8}return w}#b(){const[e,r]=this.pageDimensions,u=this.width*e,w=this.height*r,A=this.x*e,I=(1-this.y-this.height)*r,k=[];for(const M of this.#r.outlines){const z=new Array(M.length);for(let G=0;G<M.length;G+=2)z[G]=A+M[G]*u,z[G+1]=I+(1-M[G+1])*w;k.push(z)}return k}static deserialize(e,r,u){const w=super.deserialize(e,r,u),{rect:A,color:I,quadPoints:k}=e;w.color=l.Util.makeHexColor(...I),w.#h=e.opacity;const[M,z]=w.pageDimensions;w.width=(A[2]-A[0])/M,w.height=(A[3]-A[1])/z;const G=w.#t=[];for(let X=0;X<k.length;X+=8)G.push({x:k[4]/M,y:1-k[X+5]/z,width:(k[X+2]-k[X])/M,height:(k[X+5]-k[X+1])/z});return w.#f(),w}serialize(e=!1){if(this.isEmpty()||e)return null;const r=this.getRect(0,0),u=D.AnnotationEditor._colorManager.convert(this.color);return{annotationType:l.AnnotationEditorType.HIGHLIGHT,color:u,opacity:this.#h,quadPoints:this.#m(),outlines:this.#b(),pageIndex:this.pageIndex,rect:r,rotation:0,structTreeParentId:this._structTreeParentId}}static canCreateNewEmptyEditor(){return!1}}var o=x(473);class c extends D.AnnotationEditor{#t=0;#e=0;#s=this.canvasPointermove.bind(this);#i=this.canvasPointerleave.bind(this);#n=this.canvasPointerup.bind(this);#r=this.canvasPointerdown.bind(this);#o=null;#l=new Path2D;#h=!1;#c=!1;#f=!1;#u=null;#d=0;#a=0;#p=null;static _defaultColor=null;static _defaultOpacity=1;static _defaultThickness=1;static _type="ink";static _editorType=l.AnnotationEditorType.INK;constructor(e){super({...e,name:"inkEditor"}),this.color=e.color||null,this.thickness=e.thickness||null,this.opacity=e.opacity||null,this.paths=[],this.bezierPath2D=[],this.allRawPaths=[],this.currentPath=[],this.scaleFactor=1,this.translationX=this.translationY=0,this.x=0,this.y=0,this._willKeepAspectRatio=!0}static initialize(e){D.AnnotationEditor.initialize(e)}static updateDefaultParams(e,r){switch(e){case l.AnnotationEditorParamsType.INK_THICKNESS:c._defaultThickness=r;break;case l.AnnotationEditorParamsType.INK_COLOR:c._defaultColor=r;break;case l.AnnotationEditorParamsType.INK_OPACITY:c._defaultOpacity=r/100;break}}updateParams(e,r){switch(e){case l.AnnotationEditorParamsType.INK_THICKNESS:this.#m(r);break;case l.AnnotationEditorParamsType.INK_COLOR:this.#b(r);break;case l.AnnotationEditorParamsType.INK_OPACITY:this.#A(r);break}}static get defaultPropertiesToUpdate(){return[[l.AnnotationEditorParamsType.INK_THICKNESS,c._defaultThickness],[l.AnnotationEditorParamsType.INK_COLOR,c._defaultColor||D.AnnotationEditor._defaultLineColor],[l.AnnotationEditorParamsType.INK_OPACITY,Math.round(c._defaultOpacity*100)]]}get propertiesToUpdate(){return[[l.AnnotationEditorParamsType.INK_THICKNESS,this.thickness||c._defaultThickness],[l.AnnotationEditorParamsType.INK_COLOR,this.color||c._defaultColor||D.AnnotationEditor._defaultLineColor],[l.AnnotationEditorParamsType.INK_OPACITY,Math.round(100*(this.opacity??c._defaultOpacity))]]}#m(e){const r=this.thickness;this.addCommands({cmd:()=>{this.thickness=e,this.#R()},undo:()=>{this.thickness=r,this.#R()},mustExec:!0,type:l.AnnotationEditorParamsType.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0})}#b(e){const r=this.color;this.addCommands({cmd:()=>{this.color=e,this.#w()},undo:()=>{this.color=r,this.#w()},mustExec:!0,type:l.AnnotationEditorParamsType.INK_COLOR,overwriteIfSameType:!0,keepUndo:!0})}#A(e){e/=100;const r=this.opacity;this.addCommands({cmd:()=>{this.opacity=e,this.#w()},undo:()=>{this.opacity=r,this.#w()},mustExec:!0,type:l.AnnotationEditorParamsType.INK_OPACITY,overwriteIfSameType:!0,keepUndo:!0})}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.canvas||(this.#E(),this.#S()),this.isAttachedToDOM||(this.parent.add(this),this.#P()),this.#R()))}remove(){this.canvas!==null&&(this.isEmpty()||this.commit(),this.canvas.width=this.canvas.height=0,this.canvas.remove(),this.canvas=null,this.#o&&(clearTimeout(this.#o),this.#o=null),this.#u.disconnect(),this.#u=null,super.remove())}setParent(e){!this.parent&&e?this._uiManager.removeShouldRescale(this):this.parent&&e===null&&this._uiManager.addShouldRescale(this),super.setParent(e)}onScaleChanging(){const[e,r]=this.parentDimensions,u=this.width*e,w=this.height*r;this.setDimensions(u,w)}enableEditMode(){this.#h||this.canvas===null||(super.enableEditMode(),this._isDraggable=!1,this.canvas.addEventListener("pointerdown",this.#r))}disableEditMode(){!this.isInEditMode()||this.canvas===null||(super.disableEditMode(),this._isDraggable=!this.isEmpty(),this.div.classList.remove("editing"),this.canvas.removeEventListener("pointerdown",this.#r))}onceAdded(){this._isDraggable=!this.isEmpty()}isEmpty(){return this.paths.length===0||this.paths.length===1&&this.paths[0].length===0}#y(){const{parentRotation:e,parentDimensions:[r,u]}=this;switch(e){case 90:return[0,u,u,r];case 180:return[r,u,r,u];case 270:return[r,0,u,r];default:return[0,0,r,u]}}#v(){const{ctx:e,color:r,opacity:u,thickness:w,parentScale:A,scaleFactor:I}=this;e.lineWidth=w*A/I,e.lineCap="round",e.lineJoin="round",e.miterLimit=10,e.strokeStyle=`${r}${(0,y.opacityToHex)(u)}`}#g(e,r){this.canvas.addEventListener("contextmenu",o.noContextMenu),this.canvas.addEventListener("pointerleave",this.#i),this.canvas.addEventListener("pointermove",this.#s),this.canvas.addEventListener("pointerup",this.#n),this.canvas.removeEventListener("pointerdown",this.#r),this.isEditing=!0,this.#f||(this.#f=!0,this.#P(),this.thickness||=c._defaultThickness,this.color||=c._defaultColor||D.AnnotationEditor._defaultLineColor,this.opacity??=c._defaultOpacity),this.currentPath.push([e,r]),this.#c=!1,this.#v(),this.#p=()=>{this.#I(),this.#p&&window.requestAnimationFrame(this.#p)},window.requestAnimationFrame(this.#p)}#C(e,r){const[u,w]=this.currentPath.at(-1);if(this.currentPath.length>1&&e===u&&r===w)return;const A=this.currentPath;let I=this.#l;if(A.push([e,r]),this.#c=!0,A.length<=2){I.moveTo(...A[0]),I.lineTo(e,r);return}A.length===3&&(this.#l=I=new Path2D,I.moveTo(...A[0])),this.#_(I,...A.at(-3),...A.at(-2),e,r)}#L(){if(this.currentPath.length===0)return;const e=this.currentPath.at(-1);this.#l.lineTo(...e)}#M(e,r){this.#p=null,e=Math.min(Math.max(e,0),this.canvas.width),r=Math.min(Math.max(r,0),this.canvas.height),this.#C(e,r),this.#L();let u;if(this.currentPath.length!==1)u=this.#N();else{const M=[e,r];u=[[M,M.slice(),M.slice(),M]]}const w=this.#l,A=this.currentPath;this.currentPath=[],this.#l=new Path2D;const I=()=>{this.allRawPaths.push(A),this.paths.push(u),this.bezierPath2D.push(w),this.rebuild()},k=()=>{this.allRawPaths.pop(),this.paths.pop(),this.bezierPath2D.pop(),this.paths.length===0?this.remove():(this.canvas||(this.#E(),this.#S()),this.#R())};this.addCommands({cmd:I,undo:k,mustExec:!0})}#I(){if(!this.#c)return;this.#c=!1;const e=Math.ceil(this.thickness*this.parentScale),r=this.currentPath.slice(-3),u=r.map(I=>I[0]),w=r.map(I=>I[1]);Math.min(...u)-e,Math.max(...u)+e,Math.min(...w)-e,Math.max(...w)+e;const{ctx:A}=this;A.save(),A.clearRect(0,0,this.canvas.width,this.canvas.height);for(const I of this.bezierPath2D)A.stroke(I);A.stroke(this.#l),A.restore()}#_(e,r,u,w,A,I,k){const M=(r+w)/2,z=(u+A)/2,G=(w+I)/2,X=(A+k)/2;e.bezierCurveTo(M+2*(w-M)/3,z+2*(A-z)/3,G+2*(w-G)/3,X+2*(A-X)/3,G,X)}#N(){const e=this.currentPath;if(e.length<=2)return[[e[0],e[0],e.at(-1),e.at(-1)]];const r=[];let u,[w,A]=e[0];for(u=1;u<e.length-2;u++){const[q,et]=e[u],[at,W]=e[u+1],$=(q+at)/2,U=(et+W)/2,J=[w+2*(q-w)/3,A+2*(et-A)/3],Z=[$+2*(q-$)/3,U+2*(et-U)/3];r.push([[w,A],J,Z,[$,U]]),[w,A]=[$,U]}const[I,k]=e[u],[M,z]=e[u+1],G=[w+2*(I-w)/3,A+2*(k-A)/3],X=[M+2*(I-M)/3,z+2*(k-z)/3];return r.push([[w,A],G,X,[M,z]]),r}#w(){if(this.isEmpty()){this.#T();return}this.#v();const{canvas:e,ctx:r}=this;r.setTransform(1,0,0,1,0,0),r.clearRect(0,0,e.width,e.height),this.#T();for(const u of this.bezierPath2D)r.stroke(u)}commit(){this.#h||(super.commit(),this.isEditing=!1,this.disableEditMode(),this.setInForeground(),this.#h=!0,this.div.classList.add("disabled"),this.#R(!0),this.select(),this.parent.addInkEditorIfNeeded(!0),this.moveInDOM(),this.div.focus({preventScroll:!0}))}focusin(e){this._focusEventsAllowed&&(super.focusin(e),this.enableEditMode())}canvasPointerdown(e){e.button!==0||!this.isInEditMode()||this.#h||(this.setInForeground(),e.preventDefault(),this.div.contains(document.activeElement)||this.div.focus({preventScroll:!0}),this.#g(e.offsetX,e.offsetY))}canvasPointermove(e){e.preventDefault(),this.#C(e.offsetX,e.offsetY)}canvasPointerup(e){e.preventDefault(),this.#D(e)}canvasPointerleave(e){this.#D(e)}#D(e){this.canvas.removeEventListener("pointerleave",this.#i),this.canvas.removeEventListener("pointermove",this.#s),this.canvas.removeEventListener("pointerup",this.#n),this.canvas.addEventListener("pointerdown",this.#r),this.#o&&clearTimeout(this.#o),this.#o=setTimeout(()=>{this.#o=null,this.canvas.removeEventListener("contextmenu",o.noContextMenu)},10),this.#M(e.offsetX,e.offsetY),this.addToAnnotationStorage(),this.setInBackground()}#E(){this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=0,this.canvas.className="inkEditorCanvas",this.canvas.setAttribute("data-l10n-id","pdfjs-ink-canvas"),this.div.append(this.canvas),this.ctx=this.canvas.getContext("2d")}#S(){this.#u=new ResizeObserver(e=>{const r=e[0].contentRect;r.width&&r.height&&this.setDimensions(r.width,r.height)}),this.#u.observe(this.div)}get isResizable(){return!this.isEmpty()&&this.#h}render(){if(this.div)return this.div;let e,r;this.width&&(e=this.x,r=this.y),super.render(),this.div.setAttribute("data-l10n-id","pdfjs-ink");const[u,w,A,I]=this.#y();if(this.setAt(u,w,0,0),this.setDims(A,I),this.#E(),this.width){const[k,M]=this.parentDimensions;this.setAspectRatio(this.width*k,this.height*M),this.setAt(e*k,r*M,this.width*k,this.height*M),this.#f=!0,this.#P(),this.setDims(this.width*k,this.height*M),this.#w(),this.div.classList.add("disabled")}else this.div.classList.add("editing"),this.enableEditMode();return this.#S(),this.div}#P(){if(!this.#f)return;const[e,r]=this.parentDimensions;this.canvas.width=Math.ceil(this.width*e),this.canvas.height=Math.ceil(this.height*r),this.#T()}setDimensions(e,r){const u=Math.round(e),w=Math.round(r);if(this.#d===u&&this.#a===w)return;this.#d=u,this.#a=w,this.canvas.style.visibility="hidden";const[A,I]=this.parentDimensions;this.width=e/A,this.height=r/I,this.fixAndSetPosition(),this.#h&&this.#H(e,r),this.#P(),this.#w(),this.canvas.style.visibility="visible",this.fixDims()}#H(e,r){const u=this.#O(),w=(e-u)/this.#e,A=(r-u)/this.#t;this.scaleFactor=Math.min(w,A)}#T(){const e=this.#O()/2;this.ctx.setTransform(this.scaleFactor,0,0,this.scaleFactor,this.translationX*this.scaleFactor+e,this.translationY*this.scaleFactor+e)}static#k(e){const r=new Path2D;for(let u=0,w=e.length;u<w;u++){const[A,I,k,M]=e[u];u===0&&r.moveTo(...A),r.bezierCurveTo(I[0],I[1],k[0],k[1],M[0],M[1])}return r}static#F(e,r,u){const[w,A,I,k]=r;switch(u){case 0:for(let M=0,z=e.length;M<z;M+=2)e[M]+=w,e[M+1]=k-e[M+1];break;case 90:for(let M=0,z=e.length;M<z;M+=2){const G=e[M];e[M]=e[M+1]+w,e[M+1]=G+A}break;case 180:for(let M=0,z=e.length;M<z;M+=2)e[M]=I-e[M],e[M+1]+=A;break;case 270:for(let M=0,z=e.length;M<z;M+=2){const G=e[M];e[M]=I-e[M+1],e[M+1]=k-G}break;default:throw new Error("Invalid rotation")}return e}static#z(e,r,u){const[w,A,I,k]=r;switch(u){case 0:for(let M=0,z=e.length;M<z;M+=2)e[M]-=w,e[M+1]=k-e[M+1];break;case 90:for(let M=0,z=e.length;M<z;M+=2){const G=e[M];e[M]=e[M+1]-A,e[M+1]=G-w}break;case 180:for(let M=0,z=e.length;M<z;M+=2)e[M]=I-e[M],e[M+1]-=A;break;case 270:for(let M=0,z=e.length;M<z;M+=2){const G=e[M];e[M]=k-e[M+1],e[M+1]=I-G}break;default:throw new Error("Invalid rotation")}return e}#G(e,r,u,w){const A=[],I=this.thickness/2,k=e*r+I,M=e*u+I;for(const z of this.paths){const G=[],X=[];for(let q=0,et=z.length;q<et;q++){const[at,W,$,U]=z[q],J=e*at[0]+k,Z=e*at[1]+M,tt=e*W[0]+k,ft=e*W[1]+M,lt=e*$[0]+k,ot=e*$[1]+M,gt=e*U[0]+k,dt=e*U[1]+M;q===0&&(G.push(J,Z),X.push(J,Z)),G.push(tt,ft,lt,ot,gt,dt),X.push(tt,ft),q===et-1&&X.push(gt,dt)}A.push({bezier:c.#F(G,w,this.rotation),points:c.#F(X,w,this.rotation)})}return A}#B(){let e=1/0,r=-1/0,u=1/0,w=-1/0;for(const A of this.paths)for(const[I,k,M,z]of A){const G=l.Util.bezierBoundingBox(...I,...k,...M,...z);e=Math.min(e,G[0]),u=Math.min(u,G[1]),r=Math.max(r,G[2]),w=Math.max(w,G[3])}return[e,u,r,w]}#O(){return this.#h?Math.ceil(this.thickness*this.parentScale):0}#R(e=!1){if(this.isEmpty())return;if(!this.#h){this.#w();return}const r=this.#B(),u=this.#O();this.#e=Math.max(D.AnnotationEditor.MIN_SIZE,r[2]-r[0]),this.#t=Math.max(D.AnnotationEditor.MIN_SIZE,r[3]-r[1]);const w=Math.ceil(u+this.#e*this.scaleFactor),A=Math.ceil(u+this.#t*this.scaleFactor),[I,k]=this.parentDimensions;this.width=w/I,this.height=A/k,this.setAspectRatio(w,A);const M=this.translationX,z=this.translationY;this.translationX=-r[0],this.translationY=-r[1],this.#P(),this.#w(),this.#d=w,this.#a=A,this.setDims(w,A);const G=e?u/this.scaleFactor/2:0;this.translate(M-this.translationX-G,z-this.translationY-G)}static deserialize(e,r,u){if(e instanceof P.InkAnnotationElement)return null;const w=super.deserialize(e,r,u);w.thickness=e.thickness,w.color=l.Util.makeHexColor(...e.color),w.opacity=e.opacity;const[A,I]=w.pageDimensions,k=w.width*A,M=w.height*I,z=w.parentScale,G=e.thickness/2;w.#h=!0,w.#d=Math.round(k),w.#a=Math.round(M);const{paths:X,rect:q,rotation:et}=e;for(let{bezier:W}of X){W=c.#z(W,q,et);const $=[];w.paths.push($);let U=z*(W[0]-G),J=z*(W[1]-G);for(let tt=2,ft=W.length;tt<ft;tt+=6){const lt=z*(W[tt]-G),ot=z*(W[tt+1]-G),gt=z*(W[tt+2]-G),dt=z*(W[tt+3]-G),ct=z*(W[tt+4]-G),K=z*(W[tt+5]-G);$.push([[U,J],[lt,ot],[gt,dt],[ct,K]]),U=ct,J=K}const Z=this.#k($);w.bezierPath2D.push(Z)}const at=w.#B();return w.#e=Math.max(D.AnnotationEditor.MIN_SIZE,at[2]-at[0]),w.#t=Math.max(D.AnnotationEditor.MIN_SIZE,at[3]-at[1]),w.#H(k,M),w}serialize(){if(this.isEmpty())return null;const e=this.getRect(0,0),r=D.AnnotationEditor._colorManager.convert(this.ctx.strokeStyle);return{annotationType:l.AnnotationEditorType.INK,color:r,thickness:this.thickness,opacity:this.opacity,paths:this.#G(this.scaleFactor/this.parentScale,this.translationX,this.translationY,e),pageIndex:this.pageIndex,rect:e,rotation:this.rotation,structTreeParentId:this._structTreeParentId}}}class p extends D.AnnotationEditor{#t=null;#e=null;#s=null;#i=null;#n=null;#r="";#o=null;#l=null;#h=null;#c=!1;#f=!1;static _type="stamp";static _editorType=l.AnnotationEditorType.STAMP;constructor(e){super({...e,name:"stampEditor"}),this.#i=e.bitmapUrl,this.#n=e.bitmapFile}static initialize(e){D.AnnotationEditor.initialize(e)}static get supportedTypes(){const e=["apng","avif","bmp","gif","jpeg","png","svg+xml","webp","x-icon"];return(0,l.shadow)(this,"supportedTypes",e.map(r=>`image/${r}`))}static get supportedTypesStr(){return(0,l.shadow)(this,"supportedTypesStr",this.supportedTypes.join(","))}static isHandlingMimeForPasting(e){return this.supportedTypes.includes(e)}static paste(e,r){r.pasteEditor(l.AnnotationEditorType.STAMP,{bitmapFile:e.getAsFile()})}#u(e,r=!1){if(!e){this.remove();return}this.#t=e.bitmap,r||(this.#e=e.id,this.#c=e.isSvg),e.file&&(this.#r=e.file.name),this.#p()}#d(){this.#s=null,this._uiManager.enableWaiting(!1),this.#o&&this.div.focus()}#a(){if(this.#e){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(this.#e).then(r=>this.#u(r,!0)).finally(()=>this.#d());return}if(this.#i){const r=this.#i;this.#i=null,this._uiManager.enableWaiting(!0),this.#s=this._uiManager.imageManager.getFromUrl(r).then(u=>this.#u(u)).finally(()=>this.#d());return}if(this.#n){const r=this.#n;this.#n=null,this._uiManager.enableWaiting(!0),this.#s=this._uiManager.imageManager.getFromFile(r).then(u=>this.#u(u)).finally(()=>this.#d());return}const e=document.createElement("input");e.type="file",e.accept=p.supportedTypesStr,this.#s=new Promise(r=>{e.addEventListener("change",async()=>{if(!e.files||e.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);const u=await this._uiManager.imageManager.getFromFile(e.files[0]);this.#u(u)}r()}),e.addEventListener("cancel",()=>{this.remove(),r()})}).finally(()=>this.#d()),e.click()}remove(){this.#e&&(this.#t=null,this._uiManager.imageManager.deleteId(this.#e),this.#o?.remove(),this.#o=null,this.#l?.disconnect(),this.#l=null,this.#h&&(clearTimeout(this.#h),this.#h=null)),super.remove()}rebuild(){if(!this.parent){this.#e&&this.#a();return}super.rebuild(),this.div!==null&&(this.#e&&this.#a(),this.isAttachedToDOM||this.parent.add(this))}onceAdded(){this._isDraggable=!0,this.div.focus()}isEmpty(){return!(this.#s||this.#t||this.#i||this.#n)}get isResizable(){return!0}render(){if(this.div)return this.div;let e,r;if(this.width&&(e=this.x,r=this.y),super.render(),this.div.hidden=!0,this.#t?this.#p():this.#a(),this.width){const[u,w]=this.parentDimensions;this.setAt(e*u,r*w,this.width*u,this.height*w)}return this.div}#p(){const{div:e}=this;let{width:r,height:u}=this.#t;const[w,A]=this.pageDimensions,I=.75;if(this.width)r=this.width*w,u=this.height*A;else if(r>I*w||u>I*A){const G=Math.min(I*w/r,I*A/u);r*=G,u*=G}const[k,M]=this.parentDimensions;this.setDims(r*k/w,u*M/A),this._uiManager.enableWaiting(!1);const z=this.#o=document.createElement("canvas");e.append(z),e.hidden=!1,this.#A(r,u),this.#v(),this.#f||(this.parent.addUndoableEditor(this),this.#f=!0),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",subtype:this.editorType,data:{action:"inserted_image"}}}),this.addAltTextButton(),this.#r&&z.setAttribute("aria-label",this.#r)}#m(e,r){const[u,w]=this.parentDimensions;this.width=e/u,this.height=r/w,this.setDims(e,r),this._initialOptions?.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,this.#h!==null&&clearTimeout(this.#h);const A=200;this.#h=setTimeout(()=>{this.#h=null,this.#A(e,r)},A)}#b(e,r){const{width:u,height:w}=this.#t;let A=u,I=w,k=this.#t;for(;A>2*e||I>2*r;){const M=A,z=I;A>2*e&&(A=A>=16384?Math.floor(A/2)-1:Math.ceil(A/2)),I>2*r&&(I=I>=16384?Math.floor(I/2)-1:Math.ceil(I/2));const G=new OffscreenCanvas(A,I);G.getContext("2d").drawImage(k,0,0,M,z,0,0,A,I),k=G.transferToImageBitmap()}return k}#A(e,r){e=Math.ceil(e),r=Math.ceil(r);const u=this.#o;if(!u||u.width===e&&u.height===r)return;u.width=e,u.height=r;const w=this.#c?this.#t:this.#b(e,r),A=u.getContext("2d");A.filter=this._uiManager.hcmFilter,A.drawImage(w,0,0,w.width,w.height,0,0,e,r)}getImageForAltText(){return this.#o}#y(e){if(e){if(this.#c){const w=this._uiManager.imageManager.getSvgUrl(this.#e);if(w)return w}const r=document.createElement("canvas");return{width:r.width,height:r.height}=this.#t,r.getContext("2d").drawImage(this.#t,0,0),r.toDataURL()}if(this.#c){const[r,u]=this.pageDimensions,w=Math.round(this.width*r*o.PixelsPerInch.PDF_TO_CSS_UNITS),A=Math.round(this.height*u*o.PixelsPerInch.PDF_TO_CSS_UNITS),I=new OffscreenCanvas(w,A);return I.getContext("2d").drawImage(this.#t,0,0,this.#t.width,this.#t.height,0,0,w,A),I.transferToImageBitmap()}return structuredClone(this.#t)}#v(){this.#l=new ResizeObserver(e=>{const r=e[0].contentRect;r.width&&r.height&&this.#m(r.width,r.height)}),this.#l.observe(this.div)}static deserialize(e,r,u){if(e instanceof P.StampAnnotationElement)return null;const w=super.deserialize(e,r,u),{rect:A,bitmapUrl:I,bitmapId:k,isSvg:M,accessibilityData:z}=e;k&&u.imageManager.isValidId(k)?w.#e=k:w.#i=I,w.#c=M;const[G,X]=w.pageDimensions;return w.width=(A[2]-A[0])/G,w.height=(A[3]-A[1])/X,z&&(w.altTextData=z),w}serialize(e=!1,r=null){if(this.isEmpty())return null;const u={annotationType:l.AnnotationEditorType.STAMP,bitmapId:this.#e,pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:this.#c,structTreeParentId:this._structTreeParentId};if(e)return u.bitmapUrl=this.#y(!0),u.accessibilityData=this.altTextData,u;const{decorative:w,altText:A}=this.altTextData;if(!w&&A&&(u.accessibilityData={type:"Figure",alt:A}),r===null)return u;r.stamps||=new Map;const I=this.#c?(u.rect[2]-u.rect[0])*(u.rect[3]-u.rect[1]):null;if(!r.stamps.has(this.#e))r.stamps.set(this.#e,{area:I,serialized:u}),u.bitmap=this.#y(!1);else if(this.#c){const k=r.stamps.get(this.#e);I>k.area&&(k.area=I,k.serialized.bitmap.close(),k.serialized.bitmap=this.#y(!1))}return u}}class n{#t;#e=!1;#s=null;#i=this.pointerup.bind(this);#n=this.pointerUpAfterSelection.bind(this);#r=this.pointerdown.bind(this);#o=null;#l=this.selectionStart.bind(this);#h=new Map;#c=!1;#f=!1;#u=!1;#d=null;#a;static _initialized=!1;static#p=new Map([E,c,p,g].map(e=>[e._editorType,e]));constructor({uiManager:e,pageIndex:r,div:u,accessibilityManager:w,annotationLayer:A,drawLayer:I,textLayer:k,viewport:M,l10n:z}){const G=[...n.#p.values()];if(!n._initialized){n._initialized=!0;for(const X of G)X.initialize(z)}e.registerEditorTypes(G),this.#a=e,this.pageIndex=r,this.div=u,this.#t=w,this.#s=A,this.viewport=M,this.#d=k,this.drawLayer=I,this.#a.addLayer(this)}get isEmpty(){return this.#h.size===0}updateToolbar(e){this.#a.updateToolbar(e)}updateMode(e=this.#a.getMode()){switch(this.#v(),e){case l.AnnotationEditorType.NONE:this.disableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;case l.AnnotationEditorType.INK:this.addInkEditorIfNeeded(!1),this.disableTextSelection(),this.togglePointerEvents(!0),this.disableClick();break;case l.AnnotationEditorType.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}if(e!==l.AnnotationEditorType.NONE){const{classList:r}=this.div;for(const u of n.#p.values())r.toggle(`${u._type}Editing`,e===u._editorType);this.div.hidden=!1}}addInkEditorIfNeeded(e){if(this.#a.getMode()!==l.AnnotationEditorType.INK)return;if(!e){for(const u of this.#h.values())if(u.isEmpty()){u.setInBackground();return}}this.#A({offsetX:0,offsetY:0},!1).setInBackground()}setEditingState(e){this.#a.setEditingState(e)}addCommands(e){this.#a.addCommands(e)}togglePointerEvents(e=!1){this.div.classList.toggle("disabled",!e)}enable(){this.togglePointerEvents(!0);const e=new Set;for(const u of this.#h.values())u.enableEditing(),u.annotationElementId&&e.add(u.annotationElementId);if(!this.#s)return;const r=this.#s.getEditableAnnotations();for(const u of r){if(u.hide(),this.#a.isDeletedAnnotationElement(u.data.id)||e.has(u.data.id))continue;const w=this.deserialize(u);w&&(this.addOrRebuild(w),w.enableEditing())}}disable(){this.#u=!0,this.togglePointerEvents(!1);const e=new Set;for(const u of this.#h.values()){if(u.disableEditing(),!u.annotationElementId||u.serialize()!==null){e.add(u.annotationElementId);continue}this.getEditableAnnotation(u.annotationElementId)?.show(),u.remove()}if(this.#s){const u=this.#s.getEditableAnnotations();for(const w of u){const{id:A}=w.data;e.has(A)||this.#a.isDeletedAnnotationElement(A)||w.show()}}this.#v(),this.isEmpty&&(this.div.hidden=!0);const{classList:r}=this.div;for(const u of n.#p.values())r.remove(`${u._type}Editing`);this.disableTextSelection(),this.#u=!1}getEditableAnnotation(e){return this.#s?.getEditableAnnotation(e)||null}setActiveEditor(e){this.#a.getActive()!==e&&this.#a.setActiveEditor(e)}enableTextSelection(){this.#d?.div&&document.addEventListener("selectstart",this.#l)}disableTextSelection(){this.#d?.div&&document.removeEventListener("selectstart",this.#l)}enableClick(){this.div.addEventListener("pointerdown",this.#r),this.div.addEventListener("pointerup",this.#i)}disableClick(){this.div.removeEventListener("pointerdown",this.#r),this.div.removeEventListener("pointerup",this.#i)}attach(e){this.#h.set(e.id,e);const{annotationElementId:r}=e;r&&this.#a.isDeletedAnnotationElement(r)&&this.#a.removeDeletedAnnotationElement(e)}detach(e){this.#h.delete(e.id),this.#t?.removePointerInTextLayer(e.contentDiv),!this.#u&&e.annotationElementId&&this.#a.addDeletedAnnotationElement(e)}remove(e){this.detach(e),this.#a.removeEditor(e),e.div.remove(),e.isAttachedToDOM=!1,this.#f||this.addInkEditorIfNeeded(!1)}changeParent(e){e.parent!==this&&(e.annotationElementId&&(this.#a.addDeletedAnnotationElement(e.annotationElementId),D.AnnotationEditor.deleteAnnotationElement(e),e.annotationElementId=null),this.attach(e),e.parent?.detach(e),e.setParent(this),e.div&&e.isAttachedToDOM&&(e.div.remove(),this.div.append(e.div)))}add(e){if(this.changeParent(e),this.#a.addEditor(e),this.attach(e),!e.isAttachedToDOM){const r=e.render();this.div.append(r),e.isAttachedToDOM=!0}e.fixAndSetPosition(),e.onceAdded(),this.#a.addToAnnotationStorage(e)}moveEditorInDOM(e){if(!e.isAttachedToDOM)return;const{activeElement:r}=document;e.div.contains(r)&&!this.#o&&(e._focusEventsAllowed=!1,this.#o=setTimeout(()=>{this.#o=null,e.div.contains(document.activeElement)?e._focusEventsAllowed=!0:(e.div.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0}),r.focus())},0)),e._structTreeParentId=this.#t?.moveElementInDOM(this.div,e.div,e.contentDiv,!0)}addOrRebuild(e){e.needsToBeRebuilt()?(e.parent||=this,e.rebuild()):this.add(e)}addUndoableEditor(e){const r=()=>e._uiManager.rebuild(e),u=()=>{e.remove()};this.addCommands({cmd:r,undo:u,mustExec:!1})}getNextId(){return this.#a.getId()}get#m(){return n.#p.get(this.#a.getMode())}#b(e){const r=this.#m;return r?new r.prototype.constructor(e):null}canCreateNewEmptyEditor(){return this.#m?.canCreateNewEmptyEditor()}pasteEditor(e,r){this.#a.updateToolbar(e),this.#a.updateMode(e);const{offsetX:u,offsetY:w}=this.#y(),A=this.getNextId(),I=this.#b({parent:this,id:A,x:u,y:w,uiManager:this.#a,isCentered:!0,...r});I&&this.add(I)}deserialize(e){return n.#p.get(e.annotationType??e.annotationEditorType)?.deserialize(e,this,this.#a)||null}#A(e,r,u={}){const w=this.getNextId(),A=this.#b({parent:this,id:w,x:e.offsetX,y:e.offsetY,uiManager:this.#a,isCentered:r,...u});return A&&this.add(A),A}#y(){const{x:e,y:r,width:u,height:w}=this.div.getBoundingClientRect(),A=Math.max(0,e),I=Math.max(0,r),k=Math.min(window.innerWidth,e+u),M=Math.min(window.innerHeight,r+w),z=(A+k)/2-e,G=(I+M)/2-r,[X,q]=this.viewport.rotation%180===0?[z,G]:[G,z];return{offsetX:X,offsetY:q}}addNewEditor(){this.#A(this.#y(),!0)}setSelected(e){this.#a.setSelected(e)}toggleSelected(e){this.#a.toggleSelected(e)}isSelected(e){return this.#a.isSelected(e)}unselect(e){this.#a.unselect(e)}selectionStart(e){this.#d?.div.addEventListener("pointerup",this.#n,{once:!0})}pointerUpAfterSelection(e){const r=document.getSelection();if(r.rangeCount===0)return;const u=r.getRangeAt(0);if(u.collapsed||!this.#d?.div.contains(u.commonAncestorContainer))return;const{x:w,y:A,width:I,height:k}=this.#d.div.getBoundingClientRect(),M=u.getClientRects();let z;switch(this.viewport.rotation){case 90:z=(X,q,et,at)=>({x:(q-A)/k,y:1-(X+et-w)/I,width:at/k,height:et/I});break;case 180:z=(X,q,et,at)=>({x:1-(X+et-w)/I,y:1-(q+at-A)/k,width:et/I,height:at/k});break;case 270:z=(X,q,et,at)=>({x:1-(q+at-A)/k,y:(X-w)/I,width:at/k,height:et/I});break;default:z=(X,q,et,at)=>({x:(X-w)/I,y:(q-A)/k,width:et/I,height:at/k});break}const G=[];for(const{x:X,y:q,width:et,height:at}of M)et===0||at===0||G.push(z(X,q,et,at));G.length!==0&&this.#A(e,!1,{boxes:G}),r.empty()}pointerup(e){const{isMac:r}=l.FeatureTest.platform;if(!(e.button!==0||e.ctrlKey&&r)&&e.target===this.div&&this.#c){if(this.#c=!1,!this.#e){this.#e=!0;return}if(this.#a.getMode()===l.AnnotationEditorType.STAMP){this.#a.unselectAll();return}this.#A(e,!1)}}pointerdown(e){if(this.#a.getMode()===l.AnnotationEditorType.HIGHLIGHT&&this.enableTextSelection(),this.#c){this.#c=!1;return}const{isMac:r}=l.FeatureTest.platform;if(e.button!==0||e.ctrlKey&&r||e.target!==this.div)return;this.#c=!0;const u=this.#a.getActive();this.#e=!u||u.isEmpty()}findNewParent(e,r,u){const w=this.#a.findParent(r,u);return w===null||w===this?!1:(w.changeParent(e),!0)}destroy(){this.#a.getActive()?.parent===this&&(this.#a.commitOrRemove(),this.#a.setActiveEditor(null)),this.#o&&(clearTimeout(this.#o),this.#o=null);for(const e of this.#h.values())this.#t?.removePointerInTextLayer(e.contentDiv),e.setParent(null),e.isAttachedToDOM=!1,e.div.remove();this.div=null,this.#h.clear(),this.#a.removeLayer(this)}#v(){this.#f=!0;for(const e of this.#h.values())e.isEmpty()&&e.remove();this.#f=!1}render({viewport:e}){this.viewport=e,(0,o.setLayerDimensions)(this.div,e);for(const r of this.#a.getEditors(this.pageIndex))this.add(r);this.updateMode()}update({viewport:e}){this.#a.commitOrRemove();const r=this.viewport.rotation,u=e.rotation;if(this.viewport=e,(0,o.setLayerDimensions)(this.div,{rotation:u}),r!==u)for(const w of this.#h.values())w.rotate(u);this.updateMode()}get pageDimensions(){const{pageWidth:e,pageHeight:r}=this.viewport.rawDims;return[e,r]}}},97:(L,C,x)=>{x.d(C,{ColorPicker:()=>P});var l=x(266),D=x(812),y=x(473);class P{#t=this.#u.bind(this);#e=null;#s=null;#i;#n=null;#r=!1;#o=!1;#l;#h=null;static get _keyboardManager(){return(0,l.shadow)(this,"_keyboardManager",new D.KeyboardManager([[["Escape","mac+Escape"],P.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],P.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],P.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],P.prototype._moveToPrevious],[["Home","mac+Home"],P.prototype._moveToBeginning],[["End","mac+End"],P.prototype._moveToEnd]]))}constructor({editor:T=null,uiManager:v=null}){this.#o=!T,this.#h=T?._uiManager||v,this.#l=this.#h._eventBus,this.#i=T?.color||this.#h?.highlightColors.values().next().value||"#FFFF98"}renderButton(){const T=this.#e=document.createElement("button");T.className="colorPicker",T.tabIndex="0",T.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),T.setAttribute("aria-haspopup",!0),T.addEventListener("click",this.#d.bind(this));const v=this.#s=document.createElement("span");return v.className="swatch",v.style.backgroundColor=this.#i,T.append(v),T}renderMainDropdown(){const T=this.#n=this.#c(l.AnnotationEditorParamsType.HIGHLIGHT_DEFAULT_COLOR);return T.setAttribute("aria-orientation","horizontal"),T.setAttribute("aria-labelledby","highlightColorPickerLabel"),T}#c(T){const v=document.createElement("div");v.addEventListener("contextmenu",y.noContextMenu),v.className="dropdown",v.role="listbox",v.setAttribute("aria-multiselectable",!1),v.setAttribute("aria-orientation","vertical"),v.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown");for(const[g,o]of this.#h.highlightColors){const c=document.createElement("button");c.tabIndex="0",c.role="option",c.setAttribute("data-color",o),c.title=g,c.setAttribute("data-l10n-id",`pdfjs-editor-colorpicker-${g}`);const p=document.createElement("span");c.append(p),p.className="swatch",p.style.backgroundColor=o,c.setAttribute("aria-selected",o===this.#i),c.addEventListener("click",this.#f.bind(this,T,o)),v.append(c)}return v.addEventListener("keydown",this.#t),v}#f(T,v,g){g.stopPropagation(),this.#l.dispatch("switchannotationeditorparams",{source:this,type:T,value:v})}_colorSelectFromKeyboard(T){const v=T.target.getAttribute("data-color");v&&this.#f(v,T)}_moveToNext(T){if(T.target===this.#e){this.#n.firstChild?.focus();return}T.target.nextSibling?.focus()}_moveToPrevious(T){T.target.previousSibling?.focus()}_moveToBeginning(){this.#n.firstChild?.focus()}_moveToEnd(){this.#n.lastChild?.focus()}#u(T){P._keyboardManager.exec(this,T)}#d(T){if(this.#n&&!this.#n.classList.contains("hidden")){this.hideDropdown();return}if(this.#e.addEventListener("keydown",this.#t),this.#r=T.detail===0,this.#n){this.#n.classList.remove("hidden");return}const v=this.#n=this.#c(l.AnnotationEditorParamsType.HIGHLIGHT_COLOR);this.#e.append(v)}hideDropdown(){this.#n?.classList.add("hidden")}_hideDropdownFromKeyboard(){this.#o||!this.#n||this.#n.classList.contains("hidden")||(this.hideDropdown(),this.#e.removeEventListener("keydown",this.#t),this.#e.focus({preventScroll:!0,focusVisible:this.#r}))}updateColor(T){if(this.#s&&(this.#s.style.backgroundColor=T),!this.#n)return;const v=this.#h.highlightColors.values();for(const g of this.#n.children)g.setAttribute("aria-selected",v.next().value===T)}destroy(){this.#e?.remove(),this.#e=null,this.#s=null,this.#n?.remove(),this.#n=null}}},115:(L,C,x)=>{x.d(C,{AnnotationEditor:()=>T});var l=x(812),D=x(266),y=x(473);class P{#t="";#e=!1;#s=null;#i=null;#n=null;#r=!1;#o=null;static _l10nPromise=null;constructor(o){this.#o=o}static initialize(o){P._l10nPromise||=o}async render(){const o=this.#s=document.createElement("button");o.className="altText";const c=await P._l10nPromise.get("pdfjs-editor-alt-text-button-label");o.textContent=c,o.setAttribute("aria-label",c),o.tabIndex="0",o.addEventListener("contextmenu",y.noContextMenu),o.addEventListener("pointerdown",n=>n.stopPropagation());const p=n=>{n.preventDefault(),this.#o._uiManager.editAltText(this.#o)};return o.addEventListener("click",p,{capture:!0}),o.addEventListener("keydown",n=>{n.target===o&&n.key==="Enter"&&(this.#r=!0,p(n))}),await this.#l(),o}finish(){this.#s&&(this.#s.focus({focusVisible:this.#r}),this.#r=!1)}get data(){return{altText:this.#t,decorative:this.#e}}set data({altText:o,decorative:c}){this.#t===o&&this.#e===c||(this.#t=o,this.#e=c,this.#l())}toggle(o=!1){this.#s&&(!o&&this.#n&&(clearTimeout(this.#n),this.#n=null),this.#s.disabled=!o)}destroy(){this.#s?.remove(),this.#s=null,this.#i=null}async#l(){const o=this.#s;if(!o)return;if(!this.#t&&!this.#e){o.classList.remove("done"),this.#i?.remove();return}o.classList.add("done"),P._l10nPromise.get("pdfjs-editor-alt-text-edit-button-label").then(n=>{o.setAttribute("aria-label",n)});let c=this.#i;if(!c){this.#i=c=document.createElement("span"),c.className="tooltip",c.setAttribute("role","tooltip");const n=c.id=`alt-text-tooltip-${this.#o.id}`;o.setAttribute("aria-describedby",n);const m=100;o.addEventListener("mouseenter",()=>{this.#n=setTimeout(()=>{this.#n=null,this.#i.classList.add("show"),this.#o._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",subtype:this.#o.editorType,data:{action:"alt_text_tooltip"}}})},m)}),o.addEventListener("mouseleave",()=>{this.#n&&(clearTimeout(this.#n),this.#n=null),this.#i?.classList.remove("show")})}c.innerText=this.#e?await P._l10nPromise.get("pdfjs-editor-alt-text-decorative-tooltip"):this.#t,c.parentNode||o.append(c),this.#o.getImageForAltText()?.setAttribute("aria-describedby",c.id)}}class E{#t=null;#e=null;#s;#i=null;constructor(o){this.#s=o}render(){const o=this.#t=document.createElement("div");o.className="editToolbar",o.addEventListener("contextmenu",y.noContextMenu),o.addEventListener("pointerdown",E.#n);const c=this.#i=document.createElement("div");c.className="buttons",o.append(c);const p=this.#s.toolbarPosition;if(p){const{style:n}=o,m=this.#s._uiManager.direction==="ltr"?1-p[0]:p[0];n.insetInlineEnd=`${100*m}%`,n.top=`calc(${100*p[1]}% + var(--editor-toolbar-vert-offset))`}return this.#h(),o}static#n(o){o.stopPropagation()}#r(o){this.#s._focusEventsAllowed=!1,o.preventDefault(),o.stopPropagation()}#o(o){this.#s._focusEventsAllowed=!0,o.preventDefault(),o.stopPropagation()}#l(o){o.addEventListener("focusin",this.#r.bind(this),{capture:!0}),o.addEventListener("focusout",this.#o.bind(this),{capture:!0}),o.addEventListener("contextmenu",y.noContextMenu)}hide(){this.#t.classList.add("hidden"),this.#e?.hideDropdown()}show(){this.#t.classList.remove("hidden")}#h(){const o=document.createElement("button");o.className="delete",o.tabIndex=0,o.setAttribute("data-l10n-id",`pdfjs-editor-remove-${this.#s.editorType}-button`),this.#l(o),o.addEventListener("click",c=>{this.#s._uiManager.delete()}),this.#i.append(o)}get#c(){const o=document.createElement("div");return o.className="divider",o}addAltTextButton(o){this.#l(o),this.#i.prepend(o,this.#c)}addColorPicker(o){this.#e=o;const c=o.renderButton();this.#l(c),this.#i.prepend(c,this.#c)}remove(){this.#t.remove(),this.#e?.destroy(),this.#e=null}}class T{#t=null;#e=null;#s=!1;#i=null;#n=null;#r=this.focusin.bind(this);#o=this.focusout.bind(this);#l=null;#h="";#c=!1;#f=!1;#u=!1;#d=!1;#a=null;_initialOptions=Object.create(null);_uiManager=null;_focusEventsAllowed=!0;_l10nPromise=null;#p=!1;#m=T._zIndex++;static _borderLineWidth=-1;static _colorManager=new l.ColorManager;static _zIndex=1;static get _resizerKeyboardManager(){const o=T.prototype._resizeWithKeyboard,c=l.AnnotationEditorUIManager.TRANSLATE_SMALL,p=l.AnnotationEditorUIManager.TRANSLATE_BIG;return(0,D.shadow)(this,"_resizerKeyboardManager",new l.KeyboardManager([[["ArrowLeft","mac+ArrowLeft"],o,{args:[-c,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],o,{args:[-p,0]}],[["ArrowRight","mac+ArrowRight"],o,{args:[c,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],o,{args:[p,0]}],[["ArrowUp","mac+ArrowUp"],o,{args:[0,-c]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],o,{args:[0,-p]}],[["ArrowDown","mac+ArrowDown"],o,{args:[0,c]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],o,{args:[0,p]}],[["Escape","mac+Escape"],T.prototype._stopResizingWithKeyboard]]))}constructor(o){this.constructor===T&&(0,D.unreachable)("Cannot initialize AnnotationEditor."),this.parent=o.parent,this.id=o.id,this.width=this.height=null,this.pageIndex=o.parent.pageIndex,this.name=o.name,this.div=null,this._uiManager=o.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=o.isCentered,this._structTreeParentId=null;const{rotation:c,rawDims:{pageWidth:p,pageHeight:n,pageX:m,pageY:e}}=this.parent.viewport;this.rotation=c,this.pageRotation=(360+c-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[p,n],this.pageTranslation=[m,e];const[r,u]=this.parentDimensions;this.x=o.x/r,this.y=o.y/u,this.isAttachedToDOM=!1,this.deleted=!1}get editorType(){return Object.getPrototypeOf(this).constructor._type}static get _defaultLineColor(){return(0,D.shadow)(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(o){const c=new v({id:o.parent.getNextId(),parent:o.parent,uiManager:o._uiManager});c.annotationElementId=o.annotationElementId,c.deleted=!0,c._uiManager.addToAnnotationStorage(c)}static initialize(o,c=null){if(T._l10nPromise||=new Map(["pdfjs-editor-alt-text-button-label","pdfjs-editor-alt-text-edit-button-label","pdfjs-editor-alt-text-decorative-tooltip","pdfjs-editor-resizer-label-topLeft","pdfjs-editor-resizer-label-topMiddle","pdfjs-editor-resizer-label-topRight","pdfjs-editor-resizer-label-middleRight","pdfjs-editor-resizer-label-bottomRight","pdfjs-editor-resizer-label-bottomMiddle","pdfjs-editor-resizer-label-bottomLeft","pdfjs-editor-resizer-label-middleLeft"].map(n=>[n,o.get(n.replaceAll(/([A-Z])/g,m=>`-${m.toLowerCase()}`))])),c?.strings)for(const n of c.strings)T._l10nPromise.set(n,o.get(n));if(T._borderLineWidth!==-1)return;const p=getComputedStyle(document.documentElement);T._borderLineWidth=parseFloat(p.getPropertyValue("--outline-width"))||0}static updateDefaultParams(o,c){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(o){return!1}static paste(o,c){(0,D.unreachable)("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return this.#p}set _isDraggable(o){this.#p=o,this.div?.classList.toggle("draggable",o)}get isEnterHandled(){return!0}center(){const[o,c]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*c/(o*2),this.y+=this.width*o/(c*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*c/(o*2),this.y-=this.width*o/(c*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(o){this._uiManager.addCommands(o)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=this.#m}setParent(o){o!==null?(this.pageIndex=o.pageIndex,this.pageDimensions=o.pageDimensions):this.#S(),this.parent=o}focusin(o){this._focusEventsAllowed&&(this.#c?this.#c=!1:this.parent.setSelected(this))}focusout(o){!this._focusEventsAllowed||!this.isAttachedToDOM||o.relatedTarget?.closest(`#${this.id}`)||(o.preventDefault(),this.parent?.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(o,c,p,n){const[m,e]=this.parentDimensions;[p,n]=this.screenToPageTranslation(p,n),this.x=(o+p)/m,this.y=(c+n)/e,this.fixAndSetPosition()}#b([o,c],p,n){[p,n]=this.screenToPageTranslation(p,n),this.x+=p/o,this.y+=n/c,this.fixAndSetPosition()}translate(o,c){this.#b(this.parentDimensions,o,c)}translateInPage(o,c){this.#b(this.pageDimensions,o,c),this.div.scrollIntoView({block:"nearest"})}drag(o,c){const[p,n]=this.parentDimensions;if(this.x+=o/p,this.y+=c/n,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:w,y:A}=this.div.getBoundingClientRect();this.parent.findNewParent(this,w,A)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:m,y:e}=this;const[r,u]=this.#A();m+=r,e+=u,this.div.style.left=`${(100*m).toFixed(2)}%`,this.div.style.top=`${(100*e).toFixed(2)}%`,this.div.scrollIntoView({block:"nearest"})}#A(){const[o,c]=this.parentDimensions,{_borderLineWidth:p}=T,n=p/o,m=p/c;switch(this.rotation){case 90:return[-n,m];case 180:return[n,m];case 270:return[n,-m];default:return[-n,-m]}}fixAndSetPosition(o=this.rotation){const[c,p]=this.pageDimensions;let{x:n,y:m,width:e,height:r}=this;switch(e*=c,r*=p,n*=c,m*=p,o){case 0:n=Math.max(0,Math.min(c-e,n)),m=Math.max(0,Math.min(p-r,m));break;case 90:n=Math.max(0,Math.min(c-r,n)),m=Math.min(p,Math.max(e,m));break;case 180:n=Math.min(c,Math.max(e,n)),m=Math.min(p,Math.max(r,m));break;case 270:n=Math.min(c,Math.max(r,n)),m=Math.max(0,Math.min(p-e,m));break}this.x=n/=c,this.y=m/=p;const[u,w]=this.#A();n+=u,m+=w;const{style:A}=this.div;A.left=`${(100*n).toFixed(2)}%`,A.top=`${(100*m).toFixed(2)}%`,this.moveInDOM()}static#y(o,c,p){switch(p){case 90:return[c,-o];case 180:return[-o,-c];case 270:return[-c,o];default:return[o,c]}}screenToPageTranslation(o,c){return T.#y(o,c,this.parentRotation)}pageTranslationToScreen(o,c){return T.#y(o,c,360-this.parentRotation)}#v(o){switch(o){case 90:{const[c,p]=this.pageDimensions;return[0,-c/p,p/c,0]}case 180:return[-1,0,0,-1];case 270:{const[c,p]=this.pageDimensions;return[0,c/p,-p/c,0]}default:return[1,0,0,1]}}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:o,pageDimensions:[c,p]}=this,n=c*o,m=p*o;return D.FeatureTest.isCSSRoundSupported?[Math.round(n),Math.round(m)]:[n,m]}setDims(o,c){const[p,n]=this.parentDimensions;this.div.style.width=`${(100*o/p).toFixed(2)}%`,this.#s||(this.div.style.height=`${(100*c/n).toFixed(2)}%`)}fixDims(){const{style:o}=this.div,{height:c,width:p}=o,n=p.endsWith("%"),m=!this.#s&&c.endsWith("%");if(n&&m)return;const[e,r]=this.parentDimensions;n||(o.width=`${(100*parseFloat(p)/e).toFixed(2)}%`),!this.#s&&!m&&(o.height=`${(100*parseFloat(c)/r).toFixed(2)}%`)}getInitialTranslation(){return[0,0]}#g(){if(this.#i)return;this.#i=document.createElement("div"),this.#i.classList.add("resizers");const o=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"];for(const c of o){const p=document.createElement("div");this.#i.append(p),p.classList.add("resizer",c),p.setAttribute("data-resizer-name",c),p.addEventListener("pointerdown",this.#C.bind(this,c)),p.addEventListener("contextmenu",y.noContextMenu),p.tabIndex=-1}this.div.prepend(this.#i)}#C(o,c){c.preventDefault();const{isMac:p}=D.FeatureTest.platform;if(c.button!==0||c.ctrlKey&&p)return;this.#e?.toggle(!1);const n=this.#M.bind(this,o),m=this._isDraggable;this._isDraggable=!1;const e={passive:!0,capture:!0};this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",n,e);const r=this.x,u=this.y,w=this.width,A=this.height,I=this.parent.div.style.cursor,k=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(c.target).cursor;const M=()=>{this.parent.togglePointerEvents(!0),this.#e?.toggle(!0),this._isDraggable=m,window.removeEventListener("pointerup",M),window.removeEventListener("blur",M),window.removeEventListener("pointermove",n,e),this.parent.div.style.cursor=I,this.div.style.cursor=k,this.#L(r,u,w,A)};window.addEventListener("pointerup",M),window.addEventListener("blur",M)}#L(o,c,p,n){const m=this.x,e=this.y,r=this.width,u=this.height;m===o&&e===c&&r===p&&u===n||this.addCommands({cmd:()=>{this.width=r,this.height=u,this.x=m,this.y=e;const[w,A]=this.parentDimensions;this.setDims(w*r,A*u),this.fixAndSetPosition()},undo:()=>{this.width=p,this.height=n,this.x=o,this.y=c;const[w,A]=this.parentDimensions;this.setDims(w*p,A*n),this.fixAndSetPosition()},mustExec:!0})}#M(o,c){const[p,n]=this.parentDimensions,m=this.x,e=this.y,r=this.width,u=this.height,w=T.MIN_SIZE/p,A=T.MIN_SIZE/n,I=f=>Math.round(f*1e4)/1e4,k=this.#v(this.rotation),M=(f,h)=>[k[0]*f+k[2]*h,k[1]*f+k[3]*h],z=this.#v(360-this.rotation),G=(f,h)=>[z[0]*f+z[2]*h,z[1]*f+z[3]*h];let X,q,et=!1,at=!1;switch(o){case"topLeft":et=!0,X=(f,h)=>[0,0],q=(f,h)=>[f,h];break;case"topMiddle":X=(f,h)=>[f/2,0],q=(f,h)=>[f/2,h];break;case"topRight":et=!0,X=(f,h)=>[f,0],q=(f,h)=>[0,h];break;case"middleRight":at=!0,X=(f,h)=>[f,h/2],q=(f,h)=>[0,h/2];break;case"bottomRight":et=!0,X=(f,h)=>[f,h],q=(f,h)=>[0,0];break;case"bottomMiddle":X=(f,h)=>[f/2,h],q=(f,h)=>[f/2,0];break;case"bottomLeft":et=!0,X=(f,h)=>[0,h],q=(f,h)=>[f,0];break;case"middleLeft":at=!0,X=(f,h)=>[0,h/2],q=(f,h)=>[f,h/2];break}const W=X(r,u),$=q(r,u);let U=M(...$);const J=I(m+U[0]),Z=I(e+U[1]);let tt=1,ft=1,[lt,ot]=this.screenToPageTranslation(c.movementX,c.movementY);if([lt,ot]=G(lt/p,ot/n),et){const f=Math.hypot(r,u);tt=ft=Math.max(Math.min(Math.hypot($[0]-W[0]-lt,$[1]-W[1]-ot)/f,1/r,1/u),w/r,A/u)}else at?tt=Math.max(w,Math.min(1,Math.abs($[0]-W[0]-lt)))/r:ft=Math.max(A,Math.min(1,Math.abs($[1]-W[1]-ot)))/u;const gt=I(r*tt),dt=I(u*ft);U=M(...q(gt,dt));const ct=J-U[0],K=Z-U[1];this.width=gt,this.height=dt,this.x=ct,this.y=K,this.setDims(p*gt,n*dt),this.fixAndSetPosition()}altTextFinish(){this.#e?.finish()}async addEditToolbar(){return this.#l||this.#u?this.#l:(this.#l=new E(this),this.div.append(this.#l.render()),this.#e&&this.#l.addAltTextButton(await this.#e.render()),this.#l)}removeEditToolbar(){this.#l&&(this.#l.remove(),this.#l=null,this.#e?.destroy())}getClientDimensions(){return this.div.getBoundingClientRect()}async addAltTextButton(){this.#e||(P.initialize(T._l10nPromise),this.#e=new P(this),await this.addEditToolbar())}get altTextData(){return this.#e?.data}set altTextData(o){this.#e&&(this.#e.data=o)}render(){this.div=document.createElement("div"),this.div.setAttribute("data-editor-rotation",(360-this.rotation)%360),this.div.className=this.name,this.div.setAttribute("id",this.id),this.div.setAttribute("tabIndex",0),this.setInForeground(),this.div.addEventListener("focusin",this.#r),this.div.addEventListener("focusout",this.#o);const[o,c]=this.parentDimensions;this.parentRotation%180!==0&&(this.div.style.maxWidth=`${(100*c/o).toFixed(2)}%`,this.div.style.maxHeight=`${(100*o/c).toFixed(2)}%`);const[p,n]=this.getInitialTranslation();return this.translate(p,n),(0,l.bindEvents)(this,this.div,["pointerdown"]),this.div}pointerdown(o){const{isMac:c}=D.FeatureTest.platform;if(o.button!==0||o.ctrlKey&&c){o.preventDefault();return}if(this.#c=!0,this._isDraggable){this.#_(o);return}this.#I(o)}#I(o){const{isMac:c}=D.FeatureTest.platform;o.ctrlKey&&!c||o.shiftKey||o.metaKey&&c?this.parent.toggleSelected(this):this.parent.setSelected(this)}#_(o){const c=this._uiManager.isSelected(this);this._uiManager.setUpDragSession();let p,n;c&&(p={passive:!0,capture:!0},n=e=>{const[r,u]=this.screenToPageTranslation(e.movementX,e.movementY);this._uiManager.dragSelectedEditors(r,u)},window.addEventListener("pointermove",n,p));const m=()=>{window.removeEventListener("pointerup",m),window.removeEventListener("blur",m),c&&window.removeEventListener("pointermove",n,p),this.#c=!1,this._uiManager.endDragSession()||this.#I(o)};window.addEventListener("pointerup",m),window.addEventListener("blur",m)}moveInDOM(){this.#a&&clearTimeout(this.#a),this.#a=setTimeout(()=>{this.#a=null,this.parent?.moveEditorInDOM(this)},0)}_setParentAndPosition(o,c,p){o.changeParent(this),this.x=c,this.y=p,this.fixAndSetPosition()}getRect(o,c,p=this.rotation){const n=this.parentScale,[m,e]=this.pageDimensions,[r,u]=this.pageTranslation,w=o/n,A=c/n,I=this.x*m,k=this.y*e,M=this.width*m,z=this.height*e;switch(p){case 0:return[I+w+r,e-k-A-z+u,I+w+M+r,e-k-A+u];case 90:return[I+A+r,e-k+w+u,I+A+z+r,e-k+w+M+u];case 180:return[I-w-M+r,e-k+A+u,I-w+r,e-k+A+z+u];case 270:return[I-A-z+r,e-k-w-M+u,I-A+r,e-k-w+u];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(o,c){const[p,n,m,e]=o,r=m-p,u=e-n;switch(this.rotation){case 0:return[p,c-e,r,u];case 90:return[p,c-n,u,r];case 180:return[m,c-n,r,u];case 270:return[m,c-e,u,r];default:throw new Error("Invalid rotation")}}onceAdded(){}isEmpty(){return!1}enableEditMode(){this.#u=!0}disableEditMode(){this.#u=!1}isInEditMode(){return this.#u}shouldGetKeyboardEvents(){return this.#d}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}rebuild(){this.div?.addEventListener("focusin",this.#r),this.div?.addEventListener("focusout",this.#o)}rotate(o){}serialize(o=!1,c=null){(0,D.unreachable)("An editor must be serializable")}static deserialize(o,c,p){const n=new this.prototype.constructor({parent:c,id:c.getNextId(),uiManager:p});n.rotation=o.rotation;const[m,e]=n.pageDimensions,[r,u,w,A]=n.getRectInCurrentCoords(o.rect,e);return n.x=r/m,n.y=u/e,n.width=w/m,n.height=A/e,n}remove(){this.div.removeEventListener("focusin",this.#r),this.div.removeEventListener("focusout",this.#o),this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),this.#a&&(clearTimeout(this.#a),this.#a=null),this.#S(),this.removeEditToolbar()}get isResizable(){return!1}makeResizable(){this.isResizable&&(this.#g(),this.#i.classList.remove("hidden"),(0,l.bindEvents)(this,this.div,["keydown"]))}get toolbarPosition(){return null}keydown(o){if(!this.isResizable||o.target!==this.div||o.key!=="Enter")return;this._uiManager.setSelected(this),this.#n={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};const c=this.#i.children;if(!this.#t){this.#t=Array.from(c);const e=this.#N.bind(this),r=this.#w.bind(this);for(const u of this.#t){const w=u.getAttribute("data-resizer-name");u.setAttribute("role","spinbutton"),u.addEventListener("keydown",e),u.addEventListener("blur",r),u.addEventListener("focus",this.#D.bind(this,w)),T._l10nPromise.get(`pdfjs-editor-resizer-label-${w}`).then(A=>u.setAttribute("aria-label",A))}}const p=this.#t[0];let n=0;for(const e of c){if(e===p)break;n++}const m=(360-this.rotation+this.parentRotation)%360/90*(this.#t.length/4);if(m!==n){if(m<n)for(let r=0;r<n-m;r++)this.#i.append(this.#i.firstChild);else if(m>n)for(let r=0;r<m-n;r++)this.#i.firstChild.before(this.#i.lastChild);let e=0;for(const r of c){const w=this.#t[e++].getAttribute("data-resizer-name");T._l10nPromise.get(`pdfjs-editor-resizer-label-${w}`).then(A=>r.setAttribute("aria-label",A))}}this.#E(0),this.#d=!0,this.#i.firstChild.focus({focusVisible:!0}),o.preventDefault(),o.stopImmediatePropagation()}#N(o){T._resizerKeyboardManager.exec(this,o)}#w(o){this.#d&&o.relatedTarget?.parentNode!==this.#i&&this.#S()}#D(o){this.#h=this.#d?o:""}#E(o){if(this.#t)for(const c of this.#t)c.tabIndex=o}_resizeWithKeyboard(o,c){this.#d&&this.#M(this.#h,{movementX:o,movementY:c})}#S(){if(this.#d=!1,this.#E(-1),this.#n){const{savedX:o,savedY:c,savedWidth:p,savedHeight:n}=this.#n;this.#L(o,c,p,n),this.#n=null}}_stopResizingWithKeyboard(){this.#S(),this.div.focus()}select(){if(this.makeResizable(),this.div?.classList.add("selectedEditor"),!this.#l){this.addEditToolbar().then(()=>{this.div?.classList.contains("selectedEditor")&&this.#l?.show()});return}this.#l?.show()}unselect(){this.#i?.classList.add("hidden"),this.div?.classList.remove("selectedEditor"),this.div?.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus(),this.#l?.hide()}updateParams(o,c){}disableEditing(){}enableEditing(){}enterInEditMode(){}getImageForAltText(){return null}get contentDiv(){return this.div}get isEditing(){return this.#f}set isEditing(o){this.#f=o,this.parent&&(o?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}setAspectRatio(o,c){this.#s=!0;const p=o/c,{style:n}=this.div;n.aspectRatio=p,n.height="auto"}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}}class v extends T{constructor(o){super(o),this.annotationElementId=o.annotationElementId,this.deleted=!0}serialize(){return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex}}}},405:(L,C,x)=>{x.d(C,{Outliner:()=>l});class l{#t;#e=[];#s=[];constructor(y,P=0,E=0,T=!0){let v=1/0,g=-1/0,o=1/0,c=-1/0;const n=10**-4;for(const{x:I,y:k,width:M,height:z}of y){const G=Math.floor((I-P)/n)*n,X=Math.ceil((I+M+P)/n)*n,q=Math.floor((k-P)/n)*n,et=Math.ceil((k+z+P)/n)*n,at=[G,q,et,!0],W=[X,q,et,!1];this.#e.push(at,W),v=Math.min(v,G),g=Math.max(g,X),o=Math.min(o,q),c=Math.max(c,et)}const m=g-v+2*E,e=c-o+2*E,r=v-E,u=o-E,w=this.#e.at(T?-1:-2),A=[w[0],w[2]];for(const I of this.#e){const[k,M,z]=I;I[0]=(k-r)/m,I[1]=(M-u)/e,I[2]=(z-u)/e}this.#t={x:r,y:u,width:m,height:e,lastPoint:A}}getOutlines(){this.#e.sort((P,E)=>P[0]-E[0]||P[1]-E[1]||P[2]-E[2]);const y=[];for(const P of this.#e)P[3]?(y.push(...this.#l(P)),this.#r(P)):(this.#o(P),y.push(...this.#l(P)));return this.#i(y)}#i(y){const P=[],E=new Set;for(const g of y){const[o,c,p]=g;P.push([o,c,g],[o,p,g])}P.sort((g,o)=>g[1]-o[1]||g[0]-o[0]);for(let g=0,o=P.length;g<o;g+=2){const c=P[g][2],p=P[g+1][2];c.push(p),p.push(c),E.add(c),E.add(p)}const T=[];let v;for(;E.size>0;){const g=E.values().next().value;let[o,c,p,n,m]=g;E.delete(g);let e=o,r=c;for(v=[o,p],T.push(v);;){let u;if(E.has(n))u=n;else if(E.has(m))u=m;else break;E.delete(u),[o,c,p,n,m]=u,e!==o&&(v.push(e,r,o,r===c?c:p),e=o),r=r===c?p:c}v.push(e,r)}return{outlines:T,box:this.#t}}#n(y){const P=this.#s;let E=0,T=P.length-1;for(;E<=T;){const v=E+T>>1,g=P[v][0];if(g===y)return v;g<y?E=v+1:T=v-1}return T+1}#r([,y,P]){const E=this.#n(y);this.#s.splice(E,0,[y,P])}#o([,y,P]){const E=this.#n(y);for(let T=E;T<this.#s.length;T++){const[v,g]=this.#s[T];if(v!==y)break;if(v===y&&g===P){this.#s.splice(T,1);return}}for(let T=E-1;T>=0;T--){const[v,g]=this.#s[T];if(v!==y)break;if(v===y&&g===P){this.#s.splice(T,1);return}}}#l(y){const[P,E,T]=y,v=[[P,E,T]],g=this.#n(T);for(let o=0;o<g;o++){const[c,p]=this.#s[o];for(let n=0,m=v.length;n<m;n++){const[,e,r]=v[n];if(!(p<=e||r<=c)){if(e>=c){if(r>p)v[n][1]=p;else{if(m===1)return[];v.splice(n,1),n--,m--}continue}v[n][2]=c,r>p&&v.push([P,p,r])}}}return v}}},812:(L,C,x)=>{x.d(C,{AnnotationEditorUIManager:()=>c,ColorManager:()=>o,KeyboardManager:()=>g,bindEvents:()=>y,opacityToHex:()=>P});var l=x(266),D=x(473);function y(p,n,m){for(const e of m)n.addEventListener(e,p[e].bind(p))}function P(p){return Math.round(Math.min(255,Math.max(1,255*p))).toString(16).padStart(2,"0")}class E{#t=0;getId(){return`${l.AnnotationEditorPrefix}${this.#t++}`}}class T{#t=(0,l.getUuid)();#e=0;#s=null;static get _isSVGFittingCanvas(){const n='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',e=new OffscreenCanvas(1,3).getContext("2d"),r=new Image;r.src=n;const u=r.decode().then(()=>(e.drawImage(r,0,0,1,1,0,0,1,3),new Uint32Array(e.getImageData(0,0,1,1).data.buffer)[0]===0));return(0,l.shadow)(this,"_isSVGFittingCanvas",u)}async#i(n,m){this.#s||=new Map;let e=this.#s.get(n);if(e===null)return null;if(e?.bitmap)return e.refCounter+=1,e;try{e||={bitmap:null,id:`image_${this.#t}_${this.#e++}`,refCounter:0,isSvg:!1};let r;if(typeof m=="string"?(e.url=m,r=await(0,D.fetchData)(m,"blob")):r=e.file=m,r.type==="image/svg+xml"){const u=T._isSVGFittingCanvas,w=new FileReader,A=new Image,I=new Promise((k,M)=>{A.onload=()=>{e.bitmap=A,e.isSvg=!0,k()},w.onload=async()=>{const z=e.svgUrl=w.result;A.src=await u?`${z}#svgView(preserveAspectRatio(none))`:z},A.onerror=w.onerror=M});w.readAsDataURL(r),await I}else e.bitmap=await createImageBitmap(r);e.refCounter=1}catch(r){console.error(r),e=null}return this.#s.set(n,e),e&&this.#s.set(e.id,e),e}async getFromFile(n){const{lastModified:m,name:e,size:r,type:u}=n;return this.#i(`${m}_${e}_${r}_${u}`,n)}async getFromUrl(n){return this.#i(n,n)}async getFromId(n){this.#s||=new Map;const m=this.#s.get(n);return m?m.bitmap?(m.refCounter+=1,m):m.file?this.getFromFile(m.file):this.getFromUrl(m.url):null}getSvgUrl(n){const m=this.#s.get(n);return m?.isSvg?m.svgUrl:null}deleteId(n){this.#s||=new Map;const m=this.#s.get(n);m&&(m.refCounter-=1,m.refCounter===0&&(m.bitmap=null))}isValidId(n){return n.startsWith(`image_${this.#t}_`)}}class v{#t=[];#e=!1;#s;#i=-1;constructor(n=128){this.#s=n}add({cmd:n,undo:m,mustExec:e,type:r=NaN,overwriteIfSameType:u=!1,keepUndo:w=!1}){if(e&&n(),this.#e)return;const A={cmd:n,undo:m,type:r};if(this.#i===-1){this.#t.length>0&&(this.#t.length=0),this.#i=0,this.#t.push(A);return}if(u&&this.#t[this.#i].type===r){w&&(A.undo=this.#t[this.#i].undo),this.#t[this.#i]=A;return}const I=this.#i+1;I===this.#s?this.#t.splice(0,1):(this.#i=I,I<this.#t.length&&this.#t.splice(I)),this.#t.push(A)}undo(){this.#i!==-1&&(this.#e=!0,this.#t[this.#i].undo(),this.#e=!1,this.#i-=1)}redo(){this.#i<this.#t.length-1&&(this.#i+=1,this.#e=!0,this.#t[this.#i].cmd(),this.#e=!1)}hasSomethingToUndo(){return this.#i!==-1}hasSomethingToRedo(){return this.#i<this.#t.length-1}destroy(){this.#t=null}}class g{constructor(n){this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:m}=l.FeatureTest.platform;for(const[e,r,u={}]of n)for(const w of e){const A=w.startsWith("mac+");m&&A?(this.callbacks.set(w.slice(4),{callback:r,options:u}),this.allKeys.add(w.split("+").at(-1))):!m&&!A&&(this.callbacks.set(w,{callback:r,options:u}),this.allKeys.add(w.split("+").at(-1)))}}#t(n){n.altKey&&this.buffer.push("alt"),n.ctrlKey&&this.buffer.push("ctrl"),n.metaKey&&this.buffer.push("meta"),n.shiftKey&&this.buffer.push("shift"),this.buffer.push(n.key);const m=this.buffer.join("+");return this.buffer.length=0,m}exec(n,m){if(!this.allKeys.has(m.key))return;const e=this.callbacks.get(this.#t(m));if(!e)return;const{callback:r,options:{bubbles:u=!1,args:w=[],checker:A=null}}=e;A&&!A(n,m)||(r.bind(n,...w,m)(),u||(m.stopPropagation(),m.preventDefault()))}}class o{static _colorsMapping=new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]);get _colors(){const n=new Map([["CanvasText",null],["Canvas",null]]);return(0,D.getColorValues)(n),(0,l.shadow)(this,"_colors",n)}convert(n){const m=(0,D.getRGB)(n);if(!window.matchMedia("(forced-colors: active)").matches)return m;for(const[e,r]of this._colors)if(r.every((u,w)=>u===m[w]))return o._colorsMapping.get(e);return m}getHexCode(n){const m=this._colors.get(n);return m?l.Util.makeHexColor(...m):n}}class c{#t=null;#e=new Map;#s=new Map;#i=null;#n=null;#r=new v;#o=0;#l=new Set;#h=null;#c=null;#f=new Set;#u=null;#d=null;#a=null;#p=new E;#m=!1;#b=!1;#A=null;#y=null;#v=l.AnnotationEditorType.NONE;#g=new Set;#C=null;#L=this.blur.bind(this);#M=this.focus.bind(this);#I=this.copy.bind(this);#_=this.cut.bind(this);#N=this.paste.bind(this);#w=this.keydown.bind(this);#D=this.onEditingAction.bind(this);#E=this.onPageChanging.bind(this);#S=this.onScaleChanging.bind(this);#P=this.onRotationChanging.bind(this);#H={isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1};#T=[0,0];#k=null;#F=null;#z=null;static TRANSLATE_SMALL=1;static TRANSLATE_BIG=10;static get _keyboardManager(){const n=c.prototype,m=w=>w.#F.contains(document.activeElement)&&document.activeElement.tagName!=="BUTTON"&&w.hasSomethingToControl(),e=(w,{target:A})=>{if(A instanceof HTMLInputElement){const{type:I}=A;return I!=="text"&&I!=="number"}return!0},r=this.TRANSLATE_SMALL,u=this.TRANSLATE_BIG;return(0,l.shadow)(this,"_keyboardManager",new g([[["ctrl+a","mac+meta+a"],n.selectAll,{checker:e}],[["ctrl+z","mac+meta+z"],n.undo,{checker:e}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],n.redo,{checker:e}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],n.delete,{checker:e}],[["Enter","mac+Enter"],n.addNewEditorFromKeyboard,{checker:(w,{target:A})=>!(A instanceof HTMLButtonElement)&&w.#F.contains(A)&&!w.isEnterHandled}],[[" ","mac+ "],n.addNewEditorFromKeyboard,{checker:w=>w.#F.contains(document.activeElement)}],[["Escape","mac+Escape"],n.unselectAll],[["ArrowLeft","mac+ArrowLeft"],n.translateSelectedEditors,{args:[-r,0],checker:m}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],n.translateSelectedEditors,{args:[-u,0],checker:m}],[["ArrowRight","mac+ArrowRight"],n.translateSelectedEditors,{args:[r,0],checker:m}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],n.translateSelectedEditors,{args:[u,0],checker:m}],[["ArrowUp","mac+ArrowUp"],n.translateSelectedEditors,{args:[0,-r],checker:m}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],n.translateSelectedEditors,{args:[0,-u],checker:m}],[["ArrowDown","mac+ArrowDown"],n.translateSelectedEditors,{args:[0,r],checker:m}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],n.translateSelectedEditors,{args:[0,u],checker:m}]]))}constructor(n,m,e,r,u,w,A){this.#F=n,this.#z=m,this.#i=e,this._eventBus=r,this._eventBus._on("editingaction",this.#D),this._eventBus._on("pagechanging",this.#E),this._eventBus._on("scalechanging",this.#S),this._eventBus._on("rotationchanging",this.#P),this.#n=u.annotationStorage,this.#u=u.filterFactory,this.#C=w,this.#a=A||null,this.viewParameters={realScale:D.PixelsPerInch.PDF_TO_CSS_UNITS,rotation:0}}destroy(){this.#R(),this.#B(),this._eventBus._off("editingaction",this.#D),this._eventBus._off("pagechanging",this.#E),this._eventBus._off("scalechanging",this.#S),this._eventBus._off("rotationchanging",this.#P);for(const n of this.#s.values())n.destroy();this.#s.clear(),this.#e.clear(),this.#f.clear(),this.#t=null,this.#g.clear(),this.#r.destroy(),this.#i?.destroy(),this.#d&&(clearTimeout(this.#d),this.#d=null),this.#k&&(clearTimeout(this.#k),this.#k=null)}get hcmFilter(){return(0,l.shadow)(this,"hcmFilter",this.#C?this.#u.addHCMFilter(this.#C.foreground,this.#C.background):"none")}get direction(){return(0,l.shadow)(this,"direction",getComputedStyle(this.#F).direction)}get highlightColors(){return(0,l.shadow)(this,"highlightColors",this.#a?new Map(this.#a.split(",").map(n=>n.split("=").map(m=>m.trim()))):null)}setMainHighlightColorPicker(n){this.#y=n}editAltText(n){this.#i?.editAltText(this,n)}onPageChanging({pageNumber:n}){this.#o=n-1}focusMainContainer(){this.#F.focus()}findParent(n,m){for(const e of this.#s.values()){const{x:r,y:u,width:w,height:A}=e.div.getBoundingClientRect();if(n>=r&&n<=r+w&&m>=u&&m<=u+A)return e}return null}disableUserSelect(n=!1){this.#z.classList.toggle("noUserSelect",n)}addShouldRescale(n){this.#f.add(n)}removeShouldRescale(n){this.#f.delete(n)}onScaleChanging({scale:n}){this.commitOrRemove(),this.viewParameters.realScale=n*D.PixelsPerInch.PDF_TO_CSS_UNITS;for(const m of this.#f)m.onScaleChanging()}onRotationChanging({pagesRotation:n}){this.commitOrRemove(),this.viewParameters.rotation=n}addToAnnotationStorage(n){!n.isEmpty()&&this.#n&&!this.#n.has(n.id)&&this.#n.setValue(n.id,n)}#G(){window.addEventListener("focus",this.#M),window.addEventListener("blur",this.#L)}#B(){window.removeEventListener("focus",this.#M),window.removeEventListener("blur",this.#L)}blur(){if(!this.hasSelection)return;const{activeElement:n}=document;for(const m of this.#g)if(m.div.contains(n)){this.#A=[m,n],m._focusEventsAllowed=!1;break}}focus(){if(!this.#A)return;const[n,m]=this.#A;this.#A=null,m.addEventListener("focusin",()=>{n._focusEventsAllowed=!0},{once:!0}),m.focus()}#O(){window.addEventListener("keydown",this.#w)}#R(){window.removeEventListener("keydown",this.#w)}#U(){document.addEventListener("copy",this.#I),document.addEventListener("cut",this.#_),document.addEventListener("paste",this.#N)}#X(){document.removeEventListener("copy",this.#I),document.removeEventListener("cut",this.#_),document.removeEventListener("paste",this.#N)}addEditListeners(){this.#O(),this.#U()}removeEditListeners(){this.#R(),this.#X()}copy(n){if(n.preventDefault(),this.#t?.commitOrRemove(),!this.hasSelection)return;const m=[];for(const e of this.#g){const r=e.serialize(!0);r&&m.push(r)}m.length!==0&&n.clipboardData.setData("application/pdfjs",JSON.stringify(m))}cut(n){this.copy(n),this.delete()}paste(n){n.preventDefault();const{clipboardData:m}=n;for(const u of m.items)for(const w of this.#c)if(w.isHandlingMimeForPasting(u.type)){w.paste(u,this.currentLayer);return}let e=m.getData("application/pdfjs");if(!e)return;try{e=JSON.parse(e)}catch(u){(0,l.warn)(`paste: "${u.message}".`);return}if(!Array.isArray(e))return;this.unselectAll();const r=this.currentLayer;try{const u=[];for(const I of e){const k=r.deserialize(I);if(!k)return;u.push(k)}const w=()=>{for(const I of u)this.#j(I);this.#Y(u)},A=()=>{for(const I of u)I.remove()};this.addCommands({cmd:w,undo:A,mustExec:!0})}catch(u){(0,l.warn)(`paste: "${u.message}".`)}}keydown(n){this.isEditorHandlingKeyboard||c._keyboardManager.exec(this,n)}onEditingAction(n){["undo","redo","delete","selectAll"].includes(n.name)&&this[n.name]()}#x(n){Object.entries(n).some(([e,r])=>this.#H[e]!==r)&&this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(this.#H,n)})}#$(n){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:n})}setEditingState(n){n?(this.#G(),this.#O(),this.#U(),this.#x({isEditing:this.#v!==l.AnnotationEditorType.NONE,isEmpty:this.#V(),hasSomethingToUndo:this.#r.hasSomethingToUndo(),hasSomethingToRedo:this.#r.hasSomethingToRedo(),hasSelectedEditor:!1})):(this.#B(),this.#R(),this.#X(),this.#x({isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(n){if(!this.#c){this.#c=n;for(const m of this.#c)this.#$(m.defaultPropertiesToUpdate)}}getId(){return this.#p.getId()}get currentLayer(){return this.#s.get(this.#o)}getLayer(n){return this.#s.get(n)}get currentPageIndex(){return this.#o}addLayer(n){this.#s.set(n.pageIndex,n),this.#m?n.enable():n.disable()}removeLayer(n){this.#s.delete(n.pageIndex)}updateMode(n,m=null,e=!1){if(this.#v!==n){if(this.#v=n,n===l.AnnotationEditorType.NONE){this.setEditingState(!1),this.#W();return}this.setEditingState(!0),this.#q(),this.unselectAll();for(const r of this.#s.values())r.updateMode(n);if(!m&&e){this.addNewEditorFromKeyboard();return}if(m){for(const r of this.#e.values())if(r.annotationElementId===m){this.setSelected(r),r.enterInEditMode();break}}}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(n){n!==this.#v&&this._eventBus.dispatch("switchannotationeditormode",{source:this,mode:n})}updateParams(n,m){if(this.#c){switch(n){case l.AnnotationEditorParamsType.CREATE:this.currentLayer.addNewEditor();return;case l.AnnotationEditorParamsType.HIGHLIGHT_DEFAULT_COLOR:this.#y?.updateColor(m);break}for(const e of this.#g)e.updateParams(n,m);for(const e of this.#c)e.updateDefaultParams(n,m)}}enableWaiting(n=!1){if(this.#b!==n){this.#b=n;for(const m of this.#s.values())n?m.disableClick():m.enableClick(),m.div.classList.toggle("waiting",n)}}#q(){if(!this.#m){this.#m=!0;for(const n of this.#s.values())n.enable()}}#W(){if(this.unselectAll(),this.#m){this.#m=!1;for(const n of this.#s.values())n.disable()}}getEditors(n){const m=[];for(const e of this.#e.values())e.pageIndex===n&&m.push(e);return m}getEditor(n){return this.#e.get(n)}addEditor(n){this.#e.set(n.id,n)}removeEditor(n){n.div.contains(document.activeElement)&&(this.#d&&clearTimeout(this.#d),this.#d=setTimeout(()=>{this.focusMainContainer(),this.#d=null},0)),this.#e.delete(n.id),this.unselect(n),(!n.annotationElementId||!this.#l.has(n.annotationElementId))&&this.#n?.remove(n.id)}addDeletedAnnotationElement(n){this.#l.add(n.annotationElementId),n.deleted=!0}isDeletedAnnotationElement(n){return this.#l.has(n)}removeDeletedAnnotationElement(n){this.#l.delete(n.annotationElementId),n.deleted=!1}#j(n){const m=this.#s.get(n.pageIndex);m?m.addOrRebuild(n):this.addEditor(n)}setActiveEditor(n){this.#t!==n&&(this.#t=n,n&&this.#$(n.propertiesToUpdate))}toggleSelected(n){if(this.#g.has(n)){this.#g.delete(n),n.unselect(),this.#x({hasSelectedEditor:this.hasSelection});return}this.#g.add(n),n.select(),this.#$(n.propertiesToUpdate),this.#x({hasSelectedEditor:!0})}setSelected(n){for(const m of this.#g)m!==n&&m.unselect();this.#g.clear(),this.#g.add(n),n.select(),this.#$(n.propertiesToUpdate),this.#x({hasSelectedEditor:!0})}isSelected(n){return this.#g.has(n)}get firstSelectedEditor(){return this.#g.values().next().value}unselect(n){n.unselect(),this.#g.delete(n),this.#x({hasSelectedEditor:this.hasSelection})}get hasSelection(){return this.#g.size!==0}get isEnterHandled(){return this.#g.size===1&&this.firstSelectedEditor.isEnterHandled}undo(){this.#r.undo(),this.#x({hasSomethingToUndo:this.#r.hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:this.#V()})}redo(){this.#r.redo(),this.#x({hasSomethingToUndo:!0,hasSomethingToRedo:this.#r.hasSomethingToRedo(),isEmpty:this.#V()})}addCommands(n){this.#r.add(n),this.#x({hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:this.#V()})}#V(){if(this.#e.size===0)return!0;if(this.#e.size===1)for(const n of this.#e.values())return n.isEmpty();return!1}delete(){if(this.commitOrRemove(),!this.hasSelection)return;const n=[...this.#g],m=()=>{for(const r of n)r.remove()},e=()=>{for(const r of n)this.#j(r)};this.addCommands({cmd:m,undo:e,mustExec:!0})}commitOrRemove(){this.#t?.commitOrRemove()}hasSomethingToControl(){return this.#t||this.hasSelection}#Y(n){this.#g.clear();for(const m of n)m.isEmpty()||(this.#g.add(m),m.select());this.#x({hasSelectedEditor:!0})}selectAll(){for(const n of this.#g)n.commit();this.#Y(this.#e.values())}unselectAll(){if(!(this.#t&&(this.#t.commitOrRemove(),this.#v!==l.AnnotationEditorType.NONE))&&this.hasSelection){for(const n of this.#g)n.unselect();this.#g.clear(),this.#x({hasSelectedEditor:!1})}}translateSelectedEditors(n,m,e=!1){if(e||this.commitOrRemove(),!this.hasSelection)return;this.#T[0]+=n,this.#T[1]+=m;const[r,u]=this.#T,w=[...this.#g],A=1e3;this.#k&&clearTimeout(this.#k),this.#k=setTimeout(()=>{this.#k=null,this.#T[0]=this.#T[1]=0,this.addCommands({cmd:()=>{for(const I of w)this.#e.has(I.id)&&I.translateInPage(r,u)},undo:()=>{for(const I of w)this.#e.has(I.id)&&I.translateInPage(-r,-u)},mustExec:!1})},A);for(const I of w)I.translateInPage(n,m)}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),this.#h=new Map;for(const n of this.#g)this.#h.set(n,{savedX:n.x,savedY:n.y,savedPageIndex:n.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!this.#h)return!1;this.disableUserSelect(!1);const n=this.#h;this.#h=null;let m=!1;for(const[{x:r,y:u,pageIndex:w},A]of n)A.newX=r,A.newY=u,A.newPageIndex=w,m||=r!==A.savedX||u!==A.savedY||w!==A.savedPageIndex;if(!m)return!1;const e=(r,u,w,A)=>{if(this.#e.has(r.id)){const I=this.#s.get(A);I?r._setParentAndPosition(I,u,w):(r.pageIndex=A,r.x=u,r.y=w)}};return this.addCommands({cmd:()=>{for(const[r,{newX:u,newY:w,newPageIndex:A}]of n)e(r,u,w,A)},undo:()=>{for(const[r,{savedX:u,savedY:w,savedPageIndex:A}]of n)e(r,u,w,A)},mustExec:!0}),!0}dragSelectedEditors(n,m){if(this.#h)for(const e of this.#h.keys())e.drag(n,m)}rebuild(n){if(n.parent===null){const m=this.getLayer(n.pageIndex);m?(m.changeParent(n),m.addOrRebuild(n)):(this.addEditor(n),this.addToAnnotationStorage(n),n.rebuild())}else n.parent.addOrRebuild(n)}get isEditorHandlingKeyboard(){return this.getActive()?.shouldGetKeyboardEvents()||this.#g.size===1&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(n){return this.#t===n}getActive(){return this.#t}getMode(){return this.#v}get imageManager(){return(0,l.shadow)(this,"imageManager",new T)}}},171:(L,C,x)=>{x.d(C,{PDFFetchStream:()=>T});var l=x(266),D=x(253);function y(o,c,p){return{method:"GET",headers:o,signal:p.signal,mode:"cors",credentials:c?"include":"same-origin",redirect:"follow"}}function P(o){const c=new Headers;for(const p in o){const n=o[p];n!==void 0&&c.append(p,n)}return c}function E(o){return o instanceof Uint8Array?o.buffer:o instanceof ArrayBuffer?o:((0,l.warn)(`getArrayBuffer - unexpected data format: ${o}`),new Uint8Array(o).buffer)}class T{constructor(c){this.source=c,this.isHttp=/^https?:/i.test(c.url),this.httpHeaders=this.isHttp&&c.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return(0,l.assert)(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new v(this),this._fullRequestReader}getRangeReader(c,p){if(p<=this._progressiveDataLength)return null;const n=new g(this,c,p);return this._rangeRequestReaders.push(n),n}cancelAllRequests(c){this._fullRequestReader?.cancel(c);for(const p of this._rangeRequestReaders.slice(0))p.cancel(c)}}class v{constructor(c){this._stream=c,this._reader=null,this._loaded=0,this._filename=null;const p=c.source;this._withCredentials=p.withCredentials||!1,this._contentLength=p.length,this._headersCapability=new l.PromiseCapability,this._disableRange=p.disableRange||!1,this._rangeChunkSize=p.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!p.disableStream,this._isRangeSupported=!p.disableRange,this._headers=P(this._stream.httpHeaders);const n=p.url;fetch(n,y(this._headers,this._withCredentials,this._abortController)).then(m=>{if(!(0,D.validateResponseStatus)(m.status))throw(0,D.createResponseStatusError)(m.status,n);this._reader=m.body.getReader(),this._headersCapability.resolve();const e=w=>m.headers.get(w),{allowRangeRequests:r,suggestedLength:u}=(0,D.validateRangeRequestCapabilities)({getResponseHeader:e,isHttp:this._stream.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=r,this._contentLength=u||this._contentLength,this._filename=(0,D.extractFilenameFromHeader)(e),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new l.AbortException("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._headersCapability.promise;const{value:c,done:p}=await this._reader.read();return p?{value:c,done:p}:(this._loaded+=c.byteLength,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:E(c),done:!1})}cancel(c){this._reader?.cancel(c),this._abortController.abort()}}class g{constructor(c,p,n){this._stream=c,this._reader=null,this._loaded=0;const m=c.source;this._withCredentials=m.withCredentials||!1,this._readCapability=new l.PromiseCapability,this._isStreamingSupported=!m.disableStream,this._abortController=new AbortController,this._headers=P(this._stream.httpHeaders),this._headers.append("Range",`bytes=${p}-${n-1}`);const e=m.url;fetch(e,y(this._headers,this._withCredentials,this._abortController)).then(r=>{if(!(0,D.validateResponseStatus)(r.status))throw(0,D.createResponseStatusError)(r.status,e);this._readCapability.resolve(),this._reader=r.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._readCapability.promise;const{value:c,done:p}=await this._reader.read();return p?{value:c,done:p}:(this._loaded+=c.byteLength,this.onProgress?.({loaded:this._loaded}),{value:E(c),done:!1})}cancel(c){this._reader?.cancel(c),this._abortController.abort()}}},742:(L,C,x)=>{x.d(C,{FontFaceObject:()=>y,FontLoader:()=>D});var l=x(266);class D{#t=new Set;constructor({ownerDocument:E=globalThis.document,styleElement:T=null}){this._document=E,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(E){this.nativeFontFaces.add(E),this._document.fonts.add(E)}removeNativeFontFace(E){this.nativeFontFaces.delete(E),this._document.fonts.delete(E)}insertRule(E){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const T=this.styleElement.sheet;T.insertRule(E,T.cssRules.length)}clear(){for(const E of this.nativeFontFaces)this._document.fonts.delete(E);this.nativeFontFaces.clear(),this.#t.clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont({systemFontInfo:E,_inspectFont:T}){if(!(!E||this.#t.has(E.loadedName))){if((0,l.assert)(!this.disableFontFace,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:v,src:g,style:o}=E,c=new FontFace(v,g,o);this.addNativeFontFace(c);try{await c.load(),this.#t.add(v),T?.(E)}catch{(0,l.warn)(`Cannot load system font: ${E.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(c)}return}(0,l.unreachable)("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(E){if(E.attached||E.missingFile&&!E.systemFontInfo)return;if(E.attached=!0,E.systemFontInfo){await this.loadSystemFont(E);return}if(this.isFontLoadingAPISupported){const v=E.createNativeFontFace();if(v){this.addNativeFontFace(v);try{await v.loaded}catch(g){throw(0,l.warn)(`Failed to load font '${v.family}': '${g}'.`),E.disableFontFace=!0,g}}return}const T=E.createFontFaceRule();if(T){if(this.insertRule(T),this.isSyncFontLoadingSupported)return;await new Promise(v=>{const g=this._queueLoadingCallback(v);this._prepareFontLoadEvent(E,g)})}}get isFontLoadingAPISupported(){const E=!!this._document?.fonts;return(0,l.shadow)(this,"isFontLoadingAPISupported",E)}get isSyncFontLoadingSupported(){let E=!1;return(l.isNodeJS||typeof navigator<"u"&&typeof navigator?.userAgent=="string"&&/Mozilla\/5.0.*?rv:\d+.*? Gecko/.test(navigator.userAgent))&&(E=!0),(0,l.shadow)(this,"isSyncFontLoadingSupported",E)}_queueLoadingCallback(E){function T(){for((0,l.assert)(!g.done,"completeRequest() cannot be called twice."),g.done=!0;v.length>0&&v[0].done;){const o=v.shift();setTimeout(o.callback,0)}}const{loadingRequests:v}=this,g={done:!1,complete:T,callback:E};return v.push(g),g}get _loadTestFont(){const E=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return(0,l.shadow)(this,"_loadTestFont",E)}_prepareFontLoadEvent(E,T){function v(X,q){return X.charCodeAt(q)<<24|X.charCodeAt(q+1)<<16|X.charCodeAt(q+2)<<8|X.charCodeAt(q+3)&255}function g(X,q,et,at){const W=X.substring(0,q),$=X.substring(q+et);return W+at+$}let o,c;const p=this._document.createElement("canvas");p.width=1,p.height=1;const n=p.getContext("2d");let m=0;function e(X,q){if(++m>30){(0,l.warn)("Load test font never loaded."),q();return}if(n.font="30px "+X,n.fillText(".",0,20),n.getImageData(0,0,1,1).data[3]>0){q();return}setTimeout(e.bind(null,X,q))}const r=`lt${Date.now()}${this.loadTestFontId++}`;let u=this._loadTestFont;u=g(u,976,r.length,r);const A=16,I=1482184792;let k=v(u,A);for(o=0,c=r.length-3;o<c;o+=4)k=k-I+v(r,o)|0;o<r.length&&(k=k-I+v(r+"XXX",o)|0),u=g(u,A,4,(0,l.string32)(k));const M=`url(data:font/opentype;base64,${btoa(u)});`,z=`@font-face {font-family:"${r}";src:${M}}`;this.insertRule(z);const G=this._document.createElement("div");G.style.visibility="hidden",G.style.width=G.style.height="10px",G.style.position="absolute",G.style.top=G.style.left="0px";for(const X of[E.loadedName,r]){const q=this._document.createElement("span");q.textContent="Hi",q.style.fontFamily=X,G.append(q)}this._document.body.append(G),e(r,()=>{G.remove(),T.complete()})}}class y{constructor(E,{isEvalSupported:T=!0,disableFontFace:v=!1,ignoreErrors:g=!1,inspectFont:o=null}){this.compiledGlyphs=Object.create(null);for(const c in E)this[c]=E[c];this.isEvalSupported=T!==!1,this.disableFontFace=v===!0,this.ignoreErrors=g===!0,this._inspectFont=o}createNativeFontFace(){if(!this.data||this.disableFontFace)return null;let E;if(!this.cssFontInfo)E=new FontFace(this.loadedName,this.data,{});else{const T={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(T.style=`oblique ${this.cssFontInfo.italicAngle}deg`),E=new FontFace(this.cssFontInfo.fontFamily,this.data,T)}return this._inspectFont?.(this),E}createFontFaceRule(){if(!this.data||this.disableFontFace)return null;const E=(0,l.bytesToString)(this.data),T=`url(data:${this.mimetype};base64,${btoa(E)});`;let v;if(!this.cssFontInfo)v=`@font-face {font-family:"${this.loadedName}";src:${T}}`;else{let g=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(g+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),v=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${g}src:${T}}`}return this._inspectFont?.(this,T),v}getPathGenerator(E,T){if(this.compiledGlyphs[T]!==void 0)return this.compiledGlyphs[T];let v;try{v=E.get(this.loadedName+"_path_"+T)}catch(g){if(!this.ignoreErrors)throw g;return(0,l.warn)(`getPathGenerator - ignoring character: "${g}".`),this.compiledGlyphs[T]=function(o,c){}}if(this.isEvalSupported&&l.FeatureTest.isEvalSupported){const g=[];for(const o of v){const c=o.args!==void 0?o.args.join(","):"";g.push("c.",o.cmd,"(",c,`);
`)}return this.compiledGlyphs[T]=new Function("c","size",g.join(""))}return this.compiledGlyphs[T]=function(g,o){for(const c of v)c.cmd==="scale"&&(c.args=[o,-o]),g[c.cmd].apply(g,c.args)}}}},472:(L,C,x)=>{x.d(C,{Metadata:()=>D});var l=x(266);class D{#t;#e;constructor({parsedData:P,rawData:E}){this.#t=P,this.#e=E}getRaw(){return this.#e}get(P){return this.#t.get(P)??null}getAll(){return(0,l.objectFromMap)(this.#t)}has(P){return this.#t.has(P)}}},474:(L,C,x)=>{x.d(C,{PDFNetworkStream:()=>v});var l=x(266),D=x(253);const y=200,P=206;function E(c){const p=c.response;return typeof p!="string"?p:(0,l.stringToBytes)(p).buffer}class T{constructor(p,n={}){this.url=p,this.isHttp=/^https?:/i.test(p),this.httpHeaders=this.isHttp&&n.httpHeaders||Object.create(null),this.withCredentials=n.withCredentials||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}requestRange(p,n,m){const e={begin:p,end:n};for(const r in m)e[r]=m[r];return this.request(e)}requestFull(p){return this.request(p)}request(p){const n=new XMLHttpRequest,m=this.currXhrId++,e=this.pendingRequests[m]={xhr:n};n.open("GET",this.url),n.withCredentials=this.withCredentials;for(const r in this.httpHeaders){const u=this.httpHeaders[r];u!==void 0&&n.setRequestHeader(r,u)}return this.isHttp&&"begin"in p&&"end"in p?(n.setRequestHeader("Range",`bytes=${p.begin}-${p.end-1}`),e.expectedStatus=P):e.expectedStatus=y,n.responseType="arraybuffer",p.onError&&(n.onerror=function(r){p.onError(n.status)}),n.onreadystatechange=this.onStateChange.bind(this,m),n.onprogress=this.onProgress.bind(this,m),e.onHeadersReceived=p.onHeadersReceived,e.onDone=p.onDone,e.onError=p.onError,e.onProgress=p.onProgress,n.send(null),m}onProgress(p,n){const m=this.pendingRequests[p];m&&m.onProgress?.(n)}onStateChange(p,n){const m=this.pendingRequests[p];if(!m)return;const e=m.xhr;if(e.readyState>=2&&m.onHeadersReceived&&(m.onHeadersReceived(),delete m.onHeadersReceived),e.readyState!==4||!(p in this.pendingRequests))return;if(delete this.pendingRequests[p],e.status===0&&this.isHttp){m.onError?.(e.status);return}const r=e.status||y;if(!(r===y&&m.expectedStatus===P)&&r!==m.expectedStatus){m.onError?.(e.status);return}const w=E(e);if(r===P){const A=e.getResponseHeader("Content-Range"),I=/bytes (\d+)-(\d+)\/(\d+)/.exec(A);m.onDone({begin:parseInt(I[1],10),chunk:w})}else w?m.onDone({begin:0,chunk:w}):m.onError?.(e.status)}getRequestXhr(p){return this.pendingRequests[p].xhr}isPendingRequest(p){return p in this.pendingRequests}abortRequest(p){const n=this.pendingRequests[p].xhr;delete this.pendingRequests[p],n.abort()}}class v{constructor(p){this._source=p,this._manager=new T(p.url,{httpHeaders:p.httpHeaders,withCredentials:p.withCredentials}),this._rangeChunkSize=p.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(p){const n=this._rangeRequestReaders.indexOf(p);n>=0&&this._rangeRequestReaders.splice(n,1)}getFullReader(){return(0,l.assert)(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new g(this._manager,this._source),this._fullRequestReader}getRangeReader(p,n){const m=new o(this._manager,p,n);return m.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(m),m}cancelAllRequests(p){this._fullRequestReader?.cancel(p);for(const n of this._rangeRequestReaders.slice(0))n.cancel(p)}}class g{constructor(p,n){this._manager=p;const m={onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=n.url,this._fullRequestId=p.requestFull(m),this._headersReceivedCapability=new l.PromiseCapability,this._disableRange=n.disableRange||!1,this._contentLength=n.length,this._rangeChunkSize=n.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const p=this._fullRequestId,n=this._manager.getRequestXhr(p),m=u=>n.getResponseHeader(u),{allowRangeRequests:e,suggestedLength:r}=(0,D.validateRangeRequestCapabilities)({getResponseHeader:m,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});e&&(this._isRangeSupported=!0),this._contentLength=r||this._contentLength,this._filename=(0,D.extractFilenameFromHeader)(m),this._isRangeSupported&&this._manager.abortRequest(p),this._headersReceivedCapability.resolve()}_onDone(p){if(p&&(this._requests.length>0?this._requests.shift().resolve({value:p.chunk,done:!1}):this._cachedChunks.push(p.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const n of this._requests)n.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(p){this._storedError=(0,D.createResponseStatusError)(p,this._url),this._headersReceivedCapability.reject(this._storedError);for(const n of this._requests)n.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(p){this.onProgress?.({loaded:p.loaded,total:p.lengthComputable?p.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersReceivedCapability.promise}async read(){if(this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const p=new l.PromiseCapability;return this._requests.push(p),p.promise}cancel(p){this._done=!0,this._headersReceivedCapability.reject(p);for(const n of this._requests)n.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class o{constructor(p,n,m){this._manager=p;const e={onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=p.url,this._requestId=p.requestRange(n,m,e),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_close(){this.onClosed?.(this)}_onDone(p){const n=p.chunk;this._requests.length>0?this._requests.shift().resolve({value:n,done:!1}):this._queuedChunk=n,this._done=!0;for(const m of this._requests)m.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(p){this._storedError=(0,D.createResponseStatusError)(p,this._url);for(const n of this._requests)n.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(p){this.isStreamingSupported||this.onProgress?.({loaded:p.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const n=this._queuedChunk;return this._queuedChunk=null,{value:n,done:!1}}if(this._done)return{value:void 0,done:!0};const p=new l.PromiseCapability;return this._requests.push(p),p.promise}cancel(p){this._done=!0;for(const n of this._requests)n.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}},253:(L,C,x)=>{x.d(C,{createResponseStatusError:()=>T,extractFilenameFromHeader:()=>E,validateRangeRequestCapabilities:()=>P,validateResponseStatus:()=>v});var l=x(266);function D(g){let o=!0,c=p("filename\\*","i").exec(g);if(c){c=c[1];let A=r(c);return A=unescape(A),A=u(A),A=w(A),m(A)}if(c=e(g),c){const A=w(c);return m(A)}if(c=p("filename","i").exec(g),c){c=c[1];let A=r(c);return A=w(A),m(A)}function p(A,I){return new RegExp("(?:^|;)\\s*"+A+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',I)}function n(A,I){if(A){if(!/^[\x00-\xFF]+$/.test(I))return I;try{const k=new TextDecoder(A,{fatal:!0}),M=(0,l.stringToBytes)(I);I=k.decode(M),o=!1}catch{}}return I}function m(A){return o&&/[\x80-\xff]/.test(A)&&(A=n("utf-8",A),o&&(A=n("iso-8859-1",A))),A}function e(A){const I=[];let k;const M=p("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(k=M.exec(A))!==null;){let[,G,X,q]=k;if(G=parseInt(G,10),G in I){if(G===0)break;continue}I[G]=[X,q]}const z=[];for(let G=0;G<I.length&&G in I;++G){let[X,q]=I[G];q=r(q),X&&(q=unescape(q),G===0&&(q=u(q))),z.push(q)}return z.join("")}function r(A){if(A.startsWith('"')){const I=A.slice(1).split('\\"');for(let k=0;k<I.length;++k){const M=I[k].indexOf('"');M!==-1&&(I[k]=I[k].slice(0,M),I.length=k+1),I[k]=I[k].replaceAll(/\\(.)/g,"$1")}A=I.join('"')}return A}function u(A){const I=A.indexOf("'");if(I===-1)return A;const k=A.slice(0,I),z=A.slice(I+1).replace(/^[^']*'/,"");return n(k,z)}function w(A){return!A.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(A)?A:A.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(I,k,M,z){if(M==="q"||M==="Q")return z=z.replaceAll("_"," "),z=z.replaceAll(/=([0-9a-fA-F]{2})/g,function(G,X){return String.fromCharCode(parseInt(X,16))}),n(k,z);try{z=atob(z)}catch{}return n(k,z)})}return""}var y=x(473);function P({getResponseHeader:g,isHttp:o,rangeChunkSize:c,disableRange:p}){const n={allowRangeRequests:!1,suggestedLength:void 0},m=parseInt(g("Content-Length"),10);return!Number.isInteger(m)||(n.suggestedLength=m,m<=2*c)||p||!o||g("Accept-Ranges")!=="bytes"||(g("Content-Encoding")||"identity")!=="identity"||(n.allowRangeRequests=!0),n}function E(g){const o=g("Content-Disposition");if(o){let c=D(o);if(c.includes("%"))try{c=decodeURIComponent(c)}catch{}if((0,y.isPdfFile)(c))return c}return null}function T(g,o){return g===404||g===0&&o.startsWith("file:")?new l.MissingPDFException('Missing PDF "'+o+'".'):new l.UnexpectedResponseException(`Unexpected server response (${g}) while retrieving PDF "${o}".`,g)}function v(g){return g===200||g===206}},498:(L,C,x)=>{x.a(L,async(l,D)=>{try{let c=function(I){const k=g.parse(I);return k.protocol==="file:"||k.host?k:/^[a-z]:[/\\]/i.test(I)?g.parse(`file:///${I}`):(k.host||(k.protocol="file:"),k)},e=function(I,k){return{protocol:I.protocol,auth:I.auth,host:I.hostname,port:I.port,path:I.path,method:"GET",headers:k}};x.d(C,{PDFNodeStream:()=>p});var y=x(266),P=x(253);let E,T,v,g;y.isNodeJS&&(E=await $t(()=>import("./sopn-matcher-__vite-browser-external.js"),[]),T=await $t(()=>import("./sopn-matcher-__vite-browser-external.js"),[]),v=await $t(()=>import("./sopn-matcher-__vite-browser-external.js"),[]),g=await $t(()=>import("./sopn-matcher-__vite-browser-external.js"),[]));const o=/^file:\/\/\/[a-zA-Z]:\//;class p{constructor(k){this.source=k,this.url=c(k.url),this.isHttp=this.url.protocol==="http:"||this.url.protocol==="https:",this.isFsUrl=this.url.protocol==="file:",this.httpHeaders=this.isHttp&&k.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return(0,y.assert)(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=this.isFsUrl?new w(this):new r(this),this._fullRequestReader}getRangeReader(k,M){if(M<=this._progressiveDataLength)return null;const z=this.isFsUrl?new A(this,k,M):new u(this,k,M);return this._rangeRequestReaders.push(z),z}cancelAllRequests(k){this._fullRequestReader?.cancel(k);for(const M of this._rangeRequestReaders.slice(0))M.cancel(k)}}class n{constructor(k){this._url=k.url,this._done=!1,this._storedError=null,this.onProgress=null;const M=k.source;this._contentLength=M.length,this._loaded=0,this._filename=null,this._disableRange=M.disableRange||!1,this._rangeChunkSize=M.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!M.disableStream,this._isRangeSupported=!M.disableRange,this._readableStream=null,this._readCapability=new y.PromiseCapability,this._headersCapability=new y.PromiseCapability}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const k=this._readableStream.read();return k===null?(this._readCapability=new y.PromiseCapability,this.read()):(this._loaded+=k.length,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(k).buffer,done:!1})}cancel(k){if(!this._readableStream){this._error(k);return}this._readableStream.destroy(k)}_error(k){this._storedError=k,this._readCapability.resolve()}_setReadableStream(k){this._readableStream=k,k.on("readable",()=>{this._readCapability.resolve()}),k.on("end",()=>{k.destroy(),this._done=!0,this._readCapability.resolve()}),k.on("error",M=>{this._error(M)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new y.AbortException("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class m{constructor(k){this._url=k.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=new y.PromiseCapability;const M=k.source;this._isStreamingSupported=!M.disableStream}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const k=this._readableStream.read();return k===null?(this._readCapability=new y.PromiseCapability,this.read()):(this._loaded+=k.length,this.onProgress?.({loaded:this._loaded}),{value:new Uint8Array(k).buffer,done:!1})}cancel(k){if(!this._readableStream){this._error(k);return}this._readableStream.destroy(k)}_error(k){this._storedError=k,this._readCapability.resolve()}_setReadableStream(k){this._readableStream=k,k.on("readable",()=>{this._readCapability.resolve()}),k.on("end",()=>{k.destroy(),this._done=!0,this._readCapability.resolve()}),k.on("error",M=>{this._error(M)}),this._storedError&&this._readableStream.destroy(this._storedError)}}class r extends n{constructor(k){super(k);const M=z=>{if(z.statusCode===404){const et=new y.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=et,this._headersCapability.reject(et);return}this._headersCapability.resolve(),this._setReadableStream(z);const G=et=>this._readableStream.headers[et.toLowerCase()],{allowRangeRequests:X,suggestedLength:q}=(0,P.validateRangeRequestCapabilities)({getResponseHeader:G,isHttp:k.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=X,this._contentLength=q||this._contentLength,this._filename=(0,P.extractFilenameFromHeader)(G)};this._request=null,this._url.protocol==="http:"?this._request=T.request(e(this._url,k.httpHeaders),M):this._request=v.request(e(this._url,k.httpHeaders),M),this._request.on("error",z=>{this._storedError=z,this._headersCapability.reject(z)}),this._request.end()}}class u extends m{constructor(k,M,z){super(k),this._httpHeaders={};for(const X in k.httpHeaders){const q=k.httpHeaders[X];q!==void 0&&(this._httpHeaders[X]=q)}this._httpHeaders.Range=`bytes=${M}-${z-1}`;const G=X=>{if(X.statusCode===404){const q=new y.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=q;return}this._setReadableStream(X)};this._request=null,this._url.protocol==="http:"?this._request=T.request(e(this._url,this._httpHeaders),G):this._request=v.request(e(this._url,this._httpHeaders),G),this._request.on("error",X=>{this._storedError=X}),this._request.end()}}class w extends n{constructor(k){super(k);let M=decodeURIComponent(this._url.path);o.test(this._url.href)&&(M=M.replace(/^\//,"")),E.lstat(M,(z,G)=>{if(z){z.code==="ENOENT"&&(z=new y.MissingPDFException(`Missing PDF "${M}".`)),this._storedError=z,this._headersCapability.reject(z);return}this._contentLength=G.size,this._setReadableStream(E.createReadStream(M)),this._headersCapability.resolve()})}}class A extends m{constructor(k,M,z){super(k);let G=decodeURIComponent(this._url.path);o.test(this._url.href)&&(G=G.replace(/^\//,"")),this._setReadableStream(E.createReadStream(G,{start:M,end:z-1}))}}D()}catch(E){D(E)}},1)},738:(L,C,x)=>{x.a(L,async(l,D)=>{try{x.d(C,{NodeCMapReaderFactory:()=>p,NodeCanvasFactory:()=>c,NodeFilterFactory:()=>o,NodeStandardFontDataFactory:()=>n});var y=x(822),P=x(266);let E,T,v;if(P.isNodeJS){E=await $t(()=>import("./sopn-matcher-__vite-browser-external.js"),[]);try{T=await $t(()=>import("./sopn-matcher-__vite-browser-external.js"),[])}catch{}try{v=await $t(()=>import("./sopn-matcher-path2d-polyfill.min.js"),[])}catch{}}const g=function(m){return new Promise((e,r)=>{E.readFile(m,(u,w)=>{if(u||!w){r(new Error(u));return}e(new Uint8Array(w))})})};class o extends y.BaseFilterFactory{}class c extends y.BaseCanvasFactory{_createCanvas(e,r){return T.createCanvas(e,r)}}class p extends y.BaseCMapReaderFactory{_fetchData(e,r){return g(e).then(u=>({cMapData:u,compressionType:r}))}}class n extends y.BaseStandardFontDataFactory{_fetchData(e){return g(e)}}D()}catch(E){D(E)}},1)},890:(L,C,x)=>{x.d(C,{OptionalContentConfig:()=>E});var l=x(266),D=x(825);const y=Symbol("INTERNAL");class P{#t=!0;constructor(v,g){this.name=v,this.intent=g}get visible(){return this.#t}_setVisible(v,g){v!==y&&(0,l.unreachable)("Internal method `_setVisible` called."),this.#t=g}}class E{#t=null;#e=new Map;#s=null;#i=null;constructor(v){if(this.name=null,this.creator=null,v!==null){this.name=v.name,this.creator=v.creator,this.#i=v.order;for(const g of v.groups)this.#e.set(g.id,new P(g.name,g.intent));if(v.baseState==="OFF")for(const g of this.#e.values())g._setVisible(y,!1);for(const g of v.on)this.#e.get(g)._setVisible(y,!0);for(const g of v.off)this.#e.get(g)._setVisible(y,!1);this.#s=this.getHash()}}#n(v){const g=v.length;if(g<2)return!0;const o=v[0];for(let c=1;c<g;c++){const p=v[c];let n;if(Array.isArray(p))n=this.#n(p);else if(this.#e.has(p))n=this.#e.get(p).visible;else return(0,l.warn)(`Optional content group not found: ${p}`),!0;switch(o){case"And":if(!n)return!1;break;case"Or":if(n)return!0;break;case"Not":return!n;default:return!0}}return o==="And"}isVisible(v){if(this.#e.size===0)return!0;if(!v)return(0,l.warn)("Optional content group not defined."),!0;if(v.type==="OCG")return this.#e.has(v.id)?this.#e.get(v.id).visible:((0,l.warn)(`Optional content group not found: ${v.id}`),!0);if(v.type==="OCMD"){if(v.expression)return this.#n(v.expression);if(!v.policy||v.policy==="AnyOn"){for(const g of v.ids){if(!this.#e.has(g))return(0,l.warn)(`Optional content group not found: ${g}`),!0;if(this.#e.get(g).visible)return!0}return!1}else if(v.policy==="AllOn"){for(const g of v.ids){if(!this.#e.has(g))return(0,l.warn)(`Optional content group not found: ${g}`),!0;if(!this.#e.get(g).visible)return!1}return!0}else if(v.policy==="AnyOff"){for(const g of v.ids){if(!this.#e.has(g))return(0,l.warn)(`Optional content group not found: ${g}`),!0;if(!this.#e.get(g).visible)return!0}return!1}else if(v.policy==="AllOff"){for(const g of v.ids){if(!this.#e.has(g))return(0,l.warn)(`Optional content group not found: ${g}`),!0;if(this.#e.get(g).visible)return!1}return!0}return(0,l.warn)(`Unknown optional content policy ${v.policy}.`),!0}return(0,l.warn)(`Unknown group type ${v.type}.`),!0}setVisibility(v,g=!0){if(!this.#e.has(v)){(0,l.warn)(`Optional content group not found: ${v}`);return}this.#e.get(v)._setVisible(y,!!g),this.#t=null}get hasInitialVisibility(){return this.#s===null||this.getHash()===this.#s}getOrder(){return this.#e.size?this.#i?this.#i.slice():[...this.#e.keys()]:null}getGroups(){return this.#e.size>0?(0,l.objectFromMap)(this.#e):null}getGroup(v){return this.#e.get(v)||null}getHash(){if(this.#t!==null)return this.#t;const v=new D.MurmurHash3_64;for(const[g,o]of this.#e)v.update(`${g}:${o.visible}`);return this.#t=v.hexdigest()}}},739:(L,C,x)=>{x.d(C,{renderTextLayer:()=>m,updateTextLayer:()=>e});var l=x(266),D=x(473);const y=1e5,P=30,E=.8,T=new Map;function v(r,u){let w;if(u&&l.FeatureTest.isOffscreenCanvasSupported)w=new OffscreenCanvas(r,r).getContext("2d",{alpha:!1});else{const A=document.createElement("canvas");A.width=A.height=r,w=A.getContext("2d",{alpha:!1})}return w}function g(r,u){const w=T.get(r);if(w)return w;const A=v(P,u);A.font=`${P}px ${r}`;const I=A.measureText("");let k=I.fontBoundingBoxAscent,M=Math.abs(I.fontBoundingBoxDescent);if(k){const G=k/(k+M);return T.set(r,G),A.canvas.width=A.canvas.height=0,G}A.strokeStyle="red",A.clearRect(0,0,P,P),A.strokeText("g",0,0);let z=A.getImageData(0,0,P,P).data;M=0;for(let G=z.length-1-3;G>=0;G-=4)if(z[G]>0){M=Math.ceil(G/4/P);break}A.clearRect(0,0,P,P),A.strokeText("A",0,P),z=A.getImageData(0,0,P,P).data,k=0;for(let G=0,X=z.length;G<X;G+=4)if(z[G]>0){k=P-Math.floor(G/4/P);break}if(A.canvas.width=A.canvas.height=0,k){const G=k/(k+M);return T.set(r,G),G}return T.set(r,E),E}function o(r,u,w){const A=document.createElement("span"),I={angle:0,canvasWidth:0,hasText:u.str!=="",hasEOL:u.hasEOL,fontSize:0};r._textDivs.push(A);const k=l.Util.transform(r._transform,u.transform);let M=Math.atan2(k[1],k[0]);const z=w[u.fontName];z.vertical&&(M+=Math.PI/2);const G=r._fontInspectorEnabled&&z.fontSubstitution||z.fontFamily,X=Math.hypot(k[2],k[3]),q=X*g(G,r._isOffscreenCanvasSupported);let et,at;M===0?(et=k[4],at=k[5]-q):(et=k[4]+q*Math.sin(M),at=k[5]-q*Math.cos(M));const W="calc(var(--scale-factor)*",$=A.style;r._container===r._rootContainer?($.left=`${(100*et/r._pageWidth).toFixed(2)}%`,$.top=`${(100*at/r._pageHeight).toFixed(2)}%`):($.left=`${W}${et.toFixed(2)}px)`,$.top=`${W}${at.toFixed(2)}px)`),$.fontSize=`${W}${X.toFixed(2)}px)`,$.fontFamily=G,I.fontSize=X,A.setAttribute("role","presentation"),A.textContent=u.str,A.dir=u.dir,r._fontInspectorEnabled&&(A.dataset.fontName=z.fontSubstitutionLoadedName||u.fontName),M!==0&&(I.angle=M*(180/Math.PI));let U=!1;if(u.str.length>1)U=!0;else if(u.str!==" "&&u.transform[0]!==u.transform[3]){const J=Math.abs(u.transform[0]),Z=Math.abs(u.transform[3]);J!==Z&&Math.max(J,Z)/Math.min(J,Z)>1.5&&(U=!0)}U&&(I.canvasWidth=z.vertical?u.height:u.width),r._textDivProperties.set(A,I),r._isReadableStream&&r._layoutText(A)}function c(r){const{div:u,scale:w,properties:A,ctx:I,prevFontSize:k,prevFontFamily:M}=r,{style:z}=u;let G="";if(A.canvasWidth!==0&&A.hasText){const{fontFamily:X}=z,{canvasWidth:q,fontSize:et}=A;(k!==et||M!==X)&&(I.font=`${et*w}px ${X}`,r.prevFontSize=et,r.prevFontFamily=X);const{width:at}=I.measureText(u.textContent);at>0&&(G=`scaleX(${q*w/at})`)}A.angle!==0&&(G=`rotate(${A.angle}deg) ${G}`),G.length>0&&(z.transform=G)}function p(r){if(r._canceled)return;const u=r._textDivs,w=r._capability;if(u.length>y){w.resolve();return}if(!r._isReadableStream)for(const I of u)r._layoutText(I);w.resolve()}class n{constructor({textContentSource:u,container:w,viewport:A,textDivs:I,textDivProperties:k,textContentItemsStr:M,isOffscreenCanvasSupported:z}){this._textContentSource=u,this._isReadableStream=u instanceof ReadableStream,this._container=this._rootContainer=w,this._textDivs=I||[],this._textContentItemsStr=M||[],this._isOffscreenCanvasSupported=z,this._fontInspectorEnabled=!!globalThis.FontInspector?.enabled,this._reader=null,this._textDivProperties=k||new WeakMap,this._canceled=!1,this._capability=new l.PromiseCapability,this._layoutTextParams={prevFontSize:null,prevFontFamily:null,div:null,scale:A.scale*(globalThis.devicePixelRatio||1),properties:null,ctx:v(0,z)};const{pageWidth:G,pageHeight:X,pageX:q,pageY:et}=A.rawDims;this._transform=[1,0,0,-1,-q,et+X],this._pageWidth=G,this._pageHeight=X,(0,D.setLayerDimensions)(w,A),this._capability.promise.finally(()=>{this._layoutTextParams=null}).catch(()=>{})}get promise(){return this._capability.promise}cancel(){this._canceled=!0,this._reader&&(this._reader.cancel(new l.AbortException("TextLayer task cancelled.")).catch(()=>{}),this._reader=null),this._capability.reject(new l.AbortException("TextLayer task cancelled."))}_processItems(u,w){for(const A of u){if(A.str===void 0){if(A.type==="beginMarkedContentProps"||A.type==="beginMarkedContent"){const I=this._container;this._container=document.createElement("span"),this._container.classList.add("markedContent"),A.id!==null&&this._container.setAttribute("id",`${A.id}`),I.append(this._container)}else A.type==="endMarkedContent"&&(this._container=this._container.parentNode);continue}this._textContentItemsStr.push(A.str),o(this,A,w)}}_layoutText(u){const w=this._layoutTextParams.properties=this._textDivProperties.get(u);if(this._layoutTextParams.div=u,c(this._layoutTextParams),w.hasText&&this._container.append(u),w.hasEOL){const A=document.createElement("br");A.setAttribute("role","presentation"),this._container.append(A)}}_render(){const u=new l.PromiseCapability;let w=Object.create(null);if(this._isReadableStream){const A=()=>{this._reader.read().then(({value:I,done:k})=>{if(k){u.resolve();return}Object.assign(w,I.styles),this._processItems(I.items,w),A()},u.reject)};this._reader=this._textContentSource.getReader(),A()}else if(this._textContentSource){const{items:A,styles:I}=this._textContentSource;this._processItems(A,I),u.resolve()}else throw new Error('No "textContentSource" parameter specified.');u.promise.then(()=>{w=null,p(this)},this._capability.reject)}}function m(r){const u=new n(r);return u._render(),u}function e({container:r,viewport:u,textDivs:w,textDivProperties:A,isOffscreenCanvasSupported:I,mustRotate:k=!0,mustRescale:M=!0}){if(k&&(0,D.setLayerDimensions)(r,{rotation:u.rotation}),M){const z=v(0,I),X={prevFontSize:null,prevFontFamily:null,div:null,scale:u.scale*(globalThis.devicePixelRatio||1),properties:null,ctx:z};for(const q of w)X.properties=A.get(q),X.div=q,c(X)}}},92:(L,C,x)=>{x.d(C,{PDFDataTransportStream:()=>y});var l=x(266),D=x(473);class y{constructor({length:v,initialData:g,progressiveDone:o=!1,contentDispositionFilename:c=null,disableRange:p=!1,disableStream:n=!1},m){if((0,l.assert)(m,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.'),this._queuedChunks=[],this._progressiveDone=o,this._contentDispositionFilename=c,g?.length>0){const e=g instanceof Uint8Array&&g.byteLength===g.buffer.byteLength?g.buffer:new Uint8Array(g).buffer;this._queuedChunks.push(e)}this._pdfDataRangeTransport=m,this._isStreamingSupported=!n,this._isRangeSupported=!p,this._contentLength=v,this._fullRequestReader=null,this._rangeReaders=[],this._pdfDataRangeTransport.addRangeListener((e,r)=>{this._onReceiveData({begin:e,chunk:r})}),this._pdfDataRangeTransport.addProgressListener((e,r)=>{this._onProgress({loaded:e,total:r})}),this._pdfDataRangeTransport.addProgressiveReadListener(e=>{this._onReceiveData({chunk:e})}),this._pdfDataRangeTransport.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),this._pdfDataRangeTransport.transportReady()}_onReceiveData({begin:v,chunk:g}){const o=g instanceof Uint8Array&&g.byteLength===g.buffer.byteLength?g.buffer:new Uint8Array(g).buffer;if(v===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(o):this._queuedChunks.push(o);else{const c=this._rangeReaders.some(function(p){return p._begin!==v?!1:(p._enqueue(o),!0)});(0,l.assert)(c,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}_onProgress(v){v.total===void 0?this._rangeReaders[0]?.onProgress?.({loaded:v.loaded}):this._fullRequestReader?.onProgress?.({loaded:v.loaded,total:v.total})}_onProgressiveDone(){this._fullRequestReader?.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(v){const g=this._rangeReaders.indexOf(v);g>=0&&this._rangeReaders.splice(g,1)}getFullReader(){(0,l.assert)(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const v=this._queuedChunks;return this._queuedChunks=null,new P(this,v,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(v,g){if(g<=this._progressiveDataLength)return null;const o=new E(this,v,g);return this._pdfDataRangeTransport.requestDataRange(v,g),this._rangeReaders.push(o),o}cancelAllRequests(v){this._fullRequestReader?.cancel(v);for(const g of this._rangeReaders.slice(0))g.cancel(v);this._pdfDataRangeTransport.abort()}}class P{constructor(v,g,o=!1,c=null){this._stream=v,this._done=o||!1,this._filename=(0,D.isPdfFile)(c)?c:null,this._queuedChunks=g||[],this._loaded=0;for(const p of this._queuedChunks)this._loaded+=p.byteLength;this._requests=[],this._headersReady=Promise.resolve(),v._fullRequestReader=this,this.onProgress=null}_enqueue(v){this._done||(this._requests.length>0?this._requests.shift().resolve({value:v,done:!1}):this._queuedChunks.push(v),this._loaded+=v.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const v=new l.PromiseCapability;return this._requests.push(v),v.promise}cancel(v){this._done=!0;for(const g of this._requests)g.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class E{constructor(v,g,o){this._stream=v,this._begin=g,this._end=o,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(v){if(!this._done){if(this._requests.length===0)this._queuedChunk=v;else{this._requests.shift().resolve({value:v,done:!1});for(const o of this._requests)o.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const g=this._queuedChunk;return this._queuedChunk=null,{value:g,done:!1}}if(this._done)return{value:void 0,done:!0};const v=new l.PromiseCapability;return this._requests.push(v),v.promise}cancel(v){this._done=!0;for(const g of this._requests)g.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}},368:(L,C,x)=>{x.d(C,{GlobalWorkerOptions:()=>l});const l=Object.create(null);l.workerPort=null,l.workerSrc=""},160:(L,C,x)=>{x.d(C,{XfaLayer:()=>D});var l=x(521);class D{static setupStorage(P,E,T,v,g){const o=v.getValue(E,{value:null});switch(T.name){case"textarea":if(o.value!==null&&(P.textContent=o.value),g==="print")break;P.addEventListener("input",c=>{v.setValue(E,{value:c.target.value})});break;case"input":if(T.attributes.type==="radio"||T.attributes.type==="checkbox"){if(o.value===T.attributes.xfaOn?P.setAttribute("checked",!0):o.value===T.attributes.xfaOff&&P.removeAttribute("checked"),g==="print")break;P.addEventListener("change",c=>{v.setValue(E,{value:c.target.checked?c.target.getAttribute("xfaOn"):c.target.getAttribute("xfaOff")})})}else{if(o.value!==null&&P.setAttribute("value",o.value),g==="print")break;P.addEventListener("input",c=>{v.setValue(E,{value:c.target.value})})}break;case"select":if(o.value!==null){P.setAttribute("value",o.value);for(const c of T.children)c.attributes.value===o.value?c.attributes.selected=!0:c.attributes.hasOwnProperty("selected")&&delete c.attributes.selected}P.addEventListener("input",c=>{const p=c.target.options,n=p.selectedIndex===-1?"":p[p.selectedIndex].value;v.setValue(E,{value:n})});break}}static setAttributes({html:P,element:E,storage:T=null,intent:v,linkService:g}){const{attributes:o}=E,c=P instanceof HTMLAnchorElement;o.type==="radio"&&(o.name=`${o.name}-${v}`);for(const[p,n]of Object.entries(o))if(n!=null)switch(p){case"class":n.length&&P.setAttribute(p,n.join(" "));break;case"dataId":break;case"id":P.setAttribute("data-element-id",n);break;case"style":Object.assign(P.style,n);break;case"textContent":P.textContent=n;break;default:(!c||p!=="href"&&p!=="newWindow")&&P.setAttribute(p,n)}c&&g.addLinkAttributes(P,o.href,o.newWindow),T&&o.dataId&&this.setupStorage(P,o.dataId,E,T)}static render(P){const E=P.annotationStorage,T=P.linkService,v=P.xfaHtml,g=P.intent||"display",o=document.createElement(v.name);v.attributes&&this.setAttributes({html:o,element:v,intent:g,linkService:T});const c=g!=="richText",p=P.div;if(p.append(o),P.viewport){const e=`matrix(${P.viewport.transform.join(",")})`;p.style.transform=e}c&&p.setAttribute("class","xfaLayer xfaFont");const n=[];if(v.children.length===0){if(v.value){const e=document.createTextNode(v.value);o.append(e),c&&l.XfaText.shouldBuildText(v.name)&&n.push(e)}return{textDivs:n}}const m=[[v,-1,o]];for(;m.length>0;){const[e,r,u]=m.at(-1);if(r+1===e.children.length){m.pop();continue}const w=e.children[++m.at(-1)[1]];if(w===null)continue;const{name:A}=w;if(A==="#text"){const k=document.createTextNode(w.value);n.push(k),u.append(k);continue}const I=w?.attributes?.xmlns?document.createElementNS(w.attributes.xmlns,A):document.createElement(A);if(u.append(I),w.attributes&&this.setAttributes({html:I,element:w,storage:E,intent:g,linkService:T}),w.children?.length>0)m.push([w,-1,I]);else if(w.value){const k=document.createTextNode(w.value);c&&l.XfaText.shouldBuildText(A)&&n.push(k),I.append(k)}}for(const e of p.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))e.setAttribute("readOnly",!0);return{textDivs:n}}static update(P){const E=`matrix(${P.viewport.transform.join(",")})`;P.div.style.transform=E,P.div.hidden=!1}}},521:(L,C,x)=>{x.d(C,{XfaText:()=>l});class l{static textContent(y){const P=[],E={items:P,styles:Object.create(null)};function T(v){if(!v)return;let g=null;const o=v.name;if(o==="#text")g=v.value;else if(l.shouldBuildText(o))v?.attributes?.textContent?g=v.attributes.textContent:v.value&&(g=v.value);else return;if(g!==null&&P.push({str:g}),!!v.children)for(const c of v.children)T(c)}return T(y),E}static shouldBuildText(y){return!(y==="textarea"||y==="input"||y==="option"||y==="select")}}},907:(L,C,x)=>{x.a(L,async(l,D)=>{try{x.d(C,{AbortException:()=>y.AbortException,AnnotationEditorLayer:()=>v.AnnotationEditorLayer,AnnotationEditorParamsType:()=>y.AnnotationEditorParamsType,AnnotationEditorType:()=>y.AnnotationEditorType,AnnotationEditorUIManager:()=>g.AnnotationEditorUIManager,AnnotationLayer:()=>o.AnnotationLayer,AnnotationMode:()=>y.AnnotationMode,CMapCompressionType:()=>y.CMapCompressionType,ColorPicker:()=>c.ColorPicker,DOMSVGFactory:()=>E.DOMSVGFactory,DrawLayer:()=>p.DrawLayer,FeatureTest:()=>y.FeatureTest,GlobalWorkerOptions:()=>n.GlobalWorkerOptions,ImageKind:()=>y.ImageKind,InvalidPDFException:()=>y.InvalidPDFException,MissingPDFException:()=>y.MissingPDFException,OPS:()=>y.OPS,Outliner:()=>m.Outliner,PDFDataRangeTransport:()=>P.PDFDataRangeTransport,PDFDateString:()=>E.PDFDateString,PDFWorker:()=>P.PDFWorker,PasswordResponses:()=>y.PasswordResponses,PermissionFlag:()=>y.PermissionFlag,PixelsPerInch:()=>E.PixelsPerInch,PromiseCapability:()=>y.PromiseCapability,RenderingCancelledException:()=>E.RenderingCancelledException,UnexpectedResponseException:()=>y.UnexpectedResponseException,Util:()=>y.Util,VerbosityLevel:()=>y.VerbosityLevel,XfaLayer:()=>e.XfaLayer,build:()=>P.build,createValidAbsoluteUrl:()=>y.createValidAbsoluteUrl,fetchData:()=>E.fetchData,getDocument:()=>P.getDocument,getFilenameFromUrl:()=>E.getFilenameFromUrl,getPdfFilenameFromUrl:()=>E.getPdfFilenameFromUrl,getXfaPageViewport:()=>E.getXfaPageViewport,isDataScheme:()=>E.isDataScheme,isPdfFile:()=>E.isPdfFile,noContextMenu:()=>E.noContextMenu,normalizeUnicode:()=>y.normalizeUnicode,renderTextLayer:()=>T.renderTextLayer,setLayerDimensions:()=>E.setLayerDimensions,shadow:()=>y.shadow,updateTextLayer:()=>T.updateTextLayer,version:()=>P.version});var y=x(266),P=x(406),E=x(473),T=x(739),v=x(629),g=x(812),o=x(640),c=x(97),p=x(423),n=x(368),m=x(405),e=x(160),r=l([P]);P=(r.then?(await r)():r)[0];const u="4.0.379",w="9e14d04fd";D()}catch(u){D(u)}})},694:(L,C,x)=>{x.d(C,{MessageHandler:()=>E});var l=x(266);const D={UNKNOWN:0,DATA:1,ERROR:2},y={UNKNOWN:0,CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function P(T){switch(T instanceof Error||typeof T=="object"&&T!==null||(0,l.unreachable)('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),T.name){case"AbortException":return new l.AbortException(T.message);case"MissingPDFException":return new l.MissingPDFException(T.message);case"PasswordException":return new l.PasswordException(T.message,T.code);case"UnexpectedResponseException":return new l.UnexpectedResponseException(T.message,T.status);case"UnknownErrorException":return new l.UnknownErrorException(T.message,T.details);default:return new l.UnknownErrorException(T.message,T.toString())}}class E{constructor(v,g,o){this.sourceName=v,this.targetName=g,this.comObj=o,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),this._onComObjOnMessage=c=>{const p=c.data;if(p.targetName!==this.sourceName)return;if(p.stream){this.#e(p);return}if(p.callback){const m=p.callbackId,e=this.callbackCapabilities[m];if(!e)throw new Error(`Cannot resolve callback ${m}`);if(delete this.callbackCapabilities[m],p.callback===D.DATA)e.resolve(p.data);else if(p.callback===D.ERROR)e.reject(P(p.reason));else throw new Error("Unexpected callback case");return}const n=this.actionHandler[p.action];if(!n)throw new Error(`Unknown action from worker: ${p.action}`);if(p.callbackId){const m=this.sourceName,e=p.sourceName;new Promise(function(r){r(n(p.data))}).then(function(r){o.postMessage({sourceName:m,targetName:e,callback:D.DATA,callbackId:p.callbackId,data:r})},function(r){o.postMessage({sourceName:m,targetName:e,callback:D.ERROR,callbackId:p.callbackId,reason:P(r)})});return}if(p.streamId){this.#t(p);return}n(p.data)},o.addEventListener("message",this._onComObjOnMessage)}on(v,g){const o=this.actionHandler;if(o[v])throw new Error(`There is already an actionName called "${v}"`);o[v]=g}send(v,g,o){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:v,data:g},o)}sendWithPromise(v,g,o){const c=this.callbackId++,p=new l.PromiseCapability;this.callbackCapabilities[c]=p;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:v,callbackId:c,data:g},o)}catch(n){p.reject(n)}return p.promise}sendWithStream(v,g,o,c){const p=this.streamId++,n=this.sourceName,m=this.targetName,e=this.comObj;return new ReadableStream({start:r=>{const u=new l.PromiseCapability;return this.streamControllers[p]={controller:r,startCall:u,pullCall:null,cancelCall:null,isClosed:!1},e.postMessage({sourceName:n,targetName:m,action:v,streamId:p,data:g,desiredSize:r.desiredSize},c),u.promise},pull:r=>{const u=new l.PromiseCapability;return this.streamControllers[p].pullCall=u,e.postMessage({sourceName:n,targetName:m,stream:y.PULL,streamId:p,desiredSize:r.desiredSize}),u.promise},cancel:r=>{(0,l.assert)(r instanceof Error,"cancel must have a valid reason");const u=new l.PromiseCapability;return this.streamControllers[p].cancelCall=u,this.streamControllers[p].isClosed=!0,e.postMessage({sourceName:n,targetName:m,stream:y.CANCEL,streamId:p,reason:P(r)}),u.promise}},o)}#t(v){const g=v.streamId,o=this.sourceName,c=v.sourceName,p=this.comObj,n=this,m=this.actionHandler[v.action],e={enqueue(r,u=1,w){if(this.isCancelled)return;const A=this.desiredSize;this.desiredSize-=u,A>0&&this.desiredSize<=0&&(this.sinkCapability=new l.PromiseCapability,this.ready=this.sinkCapability.promise),p.postMessage({sourceName:o,targetName:c,stream:y.ENQUEUE,streamId:g,chunk:r},w)},close(){this.isCancelled||(this.isCancelled=!0,p.postMessage({sourceName:o,targetName:c,stream:y.CLOSE,streamId:g}),delete n.streamSinks[g])},error(r){(0,l.assert)(r instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,p.postMessage({sourceName:o,targetName:c,stream:y.ERROR,streamId:g,reason:P(r)}))},sinkCapability:new l.PromiseCapability,onPull:null,onCancel:null,isCancelled:!1,desiredSize:v.desiredSize,ready:null};e.sinkCapability.resolve(),e.ready=e.sinkCapability.promise,this.streamSinks[g]=e,new Promise(function(r){r(m(v.data,e))}).then(function(){p.postMessage({sourceName:o,targetName:c,stream:y.START_COMPLETE,streamId:g,success:!0})},function(r){p.postMessage({sourceName:o,targetName:c,stream:y.START_COMPLETE,streamId:g,reason:P(r)})})}#e(v){const g=v.streamId,o=this.sourceName,c=v.sourceName,p=this.comObj,n=this.streamControllers[g],m=this.streamSinks[g];switch(v.stream){case y.START_COMPLETE:v.success?n.startCall.resolve():n.startCall.reject(P(v.reason));break;case y.PULL_COMPLETE:v.success?n.pullCall.resolve():n.pullCall.reject(P(v.reason));break;case y.PULL:if(!m){p.postMessage({sourceName:o,targetName:c,stream:y.PULL_COMPLETE,streamId:g,success:!0});break}m.desiredSize<=0&&v.desiredSize>0&&m.sinkCapability.resolve(),m.desiredSize=v.desiredSize,new Promise(function(e){e(m.onPull?.())}).then(function(){p.postMessage({sourceName:o,targetName:c,stream:y.PULL_COMPLETE,streamId:g,success:!0})},function(e){p.postMessage({sourceName:o,targetName:c,stream:y.PULL_COMPLETE,streamId:g,reason:P(e)})});break;case y.ENQUEUE:if((0,l.assert)(n,"enqueue should have stream controller"),n.isClosed)break;n.controller.enqueue(v.chunk);break;case y.CLOSE:if((0,l.assert)(n,"close should have stream controller"),n.isClosed)break;n.isClosed=!0,n.controller.close(),this.#s(n,g);break;case y.ERROR:(0,l.assert)(n,"error should have stream controller"),n.controller.error(P(v.reason)),this.#s(n,g);break;case y.CANCEL_COMPLETE:v.success?n.cancelCall.resolve():n.cancelCall.reject(P(v.reason)),this.#s(n,g);break;case y.CANCEL:if(!m)break;new Promise(function(e){e(m.onCancel?.(P(v.reason)))}).then(function(){p.postMessage({sourceName:o,targetName:c,stream:y.CANCEL_COMPLETE,streamId:g,success:!0})},function(e){p.postMessage({sourceName:o,targetName:c,stream:y.CANCEL_COMPLETE,streamId:g,reason:P(e)})}),m.sinkCapability.reject(P(v.reason)),m.isCancelled=!0,delete this.streamSinks[g];break;default:throw new Error("Unexpected stream case")}}async#s(v,g){await Promise.allSettled([v.startCall?.promise,v.pullCall?.promise,v.cancelCall?.promise]),delete this.streamControllers[g]}destroy(){this.comObj.removeEventListener("message",this._onComObjOnMessage)}}},825:(L,C,x)=>{x.d(C,{MurmurHash3_64:()=>E});var l=x(266);const D=3285377520,y=4294901760,P=65535;class E{constructor(v){this.h1=v?v&4294967295:D,this.h2=v?v&4294967295:D}update(v){let g,o;if(typeof v=="string"){g=new Uint8Array(v.length*2),o=0;for(let M=0,z=v.length;M<z;M++){const G=v.charCodeAt(M);G<=255?g[o++]=G:(g[o++]=G>>>8,g[o++]=G&255)}}else if((0,l.isArrayBuffer)(v))g=v.slice(),o=g.byteLength;else throw new Error("Wrong data format in MurmurHash3_64_update. Input must be a string or array.");const c=o>>2,p=o-c*4,n=new Uint32Array(g.buffer,0,c);let m=0,e=0,r=this.h1,u=this.h2;const w=3432918353,A=461845907,I=w&P,k=A&P;for(let M=0;M<c;M++)M&1?(m=n[M],m=m*w&y|m*I&P,m=m<<15|m>>>17,m=m*A&y|m*k&P,r^=m,r=r<<13|r>>>19,r=r*5+3864292196):(e=n[M],e=e*w&y|e*I&P,e=e<<15|e>>>17,e=e*A&y|e*k&P,u^=e,u=u<<13|u>>>19,u=u*5+3864292196);switch(m=0,p){case 3:m^=g[c*4+2]<<16;case 2:m^=g[c*4+1]<<8;case 1:m^=g[c*4],m=m*w&y|m*I&P,m=m<<15|m>>>17,m=m*A&y|m*k&P,c&1?r^=m:u^=m}this.h1=r,this.h2=u}hexdigest(){let v=this.h1,g=this.h2;return v^=g>>>1,v=v*3981806797&y|v*36045&P,g=g*4283543511&y|((g<<16|v>>>16)*2950163797&y)>>>16,v^=g>>>1,v=v*444984403&y|v*60499&P,g=g*3301882366&y|((g<<16|v>>>16)*3120437893&y)>>>16,v^=g>>>1,(v>>>0).toString(16).padStart(8,"0")+(g>>>0).toString(16).padStart(8,"0")}}},266:(L,C,x)=>{x.d(C,{AbortException:()=>gt,AnnotationBorderStyleType:()=>r,AnnotationEditorParamsType:()=>c,AnnotationEditorPrefix:()=>g,AnnotationEditorType:()=>o,AnnotationMode:()=>v,AnnotationPrefix:()=>V,AnnotationType:()=>e,BaseException:()=>U,CMapCompressionType:()=>w,FONT_IDENTITY_MATRIX:()=>y,FeatureTest:()=>t,FormatError:()=>ot,IDENTITY_MATRIX:()=>D,ImageKind:()=>m,InvalidPDFException:()=>tt,LINE_FACTOR:()=>E,MAX_IMAGE_SIZE_TO_CACHE:()=>P,MissingPDFException:()=>ft,OPS:()=>A,PasswordException:()=>J,PasswordResponses:()=>I,PermissionFlag:()=>p,PromiseCapability:()=>S,RenderingIntentFlag:()=>T,TextRenderingMode:()=>n,UnexpectedResponseException:()=>lt,UnknownErrorException:()=>Z,Util:()=>a,VerbosityLevel:()=>u,assert:()=>et,bytesToString:()=>dt,createValidAbsoluteUrl:()=>W,getUuid:()=>H,getVerbosityLevel:()=>z,info:()=>G,isArrayBuffer:()=>b,isNodeJS:()=>l,normalizeUnicode:()=>N,objectFromMap:()=>f,setVerbosityLevel:()=>M,shadow:()=>$,string32:()=>K,stringToBytes:()=>ct,unreachable:()=>q,warn:()=>X});const l=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser"),D=[1,0,0,1,0,0],y=[.001,0,0,.001,0,0],P=1e7,E=1.35,T={ANY:1,DISPLAY:2,PRINT:4,SAVE:8,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,OPLIST:256},v={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},g="pdfjs_internal_editor_",o={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15},c={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_DEFAULT_COLOR:32},p={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},n={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_ADD_TO_PATH:4,STROKE_ADD_TO_PATH:5,FILL_STROKE_ADD_TO_PATH:6,ADD_TO_PATH:7,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},m={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},e={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26},r={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5},u={ERRORS:0,WARNINGS:1,INFOS:5},w={NONE:0,BINARY:1},A={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91},I={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};let k=u.WARNINGS;function M(B){Number.isInteger(B)&&(k=B)}function z(){return k}function G(B){k>=u.INFOS&&console.log(`Info: ${B}`)}function X(B){k>=u.WARNINGS&&console.log(`Warning: ${B}`)}function q(B){throw new Error(B)}function et(B,F){B||q(F)}function at(B){switch(B?.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function W(B,F=null,O=null){if(!B)return null;try{if(O&&typeof B=="string"&&(O.addDefaultProtocol&&B.startsWith("www.")&&B.match(/\./g)?.length>=2&&(B=`http://${B}`),O.tryConvertEncoding))try{B=d(B)}catch{}const Y=F?new URL(B,F):new URL(B);if(at(Y))return Y}catch{}return null}function $(B,F,O,Y=!1){return Object.defineProperty(B,F,{value:O,enumerable:!Y,configurable:!0,writable:!1}),O}const U=function(){function F(O,Y){this.constructor===F&&q("Cannot initialize BaseException."),this.message=O,this.name=Y}return F.prototype=new Error,F.constructor=F,F}();class J extends U{constructor(F,O){super(F,"PasswordException"),this.code=O}}class Z extends U{constructor(F,O){super(F,"UnknownErrorException"),this.details=O}}class tt extends U{constructor(F){super(F,"InvalidPDFException")}}class ft extends U{constructor(F){super(F,"MissingPDFException")}}class lt extends U{constructor(F,O){super(F,"UnexpectedResponseException"),this.status=O}}class ot extends U{constructor(F){super(F,"FormatError")}}class gt extends U{constructor(F){super(F,"AbortException")}}function dt(B){(typeof B!="object"||B?.length===void 0)&&q("Invalid argument for bytesToString");const F=B.length,O=8192;if(F<O)return String.fromCharCode.apply(null,B);const Y=[];for(let j=0;j<F;j+=O){const Q=Math.min(j+O,F),st=B.subarray(j,Q);Y.push(String.fromCharCode.apply(null,st))}return Y.join("")}function ct(B){typeof B!="string"&&q("Invalid argument for stringToBytes");const F=B.length,O=new Uint8Array(F);for(let Y=0;Y<F;++Y)O[Y]=B.charCodeAt(Y)&255;return O}function K(B){return String.fromCharCode(B>>24&255,B>>16&255,B>>8&255,B&255)}function f(B){const F=Object.create(null);for(const[O,Y]of B)F[O]=Y;return F}function h(){const B=new Uint8Array(4);return B[0]=1,new Uint32Array(B.buffer,0,1)[0]===1}function s(){try{return new Function(""),!0}catch{return!1}}class t{static get isLittleEndian(){return $(this,"isLittleEndian",h())}static get isEvalSupported(){return $(this,"isEvalSupported",s())}static get isOffscreenCanvasSupported(){return $(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get platform(){return typeof navigator<"u"&&typeof navigator?.platform=="string"?$(this,"platform",{isMac:navigator.platform.includes("Mac")}):$(this,"platform",{isMac:!1})}static get isCSSRoundSupported(){return $(this,"isCSSRoundSupported",globalThis.CSS?.supports?.("width: round(1.5px, 1px)"))}}const i=[...Array(256).keys()].map(B=>B.toString(16).padStart(2,"0"));class a{static makeHexColor(F,O,Y){return`#${i[F]}${i[O]}${i[Y]}`}static scaleMinMax(F,O){let Y;F[0]?(F[0]<0&&(Y=O[0],O[0]=O[1],O[1]=Y),O[0]*=F[0],O[1]*=F[0],F[3]<0&&(Y=O[2],O[2]=O[3],O[3]=Y),O[2]*=F[3],O[3]*=F[3]):(Y=O[0],O[0]=O[2],O[2]=Y,Y=O[1],O[1]=O[3],O[3]=Y,F[1]<0&&(Y=O[2],O[2]=O[3],O[3]=Y),O[2]*=F[1],O[3]*=F[1],F[2]<0&&(Y=O[0],O[0]=O[1],O[1]=Y),O[0]*=F[2],O[1]*=F[2]),O[0]+=F[4],O[1]+=F[4],O[2]+=F[5],O[3]+=F[5]}static transform(F,O){return[F[0]*O[0]+F[2]*O[1],F[1]*O[0]+F[3]*O[1],F[0]*O[2]+F[2]*O[3],F[1]*O[2]+F[3]*O[3],F[0]*O[4]+F[2]*O[5]+F[4],F[1]*O[4]+F[3]*O[5]+F[5]]}static applyTransform(F,O){const Y=F[0]*O[0]+F[1]*O[2]+O[4],j=F[0]*O[1]+F[1]*O[3]+O[5];return[Y,j]}static applyInverseTransform(F,O){const Y=O[0]*O[3]-O[1]*O[2],j=(F[0]*O[3]-F[1]*O[2]+O[2]*O[5]-O[4]*O[3])/Y,Q=(-F[0]*O[1]+F[1]*O[0]+O[4]*O[1]-O[5]*O[0])/Y;return[j,Q]}static getAxialAlignedBoundingBox(F,O){const Y=this.applyTransform(F,O),j=this.applyTransform(F.slice(2,4),O),Q=this.applyTransform([F[0],F[3]],O),st=this.applyTransform([F[2],F[1]],O);return[Math.min(Y[0],j[0],Q[0],st[0]),Math.min(Y[1],j[1],Q[1],st[1]),Math.max(Y[0],j[0],Q[0],st[0]),Math.max(Y[1],j[1],Q[1],st[1])]}static inverseTransform(F){const O=F[0]*F[3]-F[1]*F[2];return[F[3]/O,-F[1]/O,-F[2]/O,F[0]/O,(F[2]*F[5]-F[4]*F[3])/O,(F[4]*F[1]-F[5]*F[0])/O]}static singularValueDecompose2dScale(F){const O=[F[0],F[2],F[1],F[3]],Y=F[0]*O[0]+F[1]*O[2],j=F[0]*O[1]+F[1]*O[3],Q=F[2]*O[0]+F[3]*O[2],st=F[2]*O[1]+F[3]*O[3],it=(Y+st)/2,rt=Math.sqrt((Y+st)**2-4*(Y*st-Q*j))/2,nt=it+rt||1,ht=it-rt||1;return[Math.sqrt(nt),Math.sqrt(ht)]}static normalizeRect(F){const O=F.slice(0);return F[0]>F[2]&&(O[0]=F[2],O[2]=F[0]),F[1]>F[3]&&(O[1]=F[3],O[3]=F[1]),O}static intersect(F,O){const Y=Math.max(Math.min(F[0],F[2]),Math.min(O[0],O[2])),j=Math.min(Math.max(F[0],F[2]),Math.max(O[0],O[2]));if(Y>j)return null;const Q=Math.max(Math.min(F[1],F[3]),Math.min(O[1],O[3])),st=Math.min(Math.max(F[1],F[3]),Math.max(O[1],O[3]));return Q>st?null:[Y,Q,j,st]}static bezierBoundingBox(F,O,Y,j,Q,st,it,rt){const nt=[],ht=[[],[]];let mt,At,St,pt,Mt,Ft,It,xt;for(let zt=0;zt<2;++zt){if(zt===0?(At=6*F-12*Y+6*Q,mt=-3*F+9*Y-9*Q+3*it,St=3*Y-3*F):(At=6*O-12*j+6*st,mt=-3*O+9*j-9*st+3*rt,St=3*j-3*O),Math.abs(mt)<1e-12){if(Math.abs(At)<1e-12)continue;pt=-St/At,0<pt&&pt<1&&nt.push(pt);continue}It=At*At-4*St*mt,xt=Math.sqrt(It),!(It<0)&&(Mt=(-At+xt)/(2*mt),0<Mt&&Mt<1&&nt.push(Mt),Ft=(-At-xt)/(2*mt),0<Ft&&Ft<1&&nt.push(Ft))}let Tt=nt.length,Ct;const _t=Tt;for(;Tt--;)pt=nt[Tt],Ct=1-pt,ht[0][Tt]=Ct*Ct*Ct*F+3*Ct*Ct*pt*Y+3*Ct*pt*pt*Q+pt*pt*pt*it,ht[1][Tt]=Ct*Ct*Ct*O+3*Ct*Ct*pt*j+3*Ct*pt*pt*st+pt*pt*pt*rt;return ht[0][_t]=F,ht[1][_t]=O,ht[0][_t+1]=it,ht[1][_t+1]=rt,ht[0].length=ht[1].length=_t+2,[Math.min(...ht[0]),Math.min(...ht[1]),Math.max(...ht[0]),Math.max(...ht[1])]}}function d(B){return decodeURIComponent(escape(B))}function b(B){return typeof B=="object"&&B?.byteLength!==void 0}class S{#t=!1;constructor(){this.promise=new Promise((F,O)=>{this.resolve=Y=>{this.#t=!0,F(Y)},this.reject=Y=>{this.#t=!0,O(Y)}})}get settled(){return this.#t}}let R=null,_=null;function N(B){return R||(R=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,_=new Map([["","t"]])),B.replaceAll(R,(F,O,Y)=>O?O.normalize("NFKC"):_.get(Y))}function H(){if(typeof crypto<"u"&&typeof crypto?.randomUUID=="function")return crypto.randomUUID();const B=new Uint8Array(32);if(typeof crypto<"u"&&typeof crypto?.getRandomValues=="function")crypto.getRandomValues(B);else for(let F=0;F<32;F++)B[F]=Math.floor(Math.random()*255);return dt(B)}const V="pdfjs_internal_id_"}},Pe={};function Ut(L){var C=Pe[L];if(C!==void 0)return C.exports;var x=Pe[L]={exports:{}};return As[L](x,x.exports,Ut),x.exports}(()=>{var L=typeof Symbol=="function"?Symbol("webpack queues"):"__webpack_queues__",C=typeof Symbol=="function"?Symbol("webpack exports"):"__webpack_exports__",x=typeof Symbol=="function"?Symbol("webpack error"):"__webpack_error__",l=y=>{y&&y.d<1&&(y.d=1,y.forEach(P=>P.r--),y.forEach(P=>P.r--?P.r++:P()))},D=y=>y.map(P=>{if(P!==null&&typeof P=="object"){if(P[L])return P;if(P.then){var E=[];E.d=0,P.then(g=>{T[C]=g,l(E)},g=>{T[x]=g,l(E)});var T={};return T[L]=g=>g(E),T}}var v={};return v[L]=g=>{},v[C]=P,v});Ut.a=(y,P,E)=>{var T;E&&((T=[]).d=-1);var v=new Set,g=y.exports,o,c,p,n=new Promise((m,e)=>{p=e,c=m});n[C]=g,n[L]=m=>(T&&m(T),v.forEach(m),n.catch(e=>{})),y.exports=n,P(m=>{o=D(m);var e,r=()=>o.map(w=>{if(w[x])throw w[x];return w[C]}),u=new Promise(w=>{e=()=>w(r),e.r=0;var A=I=>I!==T&&!v.has(I)&&(v.add(I),I&&!I.d&&(e.r++,I.push(e)));o.map(I=>I[L](A))});return e.r?u:r()},m=>(m?p(n[x]=m):c(g),l(T))),T&&T.d<0&&(T.d=0)}})();Ut.d=(L,C)=>{for(var x in C)Ut.o(C,x)&&!Ut.o(L,x)&&Object.defineProperty(L,x,{enumerable:!0,get:C[x]})};Ut.o=(L,C)=>Object.prototype.hasOwnProperty.call(L,C);var ut=Ut(907);ut=globalThis.pdfjsLib=await(globalThis.pdfjsLibPromise=ut);ut.AbortException;ut.AnnotationEditorLayer;ut.AnnotationEditorParamsType;ut.AnnotationEditorType;ut.AnnotationEditorUIManager;ut.AnnotationLayer;ut.AnnotationMode;ut.CMapCompressionType;ut.ColorPicker;ut.DOMSVGFactory;ut.DrawLayer;ut.FeatureTest;var vs=ut.GlobalWorkerOptions;ut.ImageKind;ut.InvalidPDFException;ut.MissingPDFException;ut.OPS;ut.Outliner;ut.PDFDataRangeTransport;ut.PDFDateString;ut.PDFWorker;ut.PasswordResponses;ut.PermissionFlag;ut.PixelsPerInch;ut.PromiseCapability;ut.RenderingCancelledException;ut.UnexpectedResponseException;ut.Util;ut.VerbosityLevel;ut.XfaLayer;ut.build;ut.createValidAbsoluteUrl;ut.fetchData;var ys=ut.getDocument;ut.getFilenameFromUrl;ut.getPdfFilenameFromUrl;ut.getXfaPageViewport;ut.isDataScheme;ut.isPdfFile;ut.noContextMenu;ut.normalizeUnicode;ut.renderTextLayer;ut.setLayerDimensions;ut.shadow;ut.updateTextLayer;ut.version;function Le(L,C,x){const l=L.slice();return l[8]=C[x],l[10]=x,l}function ws(L){let C,x=L[11]+"",l;return{c(){C=Lt("Error: "),l=Lt(x)},m(D,y){kt(D,C,y),kt(D,l,y)},p:vt,i:vt,o:vt,d(D){D&&(Et(C),Et(l))}}}function Ss(L){let C,x,l,D,y,P=L[0].length+"",E,T,v,g,o,c,p,n,m,e,r,u,w=oe(Array(L[7].numPages)),A=[];for(let k=0;k<w.length;k+=1)A[k]=Me(Le(L,w,k));const I=k=>Xt(A[k],1,1,()=>{A[k]=null});return{c(){C=wt("p"),x=Lt("This document has "),l=wt("strong"),l.textContent=`${L[7].numPages} pages`,D=Lt(` and the elections has
            `),y=wt("strong"),E=Lt(P),T=Lt(" ballots"),v=Lt("."),g=Nt(),o=wt("p"),o.innerHTML="Note: only mark the <em>first</em> page for each ballot. Continuation pages will get detected automatically.",c=Nt();for(let k=0;k<A.length;k+=1)A[k].c();p=Nt(),n=wt("form"),m=wt("input"),e=Nt(),r=wt("button"),r.textContent="Save",yt(m,"type","hidden"),yt(m,"name","matched_pages"),yt(m,"id","matched_pages"),m.value=L[2],yt(r,"type","submit"),yt(r,"class","ds-button"),yt(n,"method","post")},m(k,M){kt(k,C,M),bt(C,x),bt(C,l),bt(C,D),bt(C,y),bt(y,E),bt(y,T),bt(C,v),kt(k,g,M),kt(k,o,M),kt(k,c,M);for(let z=0;z<A.length;z+=1)A[z]&&A[z].m(k,M);kt(k,p,M),kt(k,n,M),bt(n,m),bt(n,e),bt(n,r),u=!0},p(k,M){if((!u||M&1)&&P!==(P=k[0].length+"")&&ae(E,P),M&8){w=oe(Array(k[7].numPages));let z;for(z=0;z<w.length;z+=1){const G=Le(k,w,z);A[z]?(A[z].p(G,M),Ot(A[z],1)):(A[z]=Me(G),A[z].c(),Ot(A[z],1),A[z].m(p.parentNode,p))}for(Ne(),z=w.length;z<A.length;z+=1)I(z);Oe()}(!u||M&4)&&(m.value=k[2])},i(k){if(!u){for(let M=0;M<w.length;M+=1)Ot(A[M]);u=!0}},o(k){A=A.filter(Boolean);for(let M=0;M<A.length;M+=1)Xt(A[M]);u=!1},d(k){k&&(Et(C),Et(g),Et(o),Et(c),Et(p),Et(n)),Xe(A,k)}}}function Me(L){let C,x;return C=new gs({props:{page:L[7].getPage(L[10]+1),page_number:L[10],total_pages:L[7].numPages}}),{c(){Be(C.$$.fragment)},m(l,D){Ae(C,l,D),x=!0},p:vt,i(l){x||(Ot(C.$$.fragment,l),x=!0)},o(l){Xt(C.$$.fragment,l),x=!1},d(l){ve(C,l)}}}function xs(L){let C;return{c(){C=wt("p"),C.textContent="Loading PDF"},m(x,l){kt(x,C,l)},p:vt,i:vt,o:vt,d(x){x&&Et(C)}}}function Cs(L){let C,x,l={ctx:L,current:null,token:null,hasCatch:!0,pending:xs,then:Ss,catch:ws,value:7,error:11,blocks:[,,,]};return pe(L[3],l),{c(){C=wt("main"),l.block.c(),yt(C,"class","ds-stack")},m(D,y){kt(D,C,y),l.block.m(C,l.anchor=null),l.mount=()=>C,l.anchor=null,x=!0},p(D,[y]){L=D,He(l,L,y)},i(D){x||(Ot(l.block),x=!0)},o(D){for(let y=0;y<3;y+=1){const P=l.blocks[y];Xt(P)}x=!1},d(D){D&&Et(C),l.block.d(),l.token=null,l=null}}}function Es(L,C,x){let l,D,y=vt,P=()=>(y(),y=me(g,o=>x(2,D=o)),g);_e(L,Kt,o=>x(6,l=o)),L.$$.on_destroy.push(()=>y()),vs.workerSrc="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.0.379/pdf.worker.min.mjs";let{ballots:E}=C;Ge(Kt,l=E,l);let{sopn_pdf:T}=C;var v=ys(T).promise;const g=is(Kt,o=>JSON.stringify(o));return P(),L.$$set=o=>{"ballots"in o&&x(0,E=o.ballots),"sopn_pdf"in o&&x(4,T=o.sopn_pdf)},[E,g,D,v,T]}class Ts extends we{constructor(C){super(),ye(this,C,Es,Cs,le,{ballots:0,sopn_pdf:4,transformedBallotsStore:1})}get transformedBallotsStore(){return this.$$.ctx[1]}}var ks={sopn_pdf:"https://s3.eu-west-2.amazonaws.com/static-candidates.democracyclub.org.uk/media/official_documents/local.tandridge.2024-05-02/2024-04-05T18%3A23%3A03.267470%2B00%3A00/Statement_of_Persons_Nominated_Tandridge_District_2024.pdf",ballots:[{ballot_paper_id:"local.tandridge.bletchingley-nutfield.2024-05-02",label:"Bletchingley & Nutfield",matched:!0,matched_page:"0"},{ballot_paper_id:"local.tandridge.burstow-horne-outwood.2024-05-02",label:"Burstow, Horne & Outwood",matched:!0,matched_page:"1"},{ballot_paper_id:"local.tandridge.chaldon.2024-05-02",label:"Chaldon",matched:!0,matched_page:"2"},{ballot_paper_id:"local.tandridge.dormansland-felbridge.2024-05-02",label:"Dormansland & Felbridge",matched:!0,matched_page:"4"},{ballot_paper_id:"local.tandridge.godstone.2024-05-02",label:"Godstone",matched:!0,matched_page:"5"},{ballot_paper_id:"local.tandridge.harestone.2024-05-02",label:"Harestone",matched:!0,matched_page:"6"},{ballot_paper_id:"local.tandridge.limpsfield.2024-05-02",label:"Limpsfield",matched:!0,matched_page:"7"},{ballot_paper_id:"local.tandridge.lingfield-crowhurst.2024-05-02",label:"Lingfield & Crowhurst",matched:!0,matched_page:"8"},{ballot_paper_id:"local.tandridge.oxted-north.2024-05-02",label:"Oxted North",matched:!0,matched_page:"9"},{ballot_paper_id:"local.tandridge.oxted-south.2024-05-02",label:"Oxted South",matched:!0,matched_page:"10"},{ballot_paper_id:"local.tandridge.portley-queens-park.2024-05-02",label:"Portley & Queens Park"},{ballot_paper_id:"local.tandridge.tatsfield-titsey.2024-05-02",label:"Tatsfield & Titsey",matched:!0,matched_page:"3"},{ballot_paper_id:"local.tandridge.valley.2024-05-02",label:"Valley",matched:!0,matched_page:"12"},{ballot_paper_id:"local.tandridge.warlingham-east-chelsham-farleigh.2024-05-02",label:"Warlingham East & Chelsham & Farleigh",matched:!0,matched_page:"13"},{ballot_paper_id:"local.tandridge.warlingham-west.2024-05-02",label:"Warlingham West",matched:!0,matched_page:"14"},{ballot_paper_id:"local.tandridge.westway.2024-05-02",label:"Westway",matched:!0,matched_page:"15"},{ballot_paper_id:"local.tandridge.whyteleafe.2024-05-02",label:"Whyteleafe",matched:!0,matched_page:"16"},{ballot_paper_id:"local.tandridge.woldingham.2024-05-02",label:"Woldingham",matched:!0,matched_page:"17"}]},Ie=document.getElementById("sopn-matcher-index-props"),ge;Ie?ge=JSON.parse(Ie.textContent):ge=ks;new Ts({target:document.querySelector("#sopn-matcher-index-target"),props:ge});
