{% extends 'base.html' %}
{% load absolute %}

{% load metadescription %}
{% load standing %}
{% load exists %}

{% block extra_head %}
    <!-- Open Graph and Twitter card data -->
    <meta property="og:url" name="twitter:url" content="{{ request.build_absolute_uri }}" />
    <meta property="og:title" name="twitter:title" content="Candidates for {{ ballot.post.label }} in the {{ ballot.election.name }}" />
    <meta property="og:description" name="twitter:description" content="List of Candidates for {{ ballot.post.label }} in the {{ ballot.election.name }} - find out more on {{ site.name }}">

    <!-- Open Graph data -->
    <meta property="og:type" content="article" />
    <meta property="og:image" content="{{ 'img/logo.png'|static_image_path:request }}" />
    <meta property="og:image:height" content="80" />
    <meta property="og:image:width" content="80" />
    <meta property="og:site_name" content="{{ site.name }}" />
    <meta property="og:locale" content="en-gb" />

    <!-- Twitter card data -->
    <meta name="twitter:card" content="summary" />
    {% if settings.TWITTER_USERNAME %}
      <meta name="twitter:site" content="@{{ settings.TWITTER_USERNAME }}" />
    {% endif %}
    <meta property="twitter:image" content="{{ 'img/logo.png'|static_image_path:request }}" />
    <meta property="twitter:image:height" content="120" />
    <meta property="twitter:image:width" content="120" />
{% endblock %}

{% block body_class %}constituency{% endblock %}

{% block title %}Candidates for {{ ballot.post.label }} in the {{ ballot.election.name }}{% endblock %}

{% block hero %}
  <h1>Candidates for {{ ballot.post.label }}</h1>
{% endblock %}


{% block content %}
<div class="row">
  <div class="columns large-9">
    {% if ballot.cancelled %}
    <div class="panel">
      ❌ The poll for this election was cancelled
    </div>
    {% endif %}

    {% if not ballot.candidates_locked and candidates.exists %}
    <div class="panel">
        <p>These candidates haven't been confirmed by the official "nomination papers"
            from the council yet. This means they might not all end up on the ballot paper.</p>
        <p>We will manually verify each candidate when the nomination papers are published.</p>
    </div>
    {% endif %}



{#    Candidates Table #}
    {% if candidates.exists %}
      <table class="table candidates-list">
        <thead>
          <tr>
            <th>Name</th>
            <th>Party</th>
            {% if ballot.has_results %}
            <th>Results</th>
            {% endif %}
            {% if user.is_authenticated %}
            <th>Actions</th>
            {% endif %}
          </tr>
        </thead>
        <tbody>
          {% for candidate in candidates %}
          <tr>
            <td>
              <a href="{{ candidate.person.get_absolute_url }}">
                <img class="person-avatar" src="{{ candidate.person.get_display_image_url }}"/>
                {% if candidate.result.is_winner %}<strong>{% endif %}
                  {{ candidate.person.name }}
                {% if candidate.result.is_winner %}</strong>{% endif %}
              </a>
            </td>
            <td>{{ candidate.party.name }}</td>
            {% if ballot.has_results %}
            <td>
              {{ candidate.result.num_ballots }}
              {% if candidate.result.is_winner %} (elected){% endif %}
            </td>
            {% endif %}
            <td>
              {% if user.is_authenticated %}
                {% if candidate_list_edits_allowed %}
                  <a class="button tiny js-toggle-source-confirmation not-standing">Not actually standing?</a>
                  {% include 'candidates/_source_confirmation.html' with standing='not-standing' action='candidacy-delete' %}
                {% endif %}
                <a href="{% url 'person-update' person_id=candidate.person.pk %}" class="button tiny secondary">Edit</a>
              {% endif %}
            </td>
          </tr>
          {% endfor %}

        </tbody>
      </table>
    {% else %}
      <div class="no-candidates">
        <p>
          <strong>Oh no!</strong>
          We don’t know of any candidates in {{ ballot.post.label }} for the {{ ballot.election.name }} yet.
        </p>
      </div>
    {% endif %}

    {% if candidate_list_edits_allowed %}
      <p>
        <a class="show-new-candidate-form button" href="{% url 'person-create' election=ballot.election.slug %}">Add a new candidate</a>
      </p>
      {% if sopn %}
        <a href="{% url "bulk_add_from_sopn" ballot.election.slug ballot.post.id %}" class="button">Add candidates from nomination paper in {{ballot.post.label}}</a>
      {% endif %}

    {% elif not request.user.is_authenticated %}
      <p>
        <a href="{% url 'account_login' %}?next={{ request.path }}" class="show-new-candidate-form button">
          Sign in to add a new candidate
        </a>
      </p>
    {% endif %}

{#    END Candidates Table #}

  </div>
  <div class="columns large-3">
      {% include "uk/data_timeline.html" %}
  </div>
</div>

{% endblock %}
